!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cql=e()}}(function(){var e;return function t(e,r,n){function i(o,u){if(!r[o]){if(!e[o]){var c="function"==typeof require&&require;if(!u&&c)return c(o,!0);if(a)return a(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var l=r[o]={exports:{}};e[o][0].call(l.exports,function(t){var r=e[o][1][t];return i(r?r:t)},l,l.exports,t,e,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){},{}],2:[function(t,r,n){!function(t,i){"object"==typeof n&&"undefined"!=typeof r?i(n):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(t.d3_time={})}(this,function(e){"use strict";function t(e,r,n,o){function u(t){return e(t=new Date(+t)),t}return u.floor=u,u.round=function(t){var n=new Date(+t),i=new Date(t-1);return e(n),e(i),r(i,1),i-t>t-n?n:i},u.ceil=function(t){return e(t=new Date(t-1)),r(t,1),t},u.offset=function(e,t){return r(e=new Date(+e),null==t?1:Math.floor(t)),e},u.range=function(t,n,i){var a=[];if(t=new Date(t-1),n=new Date(+n),i=null==i?1:Math.floor(i),!(n>t&&i>0))return a;for(r(t,1),e(t),n>t&&a.push(new Date(+t));r(t,i),e(t),n>t;)a.push(new Date(+t));return a},u.filter=function(n){return t(function(t){for(;e(t),!n(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;r(e,1),!n(e););})},n&&(u.count=function(t,r){return i.setTime(+t),a.setTime(+r),e(i),e(a),Math.floor(n(i,a))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(o?function(t){return o(t)%e===0}:function(t){return u.count(0,t)%e===0}):u:null}),u}function r(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function n(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,a=new Date,o=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});o.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,r){t.setTime(+t+r*e)},function(t,r){return(r-t)/e}):o:null};var u=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),c=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),s=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),p=r(0),f=r(1),E=r(2),T=r(3),A=r(4),S=r(5),d=r(6),y=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),I=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),h=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),g=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),m=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),N=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),O=n(0),C=n(1),v=n(2),R=n(3),L=n(4),_=n(5),P=n(6),M=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),D=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),U=o.range,x=u.range,X=c.range,b=s.range,F=l.range,k=p.range,G=f.range,H=E.range,B=T.range,w=A.range,Y=S.range,Q=d.range,K=p.range,W=y.range,q=I.range,V=o,j=U,Z=h.range,z=g.range,$=m.range,J=N.range,ee=O.range,te=C.range,re=v.range,ne=R.range,ie=L.range,ae=_.range,oe=P.range,ue=O.range,ce=M.range,se=D.range,le="0.1.1";e.version=le,e.milliseconds=U,e.seconds=x,e.minutes=X,e.hours=b,e.days=F,e.sundays=k,e.mondays=G,e.tuesdays=H,e.wednesdays=B,e.thursdays=w,e.fridays=Y,e.saturdays=Q,e.weeks=K,e.months=W,e.years=q,e.utcMillisecond=V,e.utcMilliseconds=j,e.utcSeconds=Z,e.utcMinutes=z,e.utcHours=$,e.utcDays=J,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=re,e.utcWednesdays=ne,e.utcThursdays=ie,e.utcFridays=ae,e.utcSaturdays=oe,e.utcWeeks=ue,e.utcMonths=ce,e.utcYears=se,e.millisecond=o,e.second=u,e.minute=c,e.hour=s,e.day=l,e.sunday=p,e.monday=f,e.tuesday=E,e.wednesday=T,e.thursday=A,e.friday=S,e.saturday=d,e.week=p,e.month=y,e.year=I,e.utcSecond=h,e.utcMinute=g,e.utcHour=m,e.utcDay=N,e.utcSunday=O,e.utcMonday=C,e.utcTuesday=v,e.utcWednesday=R,e.utcThursday=L,e.utcFriday=_,e.utcSaturday=P,e.utcWeek=O,e.utcMonth=M,e.utcYear=D,e.interval=t})},{}],3:[function(e,t,r){function n(e){if(!e)throw Error("Missing binning options.");var t,r,n,u,c,s,l,p=e.maxbins||15,f=e.base||10,E=Math.log(f),T=e.div||[5,2],A=e.min,S=e.max,d=S-A;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,d/p,0,e.steps.length))];else{for(r=Math.ceil(Math.log(p)/E),n=e.minstep||0,t=Math.max(n,Math.pow(f,Math.round(Math.log(d)/E)-r));Math.ceil(d/t)>p;)t*=f;for(s=0;s<T.length;++s)c=t/T[s],c>=n&&p>=d/c&&(t=c)}return c=Math.log(t),u=c>=0?0:~~(-c/E)+1,l=Math.pow(f,-u-1),A=Math.min(A,Math.floor(A/t+l)*t),S=Math.ceil(S/t)*t,{start:A,stop:S,step:t,unit:{precision:u},value:a,index:o}}function i(e,t,r,n){for(;n>r;){var i=r+n>>>1;s.cmp(e[i],t)<0?r=i+1:n=i}return r}function a(e){return this.step*Math.floor(e/this.step+p)}function o(e){return Math.floor((e-this.start)/this.step+p)}function u(e){return this.unit.date(a.call(this,e))}function c(e){return o.call(this,this.unit.unit(e))}var s=e("../util"),l=e("../time"),p=1e-15;n.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?l.utc:l,r=e.min,i=e.max,a=e.maxbins||20,o=e.minbins||4,s=+i-+r,p=e.unit?t[e.unit]:t.find(s,o,a),f=n({min:null!=p.min?p.min:p.unit(r),max:null!=p.max?p.max:p.unit(i),maxbins:a,minstep:p.minstep,steps:p.step});return f.unit=p,f.index=c,e.raw||(f.value=u),f},t.exports=n},{"../time":7,"../util":8}],4:[function(e,t,r){var n=e("./util"),i=t.exports;i.repeat=function(e,t){var r,n=Array(t);for(r=0;t>r;++r)n[r]=e;return n},i.zeros=function(e){return i.repeat(0,e)},i.range=function(e,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=e,e=0)),(t-e)/r==1/0)throw new Error("Infinite range");var n,i=[],a=-1;if(0>r)for(;(n=e+r*++a)>t;)i.push(n);else for(;(n=e+r*++a)<t;)i.push(n);return i},i.random={},i.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var r=t-e,n=function(){return e+r*Math.random()};return n.samples=function(e){return i.zeros(e).map(n)},n.pdf=function(n){return n>=e&&t>=n?1/r:0},n.cdf=function(n){return e>n?0:n>t?1:(n-e)/r},n.icdf=function(t){return t>=0&&1>=t?e+t*r:NaN},n},i.random.integer=function(e,t){void 0===t&&(t=e,e=0);var r=t-e,n=function(){return e+Math.floor(r*Math.random())};return n.samples=function(e){return i.zeros(e).map(n)},n.pdf=function(n){return n===Math.floor(n)&&n>=e&&t>n?1/r:0},n.cdf=function(n){var i=Math.floor(n);return e>i?0:i>=t?1:(i-e+1)/r},n.icdf=function(t){return t>=0&&1>=t?e-1+Math.floor(t*r):NaN},n},i.random.normal=function(e,t){e=e||0,t=t||1;var r,n=function(){var n,i,a=0,o=0;if(void 0!==r)return a=r,r=void 0,a;do a=2*Math.random()-1,o=2*Math.random()-1,n=a*a+o*o;while(0===n||n>1);return i=Math.sqrt(-2*Math.log(n)/n),r=e+o*i*t,e+a*i*t};return n.samples=function(e){return i.zeros(e).map(n)},n.pdf=function(r){var n=Math.exp(Math.pow(r-e,2)/(-2*Math.pow(t,2)));return 1/(t*Math.sqrt(2*Math.PI))*n},n.cdf=function(r){var n,i=(r-e)/t,a=Math.abs(i);if(a>37)n=0;else{var o,u=Math.exp(-a*a/2);7.07106781186547>a?(o=.0352624965998911*a+.700383064443688,o=o*a+6.37396220353165,o=o*a+33.912866078383,o=o*a+112.079291497871,o=o*a+221.213596169931,o=o*a+220.206867912376,n=u*o,o=.0883883476483184*a+1.75566716318264,o=o*a+16.064177579207,o=o*a+86.7807322029461,o=o*a+296.564248779674,o=o*a+637.333633378831,o=o*a+793.826512519948,o=o*a+440.413735824752,n/=o):(o=a+.65,o=a+4/o,o=a+3/o,o=a+2/o,o=a+1/o,n=u/o/2.506628274631)}return i>0?1-n:n},n.icdf=function(r){if(0>=r||r>=1)return NaN;var n=2*r-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),a=2/(Math.PI*i)+Math.log(1-Math.pow(n,2))/2,o=Math.log(1-n*n)/i,u=(n>0?1:-1)*Math.sqrt(Math.sqrt(a*a-o)-a);return e+t*Math.SQRT2*u},n},i.random.bootstrap=function(e,t){var r=e.filter(n.isValid),a=r.length,o=t?i.random.normal(0,t):null,u=function(){return r[~~(Math.random()*a)]+(o?o():0)};return u.samples=function(e){return i.zeros(e).map(u)},u}},{"./util":8}],5:[function(e,t,r){function n(e,t){return t?void(e[s]=t):e&&e[s]||null}function i(e,t){e=c.array(e),t=c.$(t);var r,n,i;if(e[s]&&(r=t(e[s]),c.isString(r)))return r;for(n=0,i=e.length;!c.isValid(r)&&i>n;++n)r=t?t(e[n]):e[n];return c.isDate(r)?"date":c.isNumber(r)?"number":c.isBoolean(r)?"boolean":c.isString(r)?"string":null}function a(e,t){return e.length?(t=t||c.keys(e[0]),t.reduce(function(t,r){return t[r]=i(e,r),t},{})):void 0}function o(e,t){e=c.array(e),t=c.$(t);var r,n,i,a=["boolean","integer","number","date"];for(r=0;r<e.length;++r){for(i=t?t(e[r]):e[r],n=0;n<a.length;++n)c.isValid(i)&&!p[a[n]](i)&&(a.splice(n,1),n-=1);if(0===a.length)return"string"}return a[0]}function u(e,t){return t=t||c.keys(e[0]),t.reduce(function(t,r){return t[r]=o(e,r),t},{})}var c=e("../util"),s="__types__",l={"boolean":c["boolean"],integer:c.number,number:c.number,date:c.date,string:function(e){return""===e?null:e}},p={"boolean":function(e){return"true"===e||"false"===e||c.isBoolean(e)},integer:function(e){return p.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!c.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};i.annotation=n,i.all=a,i.infer=o,i.inferAll=u,i.parsers=l,t.exports=i},{"../util":8}],6:[function(e,t,r){function n(e,t,r){var n=e&&e.nullh||0,i=c.random.normal(0,1),a=s.mean(t,r),o=s.stdev(t,r)/Math.sqrt(s.count.valid(t,r));if(0===o)return a-n===0?1:0;var u=(a-n)/o;return 2*i.cdf(-Math.abs(u))}function i(e,t,r,n){var i,a=n?t.map(o.$(r)):t,u=n?t.map(o.$(n)):r,c=s.count(a),l=s.count(u),p=Array();if(c!==l)throw Error("Array lengths must match.");for(i=0;c>i;++i)o.isValid(a[i])&&o.isValid(u[i])&&p.push(a[i]-u[i]);return s.z.test(p,e&&e.nullh||0)}function a(e,t,r,n){var i=n?t.map(o.$(r)):t,a=n?t.map(o.$(n)):r,u=s.count.valid(i),l=s.count.valid(a),p=c.random.normal(0,1),f=s.mean(i)-s.mean(a)-(e&&e.nullh||0),E=Math.sqrt(s.variance(i)/u+s.variance(a)/l);if(0===E)return 0===f?1:0;var T=f/E;return 2*p.cdf(-Math.abs(T))}var o=e("./util"),u=e("./import/type"),c=e("./generate"),s=t.exports;s.unique=function(e,t,r){t=o.$(t),r=r||[];var n,i,a,u={};for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],n in u||(u[n]=1,r.push(n));return r},s.count=function(e){return e&&e.length||0},s.count.valid=function(e,t){t=o.$(t);var r,n,i,a=0;for(n=0,i=e.length;i>n;++n)r=t?t(e[n]):e[n],o.isValid(r)&&(a+=1);return a},s.count.missing=function(e,t){t=o.$(t);var r,n,i,a=0;for(n=0,i=e.length;i>n;++n)r=t?t(e[n]):e[n],null==r&&(a+=1);return a},s.count.distinct=function(e,t){t=o.$(t);var r,n,i,a={},u=0;for(n=0,i=e.length;i>n;++n)r=t?t(e[n]):e[n],r in a||(a[r]=1,u+=1);return u},s.count.map=function(e,t){t=o.$(t);var r,n,i,a={};for(n=0,i=e.length;i>n;++n)r=t?t(e[n]):e[n],a[r]=r in a?a[r]+1:1;return a},s.median=function(e,t){return t&&(e=e.map(o.$(t))),e=e.filter(o.isValid).sort(o.cmp),s.quantile(e,.5)},s.quartile=function(e,t){t&&(e=e.map(o.$(t))),e=e.filter(o.isValid).sort(o.cmp);var r=s.quantile;return[r(e,.25),r(e,.5),r(e,.75)]},s.quantile=function(e,t,r){void 0===r&&(r=t,t=o.identity),t=o.$(t);var n=(e.length-1)*r+1,i=Math.floor(n),a=+t(e[i-1]),u=n-i;return u?a+u*(t(e[i])-a):a},s.sum=function(e,t){t=o.$(t);for(var r,n=0,i=0,a=e.length;a>i;++i)r=t?t(e[i]):e[i],o.isValid(r)&&(n+=r);return n},s.mean=function(e,t){t=o.$(t);var r,n,i,a,u,c=0;for(n=0,a=0,i=e.length;i>n;++n)u=t?t(e[n]):e[n],o.isValid(u)&&(r=u-c,c+=r/++a);return c},s.mean.geometric=function(e,t){t=o.$(t);var r,n,i,a,u=1;for(a=0,r=0,n=e.length;n>a;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){if(0>=i)throw Error("Geometric mean only defined for positive values.");u*=i,++r}return u=r>0?Math.pow(u,1/r):0},s.mean.harmonic=function(e,t){t=o.$(t);var r,n,i,a,u=0;for(a=0,r=0,n=e.length;n>a;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(u+=1/i,++r);return r/u},s.variance=function(e,t){if(t=o.$(t),!o.isArray(e)||e.length<2)return 0;var r,n,i,a,u=0,c=0;for(n=0,i=0;n<e.length;++n)a=t?t(e[n]):e[n],o.isValid(a)&&(r=a-u,u+=r/++i,c+=r*(a-u));return c/=i-1},s.stdev=function(e,t){return Math.sqrt(s.variance(e,t))},s.modeskew=function(e,t){var r=s.mean(e,t),n=s.median(e,t),i=s.stdev(e,t);return 0===i?0:(r-n)/i},s.min=function(e,t){return s.extent(e,t)[0]},s.max=function(e,t){return s.extent(e,t)[1]},s.extent=function(e,t){t=o.$(t);var r,n,i,a,u=e.length;for(a=0;u>a;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){r=n=i;break}for(;u>a;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(r>i&&(r=i),i>n&&(n=i));return[r,n]},s.extent.index=function(e,t){t=o.$(t);var r,n,i,a,u=-1,c=-1,s=e.length;for(a=0;s>a;++a)if(i=t?t(e[a]):e[a],o.isValid(i)){r=n=i,u=c=a;break}for(;s>a;++a)i=t?t(e[a]):e[a],o.isValid(i)&&(r>i&&(r=i,u=a),i>n&&(n=i,c=a));return[u,c]},s.dot=function(e,t,r){var n,i,a=0;if(r)for(t=o.$(t),r=o.$(r),n=0;n<e.length;++n)i=t(e[n])*r(e[n]),i===i&&(a+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(n=0;n<e.length;++n)i=e[n]*t[n],i===i&&(a+=i)}return a},s.dist=function(e,t,r,n){var i,a,u=o.isFunction(r)||o.isString(r),c=e,s=u?e:t,l=u?n:r,p=2===l||null==l,f=e.length,E=0;for(u&&(t=o.$(t),r=o.$(r)),a=0;f>a;++a)i=u?t(c[a])-r(s[a]):c[a]-s[a],E+=p?i*i:Math.pow(Math.abs(i),l);return p?Math.sqrt(E):Math.pow(E,1/l)},s.cohensd=function(e,t,r){var n=r?e.map(o.$(t)):e,i=r?e.map(o.$(r)):t,a=s.mean(n),u=s.mean(i),c=s.count.valid(n),l=s.count.valid(i);if(0>=c+l-2)return 0;var p=s.variance(n),f=s.variance(i),E=Math.sqrt(((c-1)*p+(l-1)*f)/(c+l-2));return 0===E?0:(a-u)/E},s.covariance=function(e,t,r){var n,i,a,u,c,l=r?e.map(o.$(t)):e,p=r?e.map(o.$(r)):t,f=l.length,E=s.mean(l),T=s.mean(p),A=0,S=0;if(f!==p.length)throw Error("Input lengths must match.");for(n=0;f>n;++n)if(i=l[n],u=o.isValid(i),a=p[n],c=o.isValid(a),u&&c)A+=(i-E)*(a-T),++S;else if(u||c)throw Error("Valid values must align.");return A/(S-1)},s.rank=function(e,t){t=o.$(t)||o.identity;var r,n,i,a=e.map(function(e,r){return{idx:r,val:t(e)}}).sort(o.comparator("val")),u=e.length,c=Array(u),s=-1,l={};for(r=0;u>r;++r){if(n=a[r].val,0>s&&l===n)s=r-1;else if(s>-1&&l!==n){for(i=1+(r-1+s)/2;r>s;++s)c[a[s].idx]=i;s=-1}c[a[r].idx]=r+1,l=n}if(s>-1)for(i=1+(u-1+s)/2;u>s;++s)c[a[s].idx]=i;return c},s.cor=function(e,t,r){var n=r;r=n?e.map(o.$(r)):t,t=n?e.map(o.$(t)):e;var i=s.dot(t,r),a=s.mean(t),u=s.mean(r),c=s.stdev(t),l=s.stdev(r),p=e.length;return(i-p*a*u)/((p-1)*c*l)},s.cor.rank=function(e,t,r){var n,i,a,o=r?s.rank(e,t):s.rank(e),u=r?s.rank(e,r):s.rank(t),c=e.length;for(n=0,i=0;c>n;++n)a=o[n]-u[n],i+=a*a;return 1-6*i/(c*(c*c-1))},s.cor.dist=function(e,t,r){var n,i,a,u,c=r?e.map(o.$(t)):e,l=r?e.map(o.$(r)):t,p=s.dist.mat(c),f=s.dist.mat(l),E=p.length;for(n=0,i=0,a=0,u=0;E>n;++n)i+=p[n]*p[n],a+=f[n]*f[n],u+=p[n]*f[n];return Math.sqrt(u/Math.sqrt(i*a))},s.linearRegression=function(e,t,r){var n,i,a=r?e.map(o.$(t)):e,u=r?e.map(o.$(r)):t,c=a.length,l=s.covariance(a,u),p=s.stdev(a),f=s.stdev(u),E=l/(p*p),T=s.mean(u)-E*s.mean(a),A={slope:E,intercept:T,R:l/(p*f),rss:0};for(i=0;c>i;++i)o.isValid(a[i])&&o.isValid(u[i])&&(n=E*a[i]+T-u[i],A.rss+=n*n);return A},s.bootstrap={},s.bootstrap.ci=function(e,t,r,n,i){var a,u,l,p,f,E,T;for(o.isFunction(t)||o.isString(t)?(a=e.map(o.$(t)),u=r,l=n,p=i):(a=e,u=t,l=r,p=n),u=u?+u:1e3,l=l||.05,f=c.random.bootstrap(a,p),T=0,E=Array(u);u>T;++T)E[T]=s.mean(f.samples(a.length));return E.sort(o.numcmp),[s.quantile(E,l/2),s.quantile(E,1-l/2)]},s.z={},s.z.ci=function(e,t,r){var n=e,i=t;(o.isFunction(t)||o.isString(t))&&(n=e.map(o.$(t)),i=r),i=i||.05;var a=.05===i?1.96:c.random.normal(0,1).icdf(1-i/2),u=s.mean(n),l=s.stdev(n)/Math.sqrt(s.count.valid(n));return[u-a*l,u+a*l]},s.z.test=function(e,t,r,u){return o.isFunction(r)||o.isString(r)?(u&&u.paired?i:a)(u,e,t,r):o.isArray(t)?(r&&r.paired?i:a)(r,e,t):o.isFunction(t)||o.isString(t)?n(r,e,t):n(t,e)},s.dist.mat=function(e){var t,r,n,i=e.length,a=i*i,o=Array(a),u=c.zeros(i),s=0;for(r=0;i>r;++r)for(o[r*i+r]=0,n=r+1;i>n;++n)o[r*i+n]=t=Math.abs(e[r]-e[n]),o[n*i+r]=t,u[r]+=t,u[n]+=t;for(r=0;i>r;++r)s+=u[r],u[r]/=i;for(s/=a,r=0;i>r;++r)for(n=r;i>n;++n)o[r*i+n]+=s-u[r]-u[n],o[n*i+r]=o[r*i+n];return o},s.entropy=function(e,t){t=o.$(t);var r,n,i=0,a=0,u=e.length;for(r=0;u>r;++r)i+=t?t(e[r]):e[r];if(0===i)return 0;for(r=0;u>r;++r)n=(t?t(e[r]):e[r])/i,n&&(a+=n*Math.log(n));return-a/Math.LN2},s.mutual=function(e,t,r,n){var i,a,u,c=n?e.map(o.$(t)):e,s=n?e.map(o.$(r)):t,l=n?e.map(o.$(n)):r,p={},f={},E=l.length,T=0,A=0,S=0;for(u=0;E>u;++u)p[c[u]]=0,f[s[u]]=0;for(u=0;E>u;++u)p[c[u]]+=l[u],f[s[u]]+=l[u],T+=l[u];for(a=1/(T*Math.LN2),u=0;E>u;++u)0!==l[u]&&(i=T*l[u]/(p[c[u]]*f[s[u]]),A+=l[u]*a*Math.log(i),S+=l[u]*a*Math.log(l[u]/T));return[A,1+A/S]},s.mutual.info=function(e,t,r,n){return s.mutual(e,t,r,n)[0]},s.mutual.dist=function(e,t,r,n){return s.mutual(e,t,r,n)[1]},s.profile=function(e,t){var r,n,i,a,c,l=0,p=0,f=0,E=0,T=null,A=null,S=0,d=[],y={};for(i=0;i<e.length;++i)a=t?t(e[i]):e[i],y[a]=a in y?y[a]+1:(E+=1,1),null==a?++f:o.isValid(a)&&(c="string"==typeof a?a.length:a,(null===T||T>c)&&(T=c),(null===A||c>A)&&(A=c),r=c-l,l+=r/++p,S+=r*(c-l),d.push(c));return S/=p-1,n=Math.sqrt(S),d.sort(o.cmp),{type:u(e,t),unique:y,count:e.length,valid:p,missing:f,distinct:E,min:T,max:A,mean:l,stdev:n,median:a=s.quantile(d,.5),q1:s.quantile(d,.25),q3:s.quantile(d,.75),modeskew:0===n?0:(l-a)/n}},s.summary=function(e,t){t=t||o.keys(e[0]);var r=t.map(function(t){var r=s.profile(e,o.$(t));return r.field=t,r});return r.__summary__=!0,r}},{"./generate":4,"./import/type":5,"./util":8}],7:[function(e,t,r){function n(e){return s.setTime(+e),s}function i(e,t,r,n,i,a){var o={type:e,date:t,unit:r};return n?o.step=n:o.minstep=1,null!=i&&(o.min=i),null!=a&&(o.max=a),o}function a(e,t,r,n,a,o){return i(e,function(e){return t.offset(r,e)},function(e){return t.count(r,e)},n,a,o)}function o(e,t,r,n){var i,a,o,u=T[0];for(i=1,a=T.length;a>i;++i)if(u=T[i],t>u[0]){if(o=t/u[0],o>n)return e[T[i-1][1]];if(o>=r)return e[u[1]]}return e[T[a-1][1]]}function u(e){var t,r,n={};for(t=0,r=e.length;r>t;++t)n[e[t].type]=e[t];return n.find=function(t,r,n){return o(e,t,r,n)},n}var c=e("d3-time"),s=new Date,l=new Date(0,0,1).setFullYear(0),p=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),f=[a("second",c.second,l),a("minute",c.minute,l),a("hour",c.hour,l),a("day",c.day,l,[1,7]),a("month",c.month,l,[1,3,6]),a("year",c.year,l),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return n(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return n(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return n(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return n(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return n(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return n(e).getMonth()},[1],0,11)],E=[a("second",c.utcSecond,p),a("minute",c.utcMinute,p),a("hour",c.utcHour,p),a("day",c.utcDay,p,[1,7]),a("month",c.utcMonth,p,[1,3,6]),a("year",c.utcYear,p),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return n(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return n(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return n(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return n(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return n(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return n(e).getUTCMonth()},[1],0,11)],T=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=u(f),t.exports.utc=u(E)},{"d3-time":2}],8:[function(e,t,r){(function(e){function r(e,t){var r,n="";for(r=0;e>r;++r)n+=t;return n}function n(e,t,r){var n=0,i=e.split(c);return e=r?(i=i.reverse()).filter(function(e){return n+=e.length,t>=n}).reverse():i.filter(function(e){return n+=e.length,t>=n}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports,a="__name__";i.namedfunc=function(e,t){return t[a]=e,t},i.name=function(e){return null==e?null:e[a]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},i.extend=function(e){for(var t,r,n=1,i=arguments.length;i>n;++n){t=arguments[n];for(r in t)e[r]=t[r]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var t,r=[];for(t in e)r.push(t);return r},i.vals=function(e){var t,r=[];for(t in e)r.push(e[t]);return r},i.toMap=function(e,t){return(t=i.$(t))?e.reduce(function(e,r){return e[t(r)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},i.keystr=function(e){var t=e.length;if(!t)return"";for(var r=String(e[0]),n=1;t>n;++n)r+="|"+String(e[n]);return r};var o=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===o.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===o.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===o.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===o.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==o.call(e)},i.isDate=function(e){return"[object Date]"===o.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"===e?!1:!!e},i.date=function(e,t){var r=t?t:Date;return null==e||""===e?null:r.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var t;return i.isString(e)&&(t=i.field(e)).length>1?function(e,r){for(var n=0;n<t.length-1;++n)e=e[t[n]];e[t[n]]=r}:function(t,r){t[e]=r}},i.$func=function(e,t){return function(r){r=i.$(r)||i.identity;var n=e+(i.name(r)?"_"+i.name(r):"");return i.namedfunc(n,function(e){return t(r(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,t){e=i.$(e);var r=i.isArray(t)?i.toMap(t):t;return function(t){return!!r[e(t)]}},i.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var r=1;return"-"===e[0]?(r=-1,e=e.slice(1)):"+"===e[0]&&(r=1,e=e.slice(1)),t.push(r),i.accessor(e)}),function(r,n){var i,a,o,u,c;for(i=0,a=e.length;a>i;++i){if(o=e[i],u=o(r),c=o(n),c>u)return-1*t[i];if(u>c)return t[i]}return 0}},i.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e?-1:null===t?1:NaN},i.numcmp=function(e,t){return e-t},i.stablesort=function(e,t,r){var n=e.reduce(function(e,t,n){return e[r(t)]=n,e},{});return e.sort(function(e,i){var a=t(e),o=t(i);return o>a?-1:a>o?1:n[r(e)]-n[r(i)]}),e},i.permute=function(e){for(var t,r,n=e.length;n;)r=Math.floor(Math.random()*n--),t=e[n],e[n]=e[r],e[r]=t},i.pad=function(e,t,n,i){i=i||" ";var a=t-e.length;if(0>=a)return e;switch(n){case"left":return r(a,i)+e;case"middle":case"center":return r(Math.floor(a/2),i)+e+r(Math.ceil(a/2),i);default:return e+r(a,i)}},i.truncate=function(e,t,r,i,a){var o=e.length;if(t>=o)return e;a=void 0!==a?String(a):"â€¦";var u=Math.max(0,t-a.length);switch(r){case"left":return a+(i?n(e,u,1):e.slice(o-u));case"middle":case"center":var c=Math.ceil(u/2),s=Math.floor(u/2);return(i?n(e,c):e.slice(0,c))+a+(i?n(e,s,1):e.slice(o-s));default:return(i?n(e,u):e.slice(0,u))+a}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:1}],9:[function(e,t,r){"use strict";var n=e("vega-lite/src/channel"),i=e("vega-lite/src/aggregate"),a=e("vega-lite/src/mark"),o=e("vega-lite/src/scale"),u=e("vega-lite/src/sort"),c=e("vega-lite/src/timeunit"),s=e("vega-lite/src/type"),l=e("./property");r.DEFAULT_QUERY_CONFIG={verbose:!1,defaultSpecConfig:{overlay:{line:!0},scale:{useRawDomain:!0}},propertyPrecedence:l.DEFAULT_PROPERTY_PRECEDENCE,marks:[a.Mark.POINT,a.Mark.BAR,a.Mark.LINE,a.Mark.AREA,a.Mark.TICK],channels:[n.X,n.Y,n.ROW,n.COLUMN,n.SIZE,n.COLOR],aggregates:[void 0,i.AggregateOp.MEAN],timeUnits:[void 0,c.TimeUnit.YEAR,c.TimeUnit.MONTH,c.TimeUnit.DAY,c.TimeUnit.DATE],types:[s.Type.NOMINAL,s.Type.ORDINAL,s.Type.QUANTITATIVE,s.Type.TEMPORAL],maxBinsList:[5,10,20],axisAxisColors:[void 0],axisAxisWidths:[void 0],axisLayers:["front","back"],axisOffsets:[void 0],axisOrients:[void 0],axisGridColors:[void 0],axisGridDashes:[void 0],axisGridOpacities:[void 0],axisGridWidths:[void 0],axisFormats:[void 0],axisLabelAngles:[void 0],axisLabelMaxLengths:[void 0],axisSubDivides:[void 0],axisTicks:[void 0],axisTickColors:[void 0],axisTickLabelColors:[void 0],axisTickLabelFonts:[void 0],axisTickLabelFontSizes:[void 0],axisTickPaddings:[void 0],axisTickSizes:[void 0],axisTickSizeMajors:[void 0],axisTickSizeMinors:[void 0],axisTickSizeEnds:[void 0],axisTickWidths:[void 0],axisValuesList:[void 0],axisTitles:[void 0],axisTitleColors:[void 0],axisTitleFonts:[void 0],axisTitleFontWeights:[void 0],axisTitleFontSizes:[void 0],axisTitleOffsets:[void 0],axisTitleMaxLengths:[void 0],axisCharacterWidths:[void 0],sorts:[u.SortOrder.ASCENDING,u.SortOrder.DESCENDING],sortOps:[i.AggregateOp.MIN,i.AggregateOp.MEAN],sortOrders:[u.SortOrder.ASCENDING,u.SortOrder.DESCENDING],scaleBandSizes:[17,21],scaleDomains:[void 0],scaleExponents:[1],scaleRanges:[void 0],scaleTypes:[o.ScaleType.LINEAR,o.ScaleType.LOG],numberOrdinalProportion:.05,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitFacetOverPositionalChannels:!0,omitMultipleNonPositionalChannels:!0,omitNonSumStack:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,preferredBinAxis:n.Channel.X,preferredTemporalAxis:n.Channel.X,preferredOrdinalAxis:n.Channel.Y,preferredNominalAxis:n.Channel.Y,preferredFacet:n.Channel.ROW,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:10,maxCardinalityForShape:6,typeMatchesSchemaType:!0,smallBandSizeForHighCardinalityOrFacet:{maxCardinality:10,bandSize:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7}},{"./property":21,"vega-lite/src/aggregate":46,"vega-lite/src/channel":49,"vega-lite/src/mark":54,"vega-lite/src/scale":55,"vega-lite/src/sort":56,"vega-lite/src/timeunit":58,"vega-lite/src/type":59}],10:[function(e,t,r){"use strict";var n=function(){function e(e){this.constraint=e}return e.prototype.name=function(){return this.constraint.name},e.prototype.description=function(){return this.constraint.description},e.prototype.properties=function(){return this.constraint.properties},e.prototype.strict=function(){return this.constraint.strict},e}();r.AbstractConstraintModel=n},{}],11:[function(e,t,r){"use strict";var n=e("./encoding"),i=e("./spec");r.encoding=n,r.spec=i},{"./encoding":12,"./spec":13}],12:[function(e,t,r){"use strict";function n(e,t,n,i,a,o){for(var u=r.ENCODING_CONSTRAINTS_BY_PROPERTY[e]||[],c=i.getEncodingQueryByIndex(n),s=0;s<u.length;s++){var l=u[s];if(l.strict()||o[l.name()]){var p=l.satisfy(c,a,o);if(!p){var f="(enc) "+l.name();return o.verbose&&console.log(f+" failed with "+i.toShorthand()+" for "+t.name),f}}}return null}var i=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},a=e("vega-lite/src/channel"),o=e("vega-lite/src/scale"),u=e("vega-lite/src/type"),c=e("./base"),s=e("../property"),l=e("../enumspec"),p=e("../schema"),f=e("../util"),E=e("../query/encoding"),T=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return f.every(this.constraint.properties,function(t){var r=s.getNestedEncodingProperty(t);if(r){var n=r.parent,i=r.child;return e[n]?!l.isEnumSpec(e[n][i]):!0}return e[t]?!l.isEnumSpec(e[t]):!0})},t.prototype.satisfy=function(e,t,r){return this.constraint.allowEnumSpecForProperties||this.hasAllRequiredPropertiesSpecific(e)?this.constraint.satisfy(e,t,r):!0},t}(c.AbstractConstraintModel);r.EncodingConstraintModel=T,r.ENCODING_CONSTRAINTS=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[s.Property.TYPE,s.Property.AGGREGATE],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){return e.aggregate?e.type!==u.Type.ORDINAL&&e.type!==u.Type.NOMINAL:!0}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[s.Property.TYPE,s.Property.BIN],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){return e.bin?e.type===u.Type.QUANTITATIVE:!0}},{name:"channelSupportsRole",description:"encoding channel should support the role of the field",properties:[s.Property.CHANNEL,s.Property.TYPE,s.Property.BIN,s.Property.TIMEUNIT],allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,t,r){if(l.isEnumSpec(e.channel))return!0;var n=a.getSupportedRole(e.channel);return E.isDimension(e)?n.dimension:E.isMeasure(e)?n.measure:!0}},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[s.Property.SCALE,s.Property.SCALE_ZERO,s.Property.BIN],
allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){return!e.bin||!e.scale||e.scale.zero!==!0}},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[s.Property.AGGREGATE,s.Property.AUTOCOUNT,s.Property.TIMEUNIT,s.Property.BIN],allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,t,r){var n=(!l.isEnumSpec(e.aggregate)&&e.aggregate?1:0)+(!l.isEnumSpec(e.autoCount)&&e.autoCount?1:0)+(!l.isEnumSpec(e.bin)&&e.bin?1:0)+(!l.isEnumSpec(e.timeUnit)&&e.timeUnit?1:0);return 1>=n}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[s.Property.TYPE,s.Property.TIMEUNIT],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){return!e.timeUnit||e.type===u.Type.TEMPORAL}},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:s.SCALE_PROPERTIES.concat([s.Property.SCALE,s.Property.TYPE]),allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,t,r){if(e.scale){var n=e.scale,i=E.scaleType(e);if(void 0===i)return!0;for(var a in n)if(s.SUPPORTED_SCALE_PROPERTY_INDEX[a]&&!f.contains(s.SUPPORTED_SCALE_PROPERTY_INDEX[a],i))return!1}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[s.Property.FIELD,s.Property.TYPE],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){var n=t.primitiveType(e.field),i=e.type;switch(n){case p.PrimitiveType.BOOLEAN:case p.PrimitiveType.STRING:return i!==u.Type.QUANTITATIVE&&i!==u.Type.TEMPORAL;case p.PrimitiveType.NUMBER:case p.PrimitiveType.INTEGER:return i!==u.Type.TEMPORAL;case p.PrimitiveType.DATE:return i===u.Type.TEMPORAL;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[s.Property.FIELD,s.Property.TYPE],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return t.type(e.field)===e.type}},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return e.channel===a.Channel.COLOR&&e.type===u.Type.NOMINAL?t.cardinality(e)<=r.maxCardinalityForCategoricalColor:!0}},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD,s.Property.BIN,s.Property.TIMEUNIT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return e.channel===a.Channel.ROW||e.channel===a.Channel.COLUMN?t.cardinality(e)<=r.maxCardinalityForFacet:!0}},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD,s.Property.BIN,s.Property.TIMEUNIT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return e.channel===a.Channel.SHAPE?t.cardinality(e)<=r.maxCardinalityForShape:!0}},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[s.Property.TYPE,s.Property.SCALE,s.Property.SCALE_TYPE,s.Property.TIMEUNIT,s.Property.BIN],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){if(e.scale){var n=e.type,i=E.scaleType(e);if(f.contains([u.Type.ORDINAL,u.Type.NOMINAL],n))return f.contains([o.ScaleType.ORDINAL,void 0],i);if(n===u.Type.TEMPORAL)return e.timeUnit?f.contains([o.ScaleType.TIME,o.ScaleType.UTC,o.ScaleType.ORDINAL,void 0],i):f.contains([o.ScaleType.TIME,o.ScaleType.UTC,void 0],i);if(n===u.Type.QUANTITATIVE)return e.bin?f.contains([o.ScaleType.LINEAR,void 0],i):f.contains([o.ScaleType.LOG,o.ScaleType.POW,o.ScaleType.SQRT,o.ScaleType.QUANTILE,o.ScaleType.QUANTIZE,o.ScaleType.LINEAR,void 0],i)}return!0}}].map(function(e){return new T(e)}),r.ENCODING_CONSTRAINT_INDEX=r.ENCODING_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{}),r.ENCODING_CONSTRAINTS_BY_PROPERTY=r.ENCODING_CONSTRAINTS.reduce(function(e,t){return t.properties().forEach(function(r){e[r]=e[r]||[],e[r].push(t)}),e},{}),r.checkEncoding=n},{"../enumspec":16,"../property":21,"../query/encoding":22,"../schema":34,"../util":36,"./base":10,"vega-lite/src/channel":49,"vega-lite/src/scale":55,"vega-lite/src/type":59}],13:[function(e,t,r){"use strict";function n(e,t,n,i,a){for(var o=r.SPEC_CONSTRAINTS_BY_PROPERTY[e]||[],u=0;u<o.length;u++){var c=o[u];if(c.strict()||a[c.name()]){var s=c.satisfy(n,i,a);if(!s){var l="(spec) "+c.name();return a.verbose&&console.log(l+" failed with "+n.toShorthand()+" for "+t.name),l}}}return null}var i=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},a=e("vega-lite/src/aggregate"),o=e("vega-lite/src/channel"),u=e("vega-lite/src/mark"),c=e("vega-lite/src/scale"),s=e("vega-lite/src/type"),l=e("./base"),p=e("../enumspec"),f=e("../property"),E=e("../query/encoding"),T=e("../util"),A=e("../query/encoding"),S=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return T.every(this.constraint.properties,function(t){if(t===f.Property.MARK)return!p.isEnumSpec(e.getMark());var r=f.getNestedEncodingProperty(t);if(r){var n=r.parent,i=r.child;return T.every(e.getEncodings(),function(e){return e[n]?!p.isEnumSpec(e[n][i]):!0})}if(!f.isEncodingProperty(t))throw new Error("UNIMPLEMENTED");return T.every(e.getEncodings(),function(e){return e[t]?!p.isEnumSpec(e[t]):!0})})},t.prototype.satisfy=function(e,t,r){return this.constraint.allowEnumSpecForProperties||this.hasAllRequiredPropertiesSpecific(e)?this.constraint.satisfy(e,t,r):!0},t}(l.AbstractConstraintModel);r.SpecConstraintModel=S,r.SPEC_CONSTRAINTS=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,t,r){var n={};return T.every(e.getEncodings(),function(e){return p.isEnumSpec(e.channel)?!0:n[e.channel]?!1:(n[e.channel]=!0,!0)})}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not reccommend bar mark if scale does not start at zero",properties:[f.Property.MARK,f.Property.SCALE,f.Property.SCALE_ZERO,f.Property.CHANNEL,f.Property.TYPE],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){var n=e.getMark(),i=e.getEncodings();if(n===u.Mark.BAR)for(var a=0,c=i;a<c.length;a++){var l=c[a];if((l.channel===o.Channel.X||l.channel===o.Channel.Y)&&l.type===s.Type.QUANTITATIVE&&l.scale&&l.scale.zero===!1)return!1}return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[f.Property.BIN,f.Property.TIMEUNIT,f.Property.TYPE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,t,r){var n=T.some(e.getEncodings(),function(e){return e.autoCount===!0});if(n)return T.every(e.getEncodings(),function(e){if(void 0!==e.autoCount)return!0;switch(e.type){case s.Type.QUANTITATIVE:return!!e.bin;case s.Type.TEMPORAL:return!!e.timeUnit;case s.Type.ORDINAL:case s.Type.NOMINAL:return!0}throw new Error("Unsupported Type")});var i=T.every(e.enumSpecIndex.encodingIndicesByProperty.autoCount,function(t){return!p.isEnumSpec(e.getEncodingQueryByIndex(t).autoCount)});return i?T.some(e.getEncodings(),function(e){return e.type===s.Type.QUANTITATIVE?e.autoCount===!1?!1:!e.bin||p.isEnumSpec(e.bin):e.type===s.Type.TEMPORAL?!e.timeUnit||p.isEnumSpec(e.timeUnit):!1}):!0}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[f.Property.CHANNEL,f.Property.MARK],allowEnumSpecForProperties:!0,strict:!0,satisfy:function(e,t,r){var n=e.getMark();return p.isEnumSpec(n)?!0:T.every(e.getEncodings(),function(e){return p.isEnumSpec(e.channel)?!0:o.supportMark(e.channel,n)})}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[f.Property.CHANNEL,f.Property.MARK],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){var n=e.getMark();switch(n){case u.Mark.AREA:case u.Mark.LINE:return e.channelUsed(o.Channel.X)&&e.channelUsed(o.Channel.Y);case u.Mark.TEXT:return e.channelUsed(o.Channel.TEXT);case u.Mark.BAR:case u.Mark.CIRCLE:case u.Mark.POINT:case u.Mark.SQUARE:case u.Mark.TICK:case u.Mark.RULE:return e.channelUsed(o.Channel.X)||e.channelUsed(o.Channel.Y)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+n)}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,t,r){return!e.isAggregate()}},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"All required channels for the specified mark should be specified",properties:[f.Property.CHANNEL,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){if(e.isAggregate()){var n=!1,i=!1;return e.getEncodings().forEach(function(e){e.aggregate||e.autoCount||(i=!0,T.contains([o.Channel.ROW,o.Channel.COLUMN],e.channel)||(n=!0))}),!i||n}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT,f.Property.BIN,f.Property.TIMEUNIT,f.Property.TYPE],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return e.isAggregate()?T.some(e.getEncodings(),function(e){return!!E.isDimension(e)}):!0}},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[f.Property.MARK,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return T.contains([u.Mark.BAR,u.Mark.LINE,u.Mark.AREA],e.getMark())?e.isAggregate():!0}},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[f.Property.CHANNEL,f.Property.MARK],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,t,r){var n=e.getMark();return T.contains([u.Mark.TICK,u.Mark.BAR],n)?!e.channelUsed(o.Channel.SIZE):!0}},{name:"omitFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return e.channelUsed(o.Channel.ROW)||e.channelUsed(o.Channel.COLUMN)?e.channelUsed(o.Channel.X)&&e.channelUsed(o.Channel.Y):!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[f.Property.MARK,f.Property.CHANNEL,f.Property.SCALE,f.Property.SCALE_TYPE,f.Property.TYPE],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){var n=e.getMark(),i=e.getEncodings();if(n===u.Mark.AREA||n===u.Mark.BAR)for(var a=0,s=i;a<s.length;a++){var l=s[a];if((l.channel===o.Channel.X||l.channel===o.Channel.Y)&&l.scale){var p=A.scaleType(l);if(p===c.ScaleType.LOG)return!1}}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,t,r){for(var n=e.getEncodings(),i=0,a=0;a<n.length;a++){var u=n[a].channel;if(!p.isEnumSpec(u)&&(u===o.Channel.COLOR||u===o.Channel.SHAPE||u===o.Channel.SIZE)&&(i+=1,i>1))return!1}return!0}},{name:"omitNonPositionalOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return T.some(o.NONSPATIAL_CHANNELS,function(t){return e.channelUsed(t)})?e.channelUsed(o.Channel.X)&&e.channelUsed(o.Channel.Y):!0}},{name:"omitRaw",description:"Omit raw plots.",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return!!e.isAggregate()}},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT,f.Property.TIMEUNIT,f.Property.BIN,f.Property.TYPE],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,t,r){return e.isAggregate()?T.every(e.getEncodings(),function(e){return e.type===s.Type.TEMPORAL?!!e.timeUnit:e.type===s.Type.QUANTITATIVE?!!e.bin||!!e.aggregate||!!e.autoCount:!0}):!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[f.Property.CHANNEL,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!0,satisfy:function(e,t,r){return e.isAggregate()?!0:T.every(e.getEncodings(),function(e){return e.channel!==o.Channel.DETAIL})}},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[f.Property.FIELD],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,t,r){var n={};return T.every(e.getEncodings(),function(e){return e.field&&!p.isEnumSpec(e.field)?n[e.field]?!1:(n[e.field]=!0,!0):!0})}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[f.Property.CHANNEL],allowEnumSpecForProperties:!0,strict:!1,satisfy:function(e,t,r){var n=e.getEncodings();return 1!==n.length||n[0].channel!==o.Channel.Y}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[f.Property.CHANNEL,f.Property.MARK,f.Property.TYPE,f.Property.TIMEUNIT,f.Property.BIN,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){var n=e.getMark();switch(n){case u.Mark.AREA:case u.Mark.LINE:if(e.isAggregate()){var i=e.getEncodingQueryByChannel(o.Channel.X),a=e.getEncodingQueryByChannel(o.Channel.Y),c=i&&A.isMeasure(i),l=a&&A.isMeasure(a);return i&&a&&c!==l&&!(!c&&i.type===s.Type.NOMINAL)&&!(!l&&a.type===s.Type.NOMINAL)}return!0;case u.Mark.TEXT:return!0;case u.Mark.BAR:case u.Mark.TICK:return e.channelUsed(o.Channel.SIZE)?!1:e.isMeasure(o.Channel.X)!==e.isMeasure(o.Channel.Y);case u.Mark.CIRCLE:case u.Mark.POINT:case u.Mark.SQUARE:case u.Mark.RULE:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+n)}},{name:"omitNonSumStack",description:"Stacked plot should use summative aggregation such as sum, count, or distinct",properties:[f.Property.CHANNEL,f.Property.MARK,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){var n=e.stack();if(n){var i=e.getEncodingQueryByChannel(n.fieldChannel);return T.contains(a.SUM_OPS,i.aggregate)||!!i.autoCount}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both dimensions should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[f.Property.CHANNEL,f.Property.TYPE,f.Property.TIMEUNIT,f.Property.BIN,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowEnumSpecForProperties:!1,strict:!1,satisfy:function(e,t,r){return!(r.autoAddCount&&e.isDimension(o.Channel.X)&&e.isDimension(o.Channel.Y))||e.isAggregate()}}].map(function(e){return new S(e)}),r.SPEC_CONSTRAINT_INDEX=r.SPEC_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{}),r.SPEC_CONSTRAINTS_BY_PROPERTY=r.SPEC_CONSTRAINTS.reduce(function(e,t){return t.properties().forEach(function(r){e[r]=e[r]||[],e[r].push(t)}),e},{}),r.checkSpec=n},{"../enumspec":16,"../property":21,"../query/encoding":22,"../util":36,"./base":10,"vega-lite/src/aggregate":46,"vega-lite/src/channel":49,"vega-lite/src/mark":54,"vega-lite/src/scale":55,"vega-lite/src/type":59}],14:[function(e,t,r){"use strict";r.version="0.5.0";var n=e("./util");r.constraint=e("./constraint/constraint"),r.enumerate=e("./enumerator"),r.enumSpec=e("./enumspec");var i=e("./generate");r.generate=i.generate,r.model=e("./model"),r.nest=e("./nest"),r.property=e("./property");var a=e("./query/query"),o=e("./query/query");r.query=n.extend(o.query,a),r.ranking=e("./ranking/ranking"),r.schema=e("./schema"),r.util=e("./util")},{"./constraint/constraint":11,"./enumerator":15,"./enumspec":16,"./generate":18,"./model":19,"./nest":20,"./property":21,"./query/query":24,"./ranking/ranking":33,"./schema":34,"./util":36}],15:[function(e,t,r){"use strict";function n(e){return function(t,r,n){return function(o,u){function c(l){if(l===s.length)return void o.push(u.duplicate());var p=s[l],f=t.encodings[p][e],E=u.getEncodingQueryByIndex(p),T=u.getEncodingProperty(p,e);E.autoCount!==!1&&T?(f["enum"].forEach(function(t){null===t&&(t=void 0),u.setEncodingProperty(p,e,t,f);var o=i.checkEncoding(e,f,p,u,r,n);if(!o){var s=a.checkSpec(e,f,u,r,n);s||c(l+1)}}),u.resetEncodingProperty(p,e,f)):c(l+1)}var s=t.encodingIndicesByProperty[e];return c(0),o}}}var i=e("./constraint/encoding"),a=e("./constraint/spec"),o=e("./property");r.ENUMERATOR_INDEX={},r.ENUMERATOR_INDEX[o.Property.MARK]=function(e,t,r){return function(n,i){var u=i.getMark();return u["enum"].forEach(function(u){i.setMark(u);var c=a.checkSpec(o.Property.MARK,e.mark,i,t,r);c||n.push(i.duplicate())}),i.resetMark(),n}},o.ENCODING_PROPERTIES.forEach(function(e){r.ENUMERATOR_INDEX[e]=n(e)}),o.NESTED_ENCODING_PROPERTIES.forEach(function(e){r.ENUMERATOR_INDEX[e.property]=n(e.property)}),r.EncodingPropertyGeneratorFactory=n},{"./constraint/encoding":12,"./constraint/spec":13,"./property":21}],16:[function(e,t,r){"use strict";function n(e){return e===r.SHORT_ENUM_SPEC||void 0!==e&&(!!e["enum"]||!!e.name)&&!a.isArray(e)}function i(e,t,n){return a.extend({},{name:t,"enum":n},e===r.SHORT_ENUM_SPEC?{}:e)}var a=e("./util");!function(e){e[e.ENUMSPEC="?"]="ENUMSPEC"}(r.ShortEnumSpec||(r.ShortEnumSpec={}));var o=r.ShortEnumSpec;r.SHORT_ENUM_SPEC=o.ENUMSPEC,r.isEnumSpec=n,r.initEnumSpec=i},{"./util":36}],17:[function(e,t,r){"use strict";var n=e("./property"),i=e("./util"),a=function(){function e(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty={}}return e.prototype.setEncodingProperty=function(e,t,r){var n=this._encodings,i=n[e]=n[e]||{};i[t]=r;var a=this._encodingIndicesByProperty;return(a[t]=a[t]||[]).push(e),this},e.prototype.hasProperty=function(e){if(n.isEncodingProperty(e))return!!this.encodingIndicesByProperty[e];if(e===n.Property.MARK)return!!this.mark;throw new Error("Unimplemented for property "+e)},e.prototype.isEmpty=function(){return!this.mark&&0===i.keys(this.encodingIndicesByProperty).length},e.prototype.setMark=function(e){return this._mark=e,this},Object.defineProperty(e.prototype,"mark",{get:function(){return this._mark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodings",{get:function(){return this._encodings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodingIndicesByProperty",{get:function(){return this._encodingIndicesByProperty},enumerable:!0,configurable:!0}),e}();r.EnumSpecIndex=a},{"./property":21,"./util":36}],18:[function(e,t,r){"use strict";function n(e,t,r){void 0===r&&(r=a.DEFAULT_QUERY_CONFIG);var n=o.SpecQueryModel.build(e,t,r),c=n.enumSpecIndex,s=[n];return r.propertyPrecedence.forEach(function(e){if(c.hasProperty(e)){var n=i.ENUMERATOR_INDEX[e](c,t,r);s=s.reduce(n,[])}}),null!==r.nominalColorScaleForHighCardinality||null!==r.smallBandSizeForHighCardinalityOrFacet||null!==r.xAxisOnTopForHighYCardinalityWithoutColumn?u.stylize(s,t,r):s}var i=e("../src/enumerator"),a=e("./config"),o=e("./model"),u=e("./stylize");r.generate=n},{"../src/enumerator":15,"./config":9,"./model":19,"./stylize":35}],19:[function(e,t,r){"use strict";function n(e){switch(e){case u.Property.MARK:return"m";case u.Property.CHANNEL:return"c";case u.Property.AGGREGATE:return"a";case u.Property.AUTOCOUNT:return"#";case u.Property.BIN:return"b";case u.Property.BIN_MAXBINS:return"b-mb";case u.Property.SORT:return"so";case u.Property.SORT_FIELD:return"so-f";case u.Property.SORT_OP:return"so-op";case u.Property.SORT_ORDER:return"so-or";case u.Property.SCALE:return"s";case u.Property.SCALE_BANDSIZE:return"s-bs";case u.Property.SCALE_CLAMP:return"s-c";case u.Property.SCALE_DOMAIN:return"s-d";case u.Property.SCALE_EXPONENT:return"s-e";case u.Property.SCALE_NICE:return"s-n";case u.Property.SCALE_RANGE:return"s-ra";case u.Property.SCALE_ROUND:return"s-r";case u.Property.SCALE_TYPE:return"s-t";case u.Property.SCALE_USERAWDOMAIN:return"s-u";case u.Property.SCALE_ZERO:return"s-z";case u.Property.AXIS:return"ax";case u.Property.AXIS_AXISCOLOR:return"ax-ac";case u.Property.AXIS_AXISWIDTH:return"ax-aw";case u.Property.AXIS_LAYER:return"ax-lay";case u.Property.AXIS_OFFSET:return"ax-of";case u.Property.AXIS_ORIENT:return"ax-or";case u.Property.AXIS_GRID:return"ax-g";case u.Property.AXIS_GRIDCOLOR:return"ax-gc";case u.Property.AXIS_GRIDDASH:return"ax-gd";case u.Property.AXIS_GRIDOPACITY:return"ax-go";case u.Property.AXIS_GRIDWIDTH:return"ax-gw";case u.Property.AXIS_LABELS:return"ax-lab";case u.Property.AXIS_FORMAT:return"ax-f";case u.Property.AXIS_LABELANGLE:return"ax-labang";case u.Property.AXIS_LABELMAXLENGTH:return"ax-lablml";case u.Property.AXIS_SHORTTIMELABELS:return"ax-stl";case u.Property.AXIS_SUBDIVIDE:return"ax-s";case u.Property.AXIS_TICKS:return"ax-t";case u.Property.AXIS_TICKCOLOR:return"ax-tc";case u.Property.AXIS_TICKLABELCOLOR:return"ax-tlc";case u.Property.AXIS_TICKLABELFONT:return"ax-tlf";case u.Property.AXIS_TICKLABELFONTSIZE:return"ax-tlfs";case u.Property.AXIS_TICKPADDING:return"ax-tp";case u.Property.AXIS_TICKSIZE:return"ax-ts";case u.Property.AXIS_TICKSIZEMAJOR:return"ax-tsma";case u.Property.AXIS_TICKSIZEMINOR:return"ax-tsmi";case u.Property.AXIS_TICKSIZEEND:return"ax-tse";case u.Property.AXIS_TICKWIDTH:return"ax-tw";case u.Property.AXIS_VALUES:return"ax-v";case u.Property.AXIS_TITLE:return"ax-tit";case u.Property.AXIS_TITLECOLOR:return"ax-titc";case u.Property.AXIS_TITLEFONT:return"ax-titf";case u.Property.AXIS_TITLEFONTSIZE:return"ax-titfs";case u.Property.AXIS_TITLEFONTWEIGHT:return"ax-titfw";case u.Property.AXIS_TITLEOFFSET:return"ax-tito";case u.Property.AXIS_TITLEMAXLENGTH:return"ax-titml";case u.Property.AXIS_CHARACTERWIDTH:return"ax-cw";case u.Property.TIMEUNIT:return"tu";case u.Property.FIELD:return"f";case u.Property.TYPE:return"t"}throw new Error("Default name undefined")}function i(e,t,r){switch(e){case u.Property.FIELD:case u.Property.SORT_FIELD:return t.fields();case u.Property.AXIS:case u.Property.AXIS_GRID:case u.Property.AXIS_LABELS:case u.Property.AXIS_SHORTTIMELABELS:case u.Property.BIN:case u.Property.SCALE:case u.Property.SCALE_CLAMP:case u.Property.SCALE_NICE:case u.Property.SCALE_ROUND:case u.Property.SCALE_USERAWDOMAIN:case u.Property.SCALE_ZERO:case u.Property.AUTOCOUNT:return[!1,!0];case u.Property.AGGREGATE:return r.aggregates;case u.Property.AXIS_AXISCOLOR:return r.axisAxisColors;case u.Property.AXIS_AXISWIDTH:return r.axisAxisWidths;case u.Property.AXIS_LAYER:return r.axisLayers;case u.Property.AXIS_OFFSET:return r.axisOffsets;case u.Property.AXIS_ORIENT:return r.axisOrients;case u.Property.AXIS_GRIDCOLOR:return r.axisGridColors;case u.Property.AXIS_GRIDDASH:return r.axisGridDashes;case u.Property.AXIS_GRIDOPACITY:return r.axisGridOpacities;case u.Property.AXIS_GRIDWIDTH:return r.axisGridWidths;case u.Property.AXIS_FORMAT:return r.axisFormats;case u.Property.AXIS_LABELANGLE:return r.axisLabelAngles;case u.Property.AXIS_LABELMAXLENGTH:return r.axisLabelMaxLengths;case u.Property.AXIS_SUBDIVIDE:return r.axisSubDivides;case u.Property.AXIS_TICKS:return r.axisTicks;case u.Property.AXIS_TICKCOLOR:return r.axisTickColors;case u.Property.AXIS_TICKLABELCOLOR:return r.axisTickLabelColors;case u.Property.AXIS_TICKLABELFONT:return r.axisTickLabelFonts;case u.Property.AXIS_TICKLABELFONTSIZE:return r.axisTickLabelFontSizes;case u.Property.AXIS_TICKPADDING:return r.axisTickPaddings;case u.Property.AXIS_TICKSIZE:return r.axisTickSizes;case u.Property.AXIS_TICKSIZEMAJOR:return r.axisTickSizeMajors;case u.Property.AXIS_TICKSIZEMINOR:return r.axisTickSizeMinors;case u.Property.AXIS_TICKSIZEEND:return r.axisTickSizeEnds;case u.Property.AXIS_TICKWIDTH:return r.axisTickWidths;case u.Property.AXIS_VALUES:return r.axisValuesList;case u.Property.AXIS_TITLE:return r.axisTitles;case u.Property.AXIS_TITLECOLOR:return r.axisTitleColors;case u.Property.AXIS_TITLEFONT:return r.axisTitleFonts;case u.Property.AXIS_TITLEFONTWEIGHT:return r.axisTitleFontWeights;case u.Property.AXIS_TITLEFONTSIZE:return r.axisTitleFontSizes;case u.Property.AXIS_TITLEOFFSET:return r.axisTitleOffsets;case u.Property.AXIS_TITLEMAXLENGTH:return r.axisTitleMaxLengths;case u.Property.AXIS_CHARACTERWIDTH:return r.axisCharacterWidths;case u.Property.BIN_MAXBINS:return r.maxBinsList;case u.Property.CHANNEL:return r.channels;case u.Property.MARK:return r.marks;case u.Property.SORT:return r.sorts;case u.Property.SORT_OP:return r.sortOps;case u.Property.SORT_ORDER:return r.sortOrders;case u.Property.SCALE_BANDSIZE:return r.scaleBandSizes;case u.Property.SCALE_DOMAIN:return r.scaleDomains;case u.Property.SCALE_EXPONENT:return r.scaleExponents;case u.Property.SCALE_RANGE:return r.scaleRanges;case u.Property.SCALE_TYPE:return r.scaleTypes;case u.Property.TIMEUNIT:return r.timeUnits;case u.Property.TYPE:return r.types}throw new Error("No default enumValues for "+e)}var a=e("vega-lite/src/aggregate"),o=e("vega-lite/src/type"),u=e("./property"),c=e("./enumspec"),s=e("./enumspecindex"),l=e("./query/spec"),p=e("./query/encoding"),f=e("./query/shorthand"),E=e("./util");r.getDefaultName=n,r.getDefaultEnumValues=i;var T=function(){function e(e,t,r,n,i){this._rankingScore={},this._spec=e,this._channelCount=e.encodings.reduce(function(e,t){return c.isEnumSpec(t.channel)||t.autoCount===!1||(e[t.channel]=1),e},{}),this._enumSpecIndex=t,this._enumSpecAssignment=i,this._opt=n,this._schema=r}return e.build=function(t,r,a){var l=new s.EnumSpecIndex;if(c.isEnumSpec(t.mark)){var p=n(u.Property.MARK);t.mark=c.initEnumSpec(t.mark,p,a.marks),l.setMark(t.mark)}if(t.encodings.forEach(function(e,t){void 0!==e.autoCount&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=o.Type.QUANTITATIVE),void 0===e.type&&(e.type=c.SHORT_ENUM_SPEC),u.ENCODING_PROPERTIES.forEach(function(o){if(c.isEnumSpec(e[o])){var u=n(o)+t,s=i(o,r,a),p=e[o]=c.initEnumSpec(e[o],u,s);l.setEncodingProperty(t,o,p)}}),u.NESTED_ENCODING_PROPERTIES.forEach(function(o){var u=e[o.parent];if(u){var s=o.property,p=o.child;if(c.isEnumSpec(u[p])){var f=n(s)+t,E=i(s,r,a),T=u[p]=c.initEnumSpec(u[p],f,E);l.setEncodingProperty(t,s,T)}}})}),a.autoAddCount){var f={channel:{name:n(u.Property.CHANNEL)+t.encodings.length,"enum":i(u.Property.CHANNEL,r,a)},autoCount:{name:n(u.Property.AUTOCOUNT)+t.encodings.length,"enum":[!1,!0]},type:o.Type.QUANTITATIVE};t.encodings.push(f);var E=t.encodings.length-1;l.setEncodingProperty(E,u.Property.CHANNEL,f.channel),l.setEncodingProperty(E,u.Property.AUTOCOUNT,f.autoCount)}return new e(t,l,r,a,{})},Object.defineProperty(e.prototype,"enumSpecIndex",{get:function(){return this._enumSpecIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specQuery",{get:function(){return this._spec},enumerable:!0,configurable:!0}),e.prototype.duplicate=function(){return new e(E.duplicate(this._spec),this._enumSpecIndex,this._schema,this._opt,E.duplicate(this._enumSpecAssignment))},e.prototype.setMark=function(e){var t=this._spec.mark.name;this._enumSpecAssignment[t]=this._spec.mark=e},e.prototype.resetMark=function(){var e=this._spec.mark=this._enumSpecIndex.mark;delete this._enumSpecAssignment[e.name]},e.prototype.getMark=function(){return this._spec.mark},e.prototype.getEncodingProperty=function(e,t){var r=this._spec.encodings[e],n=u.getNestedEncodingProperty(t);return n?r[n.parent][n.child]:r[t]},e.prototype.setEncodingProperty=function(e,t,r,n){var i=this._spec.encodings[e],a=u.getNestedEncodingProperty(t);t===u.Property.CHANNEL&&i.channel&&!c.isEnumSpec(i.channel)&&this._channelCount[i.channel]--,a?i[a.parent][a.child]=r:u.hasNestedProperty(t)&&r===!0?i[t]=E.extend({},i[t],{"enum":void 0,name:void 0}):i[t]=r,this._enumSpecAssignment[n.name]=r,t===u.Property.CHANNEL&&(this._channelCount[r]=(this._channelCount[r]||0)+1)},e.prototype.resetEncodingProperty=function(e,t,r){var n=this._spec.encodings[e],i=u.getNestedEncodingProperty(t);t===u.Property.CHANNEL&&this._channelCount[n.channel]--,i?n[i.parent][i.child]=r:n[t]=r,delete this._enumSpecAssignment[r.name]},e.prototype.channelUsed=function(e){return this._channelCount[e]>0},e.prototype.stack=function(){return l.stack(this._spec)},e.prototype.getEncodings=function(){return this._spec.encodings.filter(function(e){return e.autoCount!==!1})},e.prototype.getEncodingQueryByChannel=function(e){for(var t=0;t<this._spec.encodings.length;t++)if(this._spec.encodings[t].channel===e)return this._spec.encodings[t]},e.prototype.getEncodingQueryByIndex=function(e){return this._spec.encodings[e]},e.prototype.isDimension=function(e){var t=this.getEncodingQueryByChannel(e);return t&&p.isDimension(t)},e.prototype.isMeasure=function(e){var t=this.getEncodingQueryByChannel(e);return t&&p.isMeasure(t)},e.prototype.isAggregate=function(){return l.isAggregate(this._spec)},e.prototype.toShorthand=function(){return f.spec(this._spec)},e.prototype._encoding=function(){for(var e={},t=0;t<this._spec.encodings.length;t++){var r=this._spec.encodings[t],n={};if(r.autoCount===!0)n.aggregate=a.AggregateOp.COUNT,n.field="*",n.type=o.Type.QUANTITATIVE;else if(r.autoCount===!1)continue;if(c.isEnumSpec(r.channel))return null;for(var i=[u.Property.AGGREGATE,u.Property.AXIS,u.Property.BIN,u.Property.SORT,u.Property.SCALE,u.Property.TIMEUNIT,u.Property.FIELD,u.Property.TYPE],s=0;s<i.length;s++){var l=i[s];if(c.isEnumSpec(r[l]))return null;void 0!==r[l]&&(n[l]=r[l])}r.bin&&E.isObject(r.bin)&&0===E.keys(r.bin).length&&(r.bin=!0),e[r.channel]=n}return e},e.prototype.toSpec=function(e){if(c.isEnumSpec(this._spec.mark))return null;var t={};return e=e||this._spec.data,e&&(t.data=e),this._spec.transform&&(t.transform=this._spec.transform),t.mark=this._spec.mark,t.encoding=this._encoding(),null===t.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(t.config=E.extend({},this._opt.defaultSpecConfig,this._spec.config)),t)},e.prototype.getRankingScore=function(e){return this._rankingScore[e]},e.prototype.setRankingScore=function(e,t){this._rankingScore[e]=t},e}();r.SpecQueryModel=T;var A=function(){function e(e,t,r,n,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=[]),void 0===n&&(n=void 0),void 0===i&&(i=void 0),this._name=e,this._path=t,this._items=r,this._groupBy=n,this._orderGroupBy=i}return e.prototype.getTopSpecQueryModel=function(){var t=this._items[0];return t instanceof e?t.getTopSpecQueryModel():t},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupBy",{get:function(){return this._groupBy},set:function(e){this._groupBy=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orderGroupBy",{get:function(){return this._orderGroupBy},set:function(e){this._orderGroupBy=e},enumerable:!0,configurable:!0}),e}();r.SpecQueryModelGroup=A},{"./enumspec":16,"./enumspecindex":17,"./property":21,"./query/encoding":22,"./query/shorthand":25,"./query/spec":26,"./util":36,"vega-lite/src/aggregate":46,"vega-lite/src/type":59
}],20:[function(e,t,r){"use strict";function n(e,t){A[e]=t}function i(e,t){if(t.nest){for(var r=new l.SpecQueryModelGroup,n={},i=[],a=[],o=[],u=function(e){i.push(e>0?p.duplicate(i[e-1]):{}),a.push(e>0?p.duplicate(a[e-1]):{});var r=t.nest[e].groupBy;if(c.isArray(r)){r.forEach(function(t){f.isExtendedGroupBy(t)?(i[e][t.property]=!0,a[e][t.property]=t.replace):i[e][t]=!0});var n=p.keys(a[e]).reduce(function(t,r){return t[r]=E.getReplacer(a[e][r]),t},{});o.push(n)}},s=0;s<t.nest.length;s++)u(s);return e.forEach(function(e){for(var a="",u=r,s=0;s<t.nest.length;s++){var p=u.groupBy=t.nest[s].groupBy;u.orderGroupBy=t.nest[s].orderGroupBy;var f=c.isArray(p)?E.spec(e.specQuery,i[s],o[s]):A[p](e);a+="/"+f,n[a]||(n[a]=new l.SpecQueryModelGroup(f,a,[]),u.items.push(n[a])),u=n[a]}u.items.push(e)}),r}return new l.SpecQueryModelGroup("","",e)}function a(e){if(s.isEnumSpec(e))return s.SHORT_ENUM_SPEC+"";var t=e;switch(t){case u.Channel.X:case u.Channel.Y:return"xy";case u.Channel.ROW:case u.Channel.COLUMN:return"facet";case u.Channel.COLOR:case u.Channel.SIZE:case u.Channel.SHAPE:case u.Channel.OPACITY:return"non-xy";case u.Channel.TEXT:case u.Channel.DETAIL:case u.Channel.PATH:case u.Channel.ORDER:return t+"";default:return console.warn("channel type not implemented for "+t),t+""}}function o(e){var t=T.stack(e.specQuery);return t?"stack="+t.offset+"|":""}var u=e("vega-lite/src/channel"),c=e("datalib/src/util"),s=e("./enumspec"),l=e("./model"),p=e("./util"),f=e("./query/groupby"),E=e("./query/shorthand"),T=e("./query/spec"),A={};r.registerKeyFn=n,r.FIELD="field",r.FIELD_TRANSFORM="fieldTransform",r.ENCODING="encoding",r.TRANSPOSE="transpose",r.SPEC="spec",r.nest=i,n(r.FIELD,function(e){return e.getEncodings().map(function(e){return e.field}).filter(function(e){return e&&"*"!==e}).sort().join("|")}),n(r.FIELD_TRANSFORM,function(e){return e.getEncodings().map(function(e){return E.fieldDef(e)}).sort().join("|")}),n(r.ENCODING,function(e){return o(e)+e.getEncodings().map(function(e){var t=E.fieldDef(e);return a(e.channel)+":"+t}).sort().join("|")}),n(r.TRANSPOSE,function(e){return e.getMark()+"|"+o(e)+e.getEncodings().map(function(e){var t=E.fieldDef(e),r=e.channel===u.Channel.X||e.channel===u.Channel.Y?"xy":e.channel===u.Channel.ROW||e.channel===u.Channel.COLUMN?"facet":e.channel;return r+":"+t}).sort().join("|")}),n(r.SPEC,function(e){return JSON.stringify(e.specQuery)})},{"./enumspec":16,"./model":19,"./query/groupby":23,"./query/shorthand":25,"./query/spec":26,"./util":36,"datalib/src/util":8,"vega-lite/src/channel":49}],21:[function(e,t,r){"use strict";function n(e){switch(e){case s.BIN:case s.SCALE:case s.SORT:case s.AXIS:return!0;case s.MARK:case s.FILTER:case s.CALCULATE:case s.STACK:case s.CHANNEL:case s.AGGREGATE:case s.AUTOCOUNT:case s.TIMEUNIT:case s.FIELD:case s.TYPE:case s.BIN_MAXBINS:case s.SCALE_BANDSIZE:case s.SCALE_CLAMP:case s.SCALE_DOMAIN:case s.SCALE_EXPONENT:case s.SCALE_NICE:case s.SCALE_RANGE:case s.SCALE_ROUND:case s.SCALE_TYPE:case s.SCALE_USERAWDOMAIN:case s.SCALE_ZERO:case s.AXIS_AXISCOLOR:case s.AXIS_AXISWIDTH:case s.AXIS_LAYER:case s.AXIS_OFFSET:case s.AXIS_ORIENT:case s.AXIS_GRID:case s.AXIS_GRIDCOLOR:case s.AXIS_GRIDDASH:case s.AXIS_GRIDOPACITY:case s.AXIS_GRIDWIDTH:case s.AXIS_LABELS:case s.AXIS_FORMAT:case s.AXIS_LABELANGLE:case s.AXIS_LABELMAXLENGTH:case s.AXIS_SHORTTIMELABELS:case s.AXIS_TICKS:case s.AXIS_SUBDIVIDE:case s.AXIS_TICKCOLOR:case s.AXIS_TICKLABELCOLOR:case s.AXIS_TICKLABELFONT:case s.AXIS_TICKLABELFONTSIZE:case s.AXIS_TICKPADDING:case s.AXIS_TICKSIZE:case s.AXIS_TICKSIZEMAJOR:case s.AXIS_TICKSIZEMINOR:case s.AXIS_TICKSIZEEND:case s.AXIS_TICKWIDTH:case s.AXIS_VALUES:case s.AXIS_TITLE:case s.AXIS_TITLECOLOR:case s.AXIS_TITLEFONT:case s.AXIS_TITLEFONTSIZE:case s.AXIS_TITLEFONTWEIGHT:case s.AXIS_CHARACTERWIDTH:case s.AXIS_TITLEMAXLENGTH:case s.AXIS_TITLEOFFSET:return!1}throw new Error("hasNestedProperty undefined for property "+e)}function i(e){return void 0!==f[e]}function a(e){return l[e]}function o(e){return p[e]}function u(e){return e in l}var c=e("vega-lite/src/scale");!function(e){e[e.MARK="mark"]="MARK",e[e.FILTER="filter"]="FILTER",e[e.CALCULATE="calculate"]="CALCULATE",e[e.STACK="stack"]="STACK",e[e.CHANNEL="channel"]="CHANNEL",e[e.AGGREGATE="aggregate"]="AGGREGATE",e[e.AUTOCOUNT="autoCount"]="AUTOCOUNT",e[e.BIN="bin"]="BIN",e[e.BIN_MAXBINS="binMaxBins"]="BIN_MAXBINS",e[e.TIMEUNIT="timeUnit"]="TIMEUNIT",e[e.FIELD="field"]="FIELD",e[e.TYPE="type"]="TYPE",e[e.SORT="sort"]="SORT",e[e.SORT_FIELD="sortField"]="SORT_FIELD",e[e.SORT_OP="sortOp"]="SORT_OP",e[e.SORT_ORDER="sortOrder"]="SORT_ORDER",e[e.SCALE="scale"]="SCALE",e[e.SCALE_BANDSIZE="scaleBandSize"]="SCALE_BANDSIZE",e[e.SCALE_CLAMP="scaleClamp"]="SCALE_CLAMP",e[e.SCALE_DOMAIN="scaleDomain"]="SCALE_DOMAIN",e[e.SCALE_EXPONENT="scaleExponent"]="SCALE_EXPONENT",e[e.SCALE_NICE="scaleNice"]="SCALE_NICE",e[e.SCALE_RANGE="scaleRange"]="SCALE_RANGE",e[e.SCALE_ROUND="scaleRound"]="SCALE_ROUND",e[e.SCALE_TYPE="scaleType"]="SCALE_TYPE",e[e.SCALE_USERAWDOMAIN="scaleUseRawDomain"]="SCALE_USERAWDOMAIN",e[e.SCALE_ZERO="scaleZero"]="SCALE_ZERO",e[e.AXIS="axis"]="AXIS",e[e.AXIS_AXISCOLOR="axisAxisColor"]="AXIS_AXISCOLOR",e[e.AXIS_AXISWIDTH="axisAxisWidth"]="AXIS_AXISWIDTH",e[e.AXIS_LAYER="axisLayer"]="AXIS_LAYER",e[e.AXIS_OFFSET="axisOffset"]="AXIS_OFFSET",e[e.AXIS_ORIENT="axisOrient"]="AXIS_ORIENT",e[e.AXIS_GRID="axisGrid"]="AXIS_GRID",e[e.AXIS_GRIDCOLOR="axisGridColor"]="AXIS_GRIDCOLOR",e[e.AXIS_GRIDDASH="axisGridDash"]="AXIS_GRIDDASH",e[e.AXIS_GRIDOPACITY="axisGridOpacity"]="AXIS_GRIDOPACITY",e[e.AXIS_GRIDWIDTH="axisGridWidth"]="AXIS_GRIDWIDTH",e[e.AXIS_LABELS="axisLabels"]="AXIS_LABELS",e[e.AXIS_FORMAT="axisFormat"]="AXIS_FORMAT",e[e.AXIS_LABELANGLE="axisLabelAngle"]="AXIS_LABELANGLE",e[e.AXIS_LABELMAXLENGTH="axisLabelMaxLength"]="AXIS_LABELMAXLENGTH",e[e.AXIS_SHORTTIMELABELS="axisShortTimeLabels"]="AXIS_SHORTTIMELABELS",e[e.AXIS_SUBDIVIDE="axisSubdivide"]="AXIS_SUBDIVIDE",e[e.AXIS_TICKS="axisTicks"]="AXIS_TICKS",e[e.AXIS_TICKCOLOR="axisTickColor"]="AXIS_TICKCOLOR",e[e.AXIS_TICKLABELCOLOR="axisTickLabelColor"]="AXIS_TICKLABELCOLOR",e[e.AXIS_TICKLABELFONT="axisTickLabelFont"]="AXIS_TICKLABELFONT",e[e.AXIS_TICKLABELFONTSIZE="axisTickLabelFontSize"]="AXIS_TICKLABELFONTSIZE",e[e.AXIS_TICKPADDING="axisTickPadding"]="AXIS_TICKPADDING",e[e.AXIS_TICKSIZE="axisTickSize"]="AXIS_TICKSIZE",e[e.AXIS_TICKSIZEMAJOR="axisTickSizeMajor"]="AXIS_TICKSIZEMAJOR",e[e.AXIS_TICKSIZEMINOR="axisTickSizeMinor"]="AXIS_TICKSIZEMINOR",e[e.AXIS_TICKSIZEEND="axisTickSizeEnd"]="AXIS_TICKSIZEEND",e[e.AXIS_TICKWIDTH="axisTickWidth"]="AXIS_TICKWIDTH",e[e.AXIS_VALUES="axisValues"]="AXIS_VALUES",e[e.AXIS_TITLE="axisTitle"]="AXIS_TITLE",e[e.AXIS_TITLECOLOR="axisTitleColor"]="AXIS_TITLECOLOR",e[e.AXIS_TITLEFONT="axisTitleFont"]="AXIS_TITLEFONT",e[e.AXIS_TITLEFONTSIZE="axisTitleFontSize"]="AXIS_TITLEFONTSIZE",e[e.AXIS_TITLEFONTWEIGHT="axisTitleFontWeight"]="AXIS_TITLEFONTWEIGHT",e[e.AXIS_TITLEOFFSET="axisTitleOffset"]="AXIS_TITLEOFFSET",e[e.AXIS_TITLEMAXLENGTH="axisTitleMaxLength"]="AXIS_TITLEMAXLENGTH",e[e.AXIS_CHARACTERWIDTH="axisCharacterWidth"]="AXIS_CHARACTERWIDTH",e[e.LEGEND="legend"]="LEGEND"}(r.Property||(r.Property={}));var s=r.Property;r.hasNestedProperty=n,r.ENCODING_PROPERTIES=[s.CHANNEL,s.BIN,s.BIN_MAXBINS,s.TIMEUNIT,s.AGGREGATE,s.AUTOCOUNT,s.FIELD,s.TYPE,s.SORT,s.SORT_FIELD,s.SORT_OP,s.SORT_ORDER,s.SCALE,s.SCALE_BANDSIZE,s.SCALE_CLAMP,s.SCALE_DOMAIN,s.SCALE_EXPONENT,s.SCALE_NICE,s.SCALE_RANGE,s.SCALE_ROUND,s.SCALE_TYPE,s.SCALE_USERAWDOMAIN,s.SCALE_ZERO,s.AXIS,s.AXIS_AXISCOLOR,s.AXIS_AXISWIDTH,s.AXIS_CHARACTERWIDTH,s.AXIS_FORMAT,s.AXIS_GRID,s.AXIS_GRIDCOLOR,s.AXIS_GRIDDASH,s.AXIS_GRIDOPACITY,s.AXIS_GRIDWIDTH,s.AXIS_LABELANGLE,s.AXIS_LABELMAXLENGTH,s.AXIS_LABELS,s.AXIS_LAYER,s.AXIS_OFFSET,s.AXIS_ORIENT,s.AXIS_SHORTTIMELABELS,s.AXIS_SUBDIVIDE,s.AXIS_TICKCOLOR,s.AXIS_TICKLABELCOLOR,s.AXIS_TICKLABELFONT,s.AXIS_TICKLABELFONTSIZE,s.AXIS_TICKPADDING,s.AXIS_TICKS,s.AXIS_TICKSIZE,s.AXIS_TICKSIZEEND,s.AXIS_TICKSIZEMAJOR,s.AXIS_TICKSIZEMINOR,s.AXIS_TICKWIDTH,s.AXIS_TITLE,s.AXIS_TITLECOLOR,s.AXIS_TITLEFONT,s.AXIS_TITLEFONTSIZE,s.AXIS_TITLEFONTWEIGHT,s.AXIS_TITLEMAXLENGTH,s.AXIS_TITLEOFFSET,s.AXIS_VALUES],r.DEFAULT_PROPERTY_PRECEDENCE=[s.TYPE,s.FIELD,s.BIN,s.TIMEUNIT,s.AGGREGATE,s.AUTOCOUNT,s.SORT,s.SORT_FIELD,s.SORT_OP,s.SORT_ORDER,s.BIN_MAXBINS,s.CHANNEL,s.MARK,s.SCALE,s.AXIS,s.SCALE_BANDSIZE,s.SCALE_CLAMP,s.SCALE_DOMAIN,s.SCALE_EXPONENT,s.SCALE_NICE,s.SCALE_RANGE,s.SCALE_ROUND,s.SCALE_TYPE,s.SCALE_USERAWDOMAIN,s.SCALE_ZERO,s.AXIS_AXISCOLOR,s.AXIS_AXISWIDTH,s.AXIS_CHARACTERWIDTH,s.AXIS_FORMAT,s.AXIS_GRID,s.AXIS_GRIDCOLOR,s.AXIS_GRIDDASH,s.AXIS_GRIDOPACITY,s.AXIS_GRIDWIDTH,s.AXIS_LABELANGLE,s.AXIS_LABELMAXLENGTH,s.AXIS_LABELS,s.AXIS_LAYER,s.AXIS_OFFSET,s.AXIS_ORIENT,s.AXIS_SHORTTIMELABELS,s.AXIS_SUBDIVIDE,s.AXIS_TICKCOLOR,s.AXIS_TICKLABELCOLOR,s.AXIS_TICKLABELFONT,s.AXIS_TICKLABELFONTSIZE,s.AXIS_TICKPADDING,s.AXIS_TICKS,s.AXIS_TICKSIZE,s.AXIS_TICKSIZEEND,s.AXIS_TICKSIZEMAJOR,s.AXIS_TICKSIZEMINOR,s.AXIS_TICKWIDTH,s.AXIS_TITLE,s.AXIS_TITLECOLOR,s.AXIS_TITLEFONT,s.AXIS_TITLEFONTSIZE,s.AXIS_TITLEFONTWEIGHT,s.AXIS_TITLEMAXLENGTH,s.AXIS_TITLEOFFSET,s.AXIS_VALUES],r.NESTED_ENCODING_PROPERTIES=[{property:s.BIN_MAXBINS,parent:"bin",child:"maxbins"},{property:s.SORT_FIELD,parent:"sort",child:"field"},{property:s.SORT_OP,parent:"sort",child:"op"},{property:s.SORT_ORDER,parent:"sort",child:"order"},{property:s.SCALE_BANDSIZE,parent:"scale",child:"bandSize"},{property:s.SCALE_CLAMP,parent:"scale",child:"clamp"},{property:s.SCALE_DOMAIN,parent:"scale",child:"domain"},{property:s.SCALE_EXPONENT,parent:"scale",child:"exponent"},{property:s.SCALE_NICE,parent:"scale",child:"nice"},{property:s.SCALE_RANGE,parent:"scale",child:"range"},{property:s.SCALE_ROUND,parent:"scale",child:"round"},{property:s.SCALE_TYPE,parent:"scale",child:"type"},{property:s.SCALE_USERAWDOMAIN,parent:"scale",child:"useRawDomain"},{property:s.SCALE_ZERO,parent:"scale",child:"zero"},{property:s.AXIS_AXISCOLOR,parent:"axis",child:"axisColor"},{property:s.AXIS_AXISWIDTH,parent:"axis",child:"axisWidth"},{property:s.AXIS_LAYER,parent:"axis",child:"layer"},{property:s.AXIS_OFFSET,parent:"axis",child:"offset"},{property:s.AXIS_ORIENT,parent:"axis",child:"orient"},{property:s.AXIS_GRID,parent:"axis",child:"grid"},{property:s.AXIS_GRIDCOLOR,parent:"axis",child:"gridColor"},{property:s.AXIS_GRIDDASH,parent:"axis",child:"gridDash"},{property:s.AXIS_GRIDOPACITY,parent:"axis",child:"gridOpacity"},{property:s.AXIS_GRIDWIDTH,parent:"axis",child:"gridWidth"},{property:s.AXIS_LABELS,parent:"axis",child:"labels"},{property:s.AXIS_FORMAT,parent:"axis",child:"format"},{property:s.AXIS_LABELANGLE,parent:"axis",child:"labelAngle"},{property:s.AXIS_LABELMAXLENGTH,parent:"axis",child:"labelMaxLength"},{property:s.AXIS_SHORTTIMELABELS,parent:"axis",child:"shortTimeLabels"},{property:s.AXIS_TICKS,parent:"axis",child:"ticks"},{property:s.AXIS_SUBDIVIDE,parent:"axis",child:"subdivide"},{property:s.AXIS_TICKCOLOR,parent:"axis",child:"tickColor"},{property:s.AXIS_TICKLABELCOLOR,parent:"axis",child:"tickLabelColor"},{property:s.AXIS_TICKLABELFONT,parent:"axis",child:"tickLabelFont"},{property:s.AXIS_TICKLABELFONTSIZE,parent:"axis",child:"tickLabelFontSize"},{property:s.AXIS_TICKPADDING,parent:"axis",child:"tickPadding"},{property:s.AXIS_TICKSIZE,parent:"axis",child:"tickSize"},{property:s.AXIS_TICKSIZEMAJOR,parent:"axis",child:"tickSizeMajor"},{property:s.AXIS_TICKSIZEMINOR,parent:"axis",child:"tickSizeMinor"},{property:s.AXIS_TICKSIZEEND,parent:"axis",child:"tickSizeEnd"},{property:s.AXIS_TICKWIDTH,parent:"axis",child:"tickWidth"},{property:s.AXIS_VALUES,parent:"axis",child:"values"},{property:s.AXIS_TITLE,parent:"axis",child:"title"},{property:s.AXIS_TITLECOLOR,parent:"axis",child:"titleColor"},{property:s.AXIS_TITLEFONT,parent:"axis",child:"titleFont"},{property:s.AXIS_TITLEFONTSIZE,parent:"axis",child:"titleFontSize"},{property:s.AXIS_TITLEFONTWEIGHT,parent:"axis",child:"titleFontWeight"},{property:s.AXIS_CHARACTERWIDTH,parent:"axis",child:"characterWidth"},{property:s.AXIS_TITLEMAXLENGTH,parent:"axis",child:"titleMaxLength"},{property:s.AXIS_TITLEOFFSET,parent:"axis",child:"titleOffset"}];var l=r.NESTED_ENCODING_PROPERTIES.reduce(function(e,t){return e[t.property]=t,e},{}),p=r.NESTED_ENCODING_PROPERTIES.reduce(function(e,t){var r=t.parent;return r in e||(e[r]=[]),e[t.parent].push(t),e},{});r.SCALE_PROPERTIES=p.scale.map(function(e){return e.property});var f=r.ENCODING_PROPERTIES.reduce(function(e,t){return e[t]=t,e},{});r.isEncodingProperty=i,r.getNestedEncodingProperty=a,r.getNestedEncodingPropertyChildren=o,r.isNestedEncodingProperty=u;var E=[{property:"bandSize",supportedScaleType:[c.ScaleType.ORDINAL]},{property:"clamp",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"domain",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.ORDINAL,c.ScaleType.SQRT,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"exponent",supportedScaleType:[c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.SQRT]},{property:"nice",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"range",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.ORDINAL,c.ScaleType.SQRT,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"round",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.SQRT,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"useRawDomain",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.ORDINAL,c.ScaleType.SQRT,c.ScaleType.TIME,c.ScaleType.UTC]},{property:"zero",supportedScaleType:[c.ScaleType.LINEAR,c.ScaleType.POW,c.ScaleType.SQRT]}];r.SUPPORTED_SCALE_PROPERTY_INDEX=E.reduce(function(e,t){var r=t.property;return e[r]=t.supportedScaleType,e},{})},{"vega-lite/src/scale":55}],22:[function(e,t,r){"use strict";function n(e){return l.contains([c.Type.NOMINAL,c.Type.ORDINAL],e.type)||!s.isEnumSpec(e.bin)&&!!e.bin||!s.isEnumSpec(e.timeUnit)&&!!e.timeUnit}function i(e){return e.type===c.Type.QUANTITATIVE&&!e.bin||e.type===c.Type.TEMPORAL&&!e.timeUnit}function a(e){var t=e.scale===!0||e.scale===s.SHORT_ENUM_SPEC?{}:e.scale,r=e.type,n=e.timeUnit;if(t&&void 0!==t.type)return t.type;if(!s.isEnumSpec(r)){if(r===c.Type.QUANTITATIVE)return o.ScaleType.LINEAR;if(r===c.Type.ORDINAL||r===c.Type.NOMINAL)return o.ScaleType.ORDINAL;if(r===c.Type.TEMPORAL){if(void 0!==n){if(s.isEnumSpec(n))return;return u.defaultScaleType(n)}return o.ScaleType.TIME}throw new Error("Unsupported type: "+r+" in scaleType")}}var o=e("vega-lite/src/scale"),u=e("vega-lite/src/timeunit"),c=e("vega-lite/src/type"),s=e("../enumspec"),l=e("../util");r.isDimension=n,r.isMeasure=i,r.scaleType=a},{"../enumspec":16,"../util":36,"vega-lite/src/scale":55,"vega-lite/src/timeunit":58,"vega-lite/src/type":59}],23:[function(e,t,r){"use strict";function n(e){return a.isObject(e)&&!!e.property}function i(e){return a.isArray(e)?e.map(function(e){if(n(e)){if(e.replace){var t=o.keys(e.replace).reduce(function(t,r){var n=e.replace[r];return(t[n]=t[n]||[]).push(r),t},{});return e.property+"["+o.keys(t).map(function(e){var r=t[e].sort();return r.join(",")+"=>"+e}).join(";")+"]"}return e.property}return e}).join(","):e}var a=e("datalib/src/util"),o=e("../util");r.REPLACE_BLANK_FIELDS={"*":""},r.REPLACE_XY_CHANNELS={x:"xy",y:"xy"},r.REPLACE_FACET_CHANNELS={row:"facet",column:"facet"},r.REPLACE_MARK_STYLE_CHANNELS={color:"style",opacity:"style",shape:"style",size:"style"},r.isExtendedGroupBy=n,r.toString=i},{"../util":36,"datalib/src/util":8}],24:[function(e,t,r){"use strict";function n(e,t,r){e=s.extend({},i(e),{config:s.extend({},a.DEFAULT_QUERY_CONFIG,r,e.config)});var n=o.generate(e.spec,t,e.config),l=u.nest(n,e),p=c.rank(l,e,t,0);return{query:e,result:p}}function i(e){if(e.groupBy){var t={groupBy:e.groupBy};e.orderBy&&(t.orderGroupBy=e.orderBy);var r={spec:s.duplicate(e.spec),nest:[t]};return e.chooseBy&&(r.chooseBy=e.chooseBy),e.config&&(r.config=e.config),r}return s.duplicate(e)}var a=e("../config"),o=e("../generate"),u=e("../nest"),c=e("../ranking/ranking"),s=e("../util");r.encoding=e("./encoding"),r.groupBy=e("./groupby"),r.shorthand=e("./shorthand"),r.spec=e("./spec"),r.transform=e("./transform"),r.query=n,r.normalize=i},{"../config":9,"../generate":18,"../nest":20,"../ranking/ranking":33,"../util":36,"./encoding":22,"./groupby":23,"./shorthand":25,"./spec":26,"./transform":27}],25:[function(e,t,r){"use strict";function n(e){return function(t){return void 0!==e[t]?e[t]:t}}function i(e,t){return T.isEnumSpec(e)?T.SHORT_ENUM_SPEC:t?t(e):e}function a(e,t,n){void 0===t&&(t=r.INCLUDE_ALL),void 0===n&&(n={});var a=[];if(t[A.Property.MARK]&&a.push(i(e.mark,n[A.Property.MARK])),e.transform&&(t[A.Property.CALCULATE]&&void 0!==e.transform.calculate&&a.push("calculate:"+u(e.transform.calculate)),t[A.Property.FILTER]&&void 0!==e.transform.filter&&a.push("filter:"+o(e.transform.filter))),t[A.Property.STACK]){var l=E.stack(e);if(l){var p=S.extend({},t,{type:!1}),f=s(l.fieldEncQ,p,n),T=s(l.groupByEncQ,p,n);a.push("stack={field:"+f+","+(T?"by:"+T+",":"")+"offset:"+l.offset+"}")}}return a.push(e.encodings.reduce(function(e,r){if(r.autoCount!==!1){var i=c(r,t,n);i&&e.push(i)}return e},[]).sort().join("|")),a.join("|")}function o(e){if(e instanceof Array){var t=e.map(o);return t.length>1?"("+t.join(") && (")+")":t[0]}return"string"==typeof e?e:l.expression(e)}function u(e){return e.map(function(e){return"{"+e.field+":"+e.expr+"}"}).join(",")}function c(e,t,n){void 0===t&&(t=r.INCLUDE_ALL),void 0===n&&(n={});var a=[];t[A.Property.CHANNEL]&&a.push(i(e.channel,n[A.Property.CHANNEL]));var o=s(e,t,n);return o&&a.push(o),a.join(":")}function s(e,t,n){void 0===t&&(t=r.INCLUDE_ALL),void 0===n&&(n={});var a=null,o=[];if(t[A.Property.AGGREGATE]&&e.autoCount===!1)return"-";if(t[A.Property.AGGREGATE]&&e.aggregate&&!T.isEnumSpec(e.aggregate))a=i(e.aggregate,n[A.Property.AGGREGATE]);else if(t[A.Property.AGGREGATE]&&e.autoCount&&!T.isEnumSpec(e.autoCount))a=i("count",n[A.Property.AGGREGATE]);else if(t[A.Property.TIMEUNIT]&&e.timeUnit&&!T.isEnumSpec(e.timeUnit))a=i(e.timeUnit,n[A.Property.TIMEUNIT]);else if(t[A.Property.BIN]&&e.bin&&!T.isEnumSpec(e.bin))a="bin",t[A.Property.BIN_MAXBINS]&&e.bin.maxbins&&o.push({key:"maxbins",value:i(e.bin.maxbins,n[A.Property.BIN_MAXBINS])});else for(var u=0,c=[A.Property.AGGREGATE,A.Property.AUTOCOUNT,A.Property.TIMEUNIT,A.Property.BIN];u<c.length;u++){var s=c[u];if(t[s]&&e[s]&&T.isEnumSpec(e[s])){a=T.SHORT_ENUM_SPEC+"";break}}for(var l=function(r){if(t[r])if(e[r]&&!T.isEnumSpec(e[r]))if(f.isString(e[r]))o.push({key:r+"",value:e[r]});else{var a=A.getNestedEncodingPropertyChildren(r),u=a.reduce(function(a,o){return t[o.property]&&void 0!==e[r][o.child]&&(a[o.child]=i(e[r][o.child],n[o.property])),a},{});S.keys(u).length>0&&o.push({key:r+"",value:JSON.stringify(u)})}else e[r]!==!1&&null!==e[r]||o.push({key:r+"",value:!1})},E=0,d=[A.Property.AXIS,A.Property.SCALE,A.Property.SORT];E<d.length;E++){var y=d[E];l(y)}var I=t[A.Property.FIELD]?i(e.field||"*",n[A.Property.FIELD]):"...";if(t[A.Property.TYPE]){var h=((e.type||p.Type.QUANTITATIVE)+"").substr(0,1);I+=","+i(h,n[A.Property.TYPE])}return I+=o.map(function(e){return","+e.key+"="+e.value}).join(""),a?a+"("+I+")":I}var l=e("vega-lite/src/filter"),p=e("vega-lite/src/type"),f=e("datalib/src/util"),E=e("./spec"),T=e("../enumspec"),A=e("../property"),S=e("../util");r.getReplacer=n,r.value=i,r.INCLUDE_ALL=A.DEFAULT_PROPERTY_PRECEDENCE.concat([A.Property.STACK,A.Property.FILTER,A.Property.CALCULATE]).reduce(function(e,t){return e[t]=!0,e},{}),r.spec=a,r.filter=o,r.calculate=u,r.encoding=c,r.fieldDef=s},{"../enumspec":16,"../property":21,"../util":36,"./spec":26,"datalib/src/util":8,"vega-lite/src/filter":53,"vega-lite/src/type":59}],26:[function(e,t,r){"use strict";function n(e){return p.extend(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},{mark:e.mark,encodings:p.keys(e.encoding).map(function(t){for(var r={channel:t},n=e.encoding[t],i=0,a=l.ENCODING_PROPERTIES;i<a.length;i++){var o=a[i];l.isNestedEncodingProperty(o)||void 0===n[o]||(r[o]=n[o]),p.contains([l.Property.SCALE,l.Property.AXIS,l.Property.LEGEND],o)&&null===r[o]&&(r[o]=!1)}return r})},e.config?{config:e.config}:{})}function i(e){return p.some(e.encodings,function(e){return!s.isEnumSpec(e.aggregate)&&!!e.aggregate||e.autoCount===!0})}function a(e){var t=e.config,r=t&&t.mark?t.mark.stacked:void 0;if(p.contains([c.StackOffset.NONE,null,!1],r))return null;if(!p.contains([u.BAR,u.AREA],e.mark))return null;if(!i(e))return null;var n=e.encodings.reduce(function(e,t){return p.contains(o.STACK_GROUP_CHANNELS,t.channel)&&!t.aggregate&&e.push(t.channel),e},[]);if(0===n.length)return null;var a=e.encodings.reduce(function(e,t){return e||(t.channel===o.Channel.X?t:null)},null),s=e.encodings.reduce(function(e,t){return e||(t.channel===o.Channel.Y?t:null)},null),l=!(!a||!a.aggregate&&!a.autoCount),f=!(!s||!s.aggregate&&!s.autoCount);return l!==f?{groupbyChannel:l?s?o.Y:null:a?o.X:null,groupByEncQ:l?s:a,fieldChannel:l?o.X:o.Y,fieldEncQ:l?a:s,stackByChannels:n,offset:r||c.StackOffset.ZERO}:null}var o=e("vega-lite/src/channel"),u=e("vega-lite/src/mark"),c=e("vega-lite/src/stack"),s=e("../enumspec"),l=e("../property"),p=e("../util");r.fromSpec=n,r.isAggregate=i,r.stack=a},{"../enumspec":16,"../property":21,"../util":36,"vega-lite/src/channel":49,"vega-lite/src/mark":54,"vega-lite/src/stack":57}],27:[function(e,t,r){"use strict"},{}],28:[function(e,t,r){"use strict";function n(e,t,r){var n=i(e,t,r);return{score:n.score,features:[n]}}function i(e,t,n){var i=e.getEncodings();if(e.isAggregate()){var s=function(e){return e.type===o.Type.QUANTITATIVE&&!e.bin&&!e.aggregate&&!e.autoCount||e.type===o.Type.TEMPORAL&&!e.timeUnit};return u.some(i,s)?{type:r.name,score:.1,feature:"Aggregate with raw continuous"}:u.some(i,c.isDimension)?u.some(i,function(e){return e.aggregate===a.AggregateOp.COUNT})?{type:r.name,score:.8,feature:"Aggregate with count"}:{type:r.name,score:.9,feature:"Aggregate without count"}:{type:r.name,score:.3,feature:"Aggregate without dimension"}}return u.some(i,c.isMeasure)?{type:r.name,score:1,feature:"Raw with measure"}:{type:r.name,score:.2,feature:"Raw without measure"}}var a=e("vega-lite/src/aggregate"),o=e("vega-lite/src/type"),u=e("../util"),c=e("../query/encoding");r.name="aggregationQuality",r.score=n},{"../query/encoding":22,"../util":36,"vega-lite/src/aggregate":46,"vega-lite/src/type":59}],29:[function(e,t,r){"use strict";var n,i=e("vega-lite/src/channel"),a=e("../../config"),o=e("../../query/shorthand"),u=e("../../util"),c=e("./effectiveness"),s=e("./type");!function(e){function t(){var e={},t={x:0,y:0,size:-.55,color:-.6,opacity:-.75,text:-.775,row:-.8,column:-.8,shape:-2.5,detail:-3};[s.Q,s.BIN_Q,s.T,s.TIMEUNIT_T,s.TIMEUNIT_O,s.O].forEach(function(n){u.keys(t).forEach(function(i){e[r(n,i)]=t[i]})}),[s.BIN_Q,s.TIMEUNIT_T,s.TIMEUNIT_O,s.O].forEach(function(t){[i.Channel.ROW,i.Channel.COLUMN].forEach(function(n){e[r(t,n)]+=.15})});var n={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,size:-1.8,detail:-2,opacity:-2.1};return u.keys(n).forEach(function(t){e[r(s.N,t)]=n[t]}),e}function r(e,t){return e+"_"+t}function n(t,n,i){var a=t.getEncodings().reduce(function(e,t){var r=o.fieldDef(t);return(e[r]=e[r]||[]).push(t),e},{}),l=[];return u.forEach(a,function(t){var n=t.reduce(function(t,n){var i=s.getExtendedType(n),a=r(i,n.channel),o=c.getFeatureScore(e.TYPE_CHANNEL,a);return null===t||o.score>t.score?o:t},null);l.push(n)}),l}e.TYPE_CHANNEL="typeChannel",e.init=t,e.featurize=r,e.getScore=n}(n=r.TypeChannelScore||(r.TypeChannelScore={}));var l;!function(e){function t(e){void 0===e&&(e={}),e=u.extend({},a.DEFAULT_QUERY_CONFIG,e);var t={},r=[{feature:s.BIN_Q,opt:"preferredBinAxis"},{feature:s.T,opt:"preferredTemporalAxis"},{feature:s.TIMEUNIT_T,opt:"preferredTemporalAxis"},{feature:s.TIMEUNIT_O,opt:"preferredTemporalAxis"},{feature:s.O,opt:"preferredOrdinalAxis"},{feature:s.N,opt:"preferredNominalAxis"}];return r.forEach(function(r){e[r.opt]===i.Channel.X?t[r.feature+"_"+i.Channel.Y]=-.01:e[r.opt]===i.Channel.Y&&(t[r.feature+"_"+i.Channel.X]=-.01)}),t}function r(e,t){return e+"_"+t}function n(t,n,i){return t.getEncodings().reduce(function(t,n){var i=s.getExtendedType(n),a=r(i,n.channel),o=c.getFeatureScore(e.PREFERRED_AXIS,a);return o&&t.push(o),t},[])}e.PREFERRED_AXIS="preferredAxis",e.init=t,e.featurize=r,e.getScore=n}(l=r.PreferredAxisScore||(r.PreferredAxisScore={}));var p;!function(e){function t(e){e=u.extend({},a.DEFAULT_QUERY_CONFIG,e);var t={};return e.preferredFacet===i.Channel.ROW?t[i.Channel.COLUMN]=-.01:e.preferredFacet===i.Channel.COLUMN&&(t[i.Channel.ROW]=-.01),t}function r(t,r,n){return t.getEncodings().reduce(function(t,r){var n=c.getFeatureScore(e.PREFERRED_FACET,r.channel);return n&&t.push(n),t},[])}e.PREFERRED_FACET="preferredFacet",e.init=t,e.getScore=r}(p=r.PreferredFacetScore||(r.PreferredFacetScore={}));var f;!function(e){function t(){return{bar_size:-2,tick_size:-2}}function r(t,r,n){var i=t.getMark();return t.getEncodings().reduce(function(t,r){var n=i+"_"+r.channel,a=c.getFeatureScore(e.MARK_CHANNEL,n);return a&&t.push(a),t},[])}e.MARK_CHANNEL="markChannel",e.init=t,e.getScore=r}(f=r.MarkChannelScore||(r.MarkChannelScore={}));var E;!function(e){function t(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}}function r(t,r,n){return t.isAggregate()&&t.getEncodings().reduce(function(t,r){if(!r.aggregate&&!r.autoCount){var n=c.getFeatureScore(e.DIMENSION,r.channel+"");if(n.score>t.score)return n}return t},{type:e.DIMENSION,feature:"No Dimension",score:-5}),[]}e.DIMENSION="dimension",e.init=t,e.getScore=r}(E=r.DimensionScore||(r.DimensionScore={}))},{"../../config":9,"../../query/shorthand":25,"../../util":36,"./effectiveness":30,"./type":32,"vega-lite/src/channel":49}],30:[function(e,t,r){"use strict";function n(e,t){var n=r.FEATURE_INDEX[e][t];return void 0!==n?{score:n,type:e,feature:t}:null}function i(e){c.push(e),r.FEATURE_INDEX[e.type]=e.init()}function a(e,t,r){var n=c.reduce(function(n,i){var a=i.getScore(e,t,r);return n.concat(a)},[]);return{score:n.reduce(function(e,t){return e+t.score},0),features:n}}var o=e("./channel"),u=e("./mark");r.FEATURE_INDEX={};var c=[];r.getFeatureScore=n,r.addFeatureFactory=i,i({type:o.TypeChannelScore.TYPE_CHANNEL,init:o.TypeChannelScore.init,getScore:o.TypeChannelScore.getScore}),i({type:o.PreferredAxisScore.PREFERRED_AXIS,init:o.PreferredAxisScore.init,getScore:o.PreferredAxisScore.getScore}),i({type:o.PreferredFacetScore.PREFERRED_FACET,init:o.PreferredFacetScore.init,getScore:o.PreferredFacetScore.getScore}),i({type:o.MarkChannelScore.MARK_CHANNEL,init:o.MarkChannelScore.init,getScore:o.MarkChannelScore.getScore}),i({type:u.MarkScore.MARK_SCORE,init:u.MarkScore.init,getScore:u.MarkScore.getScore}),Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{"./channel":29,"./mark":31}],31:[function(e,t,r){"use strict";var n,i=e("vega-lite/src/channel"),a=e("vega-lite/src/mark"),o=e("../../util"),u=e("./effectiveness"),c=e("./type");!function(e){function t(e,t,r,n){return e+"_"+t+"_"+r+"_"+n}function r(){var e=[c.Q,c.T],r=[c.BIN_Q,c.TIMEUNIT_O,c.O,c.N],n=r.concat([c.NONE]),i={};return e.forEach(function(r){e.forEach(function(e){var n={point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(n,function(n,a){var o=t(r,e,!0,a);i[o]=n});var a={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(a,function(n,a){var o=t(r,e,!1,a);i[o]=n})})}),e.forEach(function(e){n.forEach(function(r){var n={tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(n,function(n,a){var o=t(e,r,!0,a);i[o]=n;var u=t(r,e,!0,a);i[u]=n})}),[c.TIMEUNIT_T].forEach(function(r){var n={point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(n,function(n,a){var o=t(e,r,!0,a);i[o]=n;var u=t(r,e,!0,a);i[u]=n})}),[c.NONE,c.N,c.O].forEach(function(r){var n={bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5};o.forEach(n,function(n,a){var o=t(e,r,!1,a);i[o]=n;var u=t(r,e,!1,a);i[u]=n})}),[c.BIN_Q].forEach(function(r){var n={bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5};o.forEach(n,function(n,a){var o=t(e,r,!1,a);i[o]=n;var u=t(r,e,!1,a);i[u]=n})}),[c.TIMEUNIT_T,c.TIMEUNIT_O].forEach(function(r){var n={line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5};o.forEach(n,function(n,a){var o=t(e,r,!1,a);i[o]=n;var u=t(r,e,!1,a);i[u]=n})})}),[c.TIMEUNIT_T].forEach(function(e){[c.TIMEUNIT_T].forEach(function(r){var n={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(n,function(n,a){var o=t(e,r,!0,a);i[o]=n}),o.forEach(n,function(n,a){var o=t(e,r,!1,a);i[o]=n})}),n.forEach(function(r){var n={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(n,function(n,a){var o=t(e,r,!0,a);i[o]=n}),o.forEach(n,function(n,a){var o=t(r,e,!0,a);i[o]=n}),o.forEach(n,function(n,a){var o=t(e,r,!1,a);i[o]=n}),o.forEach(n,function(n,a){var o=t(r,e,!1,a);i[o]=n})})}),n.forEach(function(e){n.forEach(function(r){var n={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};o.forEach(n,function(n,a){var o=t(e,r,!0,a);i[o]=n}),o.forEach(n,function(n,a){var o=t(e,r,!1,a);i[o]=n})})}),i}function n(t,r,n){var o=t.getMark();o!==a.Mark.CIRCLE&&o!==a.Mark.SQUARE||(o=a.Mark.POINT);var s=t.getEncodingQueryByChannel(i.Channel.X),l=s?c.getExtendedType(s):c.NONE,p=t.getEncodingQueryByChannel(i.Channel.Y),f=p?c.getExtendedType(p):c.NONE,E=!t.isAggregate(),T=l+"_"+f+"_"+E+"_"+o,A=u.getFeatureScore(e.MARK_SCORE,T);return[A]}e.MARK_SCORE="markScore",e.featurize=t,e.init=r,e.getScore=n}(n=r.MarkScore||(r.MarkScore={}))},{"../../util":36,"./effectiveness":30,"./type":32,"vega-lite/src/channel":49,"vega-lite/src/mark":54}],32:[function(e,t,r){"use strict";function n(e){return e.bin?u.BIN_Q:e.timeUnit?o.scaleType(e)===i.ScaleType.ORDINAL?u.TIMEUNIT_O:u.TIMEUNIT_T:e.type}var i=e("vega-lite/src/scale"),a=e("vega-lite/src/type"),o=e("../../query/encoding");!function(e){e[e.Q=a.Type.QUANTITATIVE]="Q",e[e.BIN_Q="bin_"+a.Type.QUANTITATIVE]="BIN_Q",e[e.T=a.Type.TEMPORAL]="T",e[e.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",e[e.TIMEUNIT_O="timeUnit_"+a.Type.ORDINAL]="TIMEUNIT_O",e[e.O=a.Type.ORDINAL]="O",e[e.N=a.Type.NOMINAL]="N",e[e.NONE="-"]="NONE"}(r.ExtendedType||(r.ExtendedType={}));var u=r.ExtendedType;r.Q=u.Q,r.BIN_Q=u.BIN_Q,r.T=u.T,r.TIMEUNIT_T=u.TIMEUNIT_T,r.TIMEUNIT_O=u.TIMEUNIT_O,r.O=u.O,r.N=u.N,r.NONE=u.NONE,r.getExtendedType=n},{"../../query/encoding":22,"vega-lite/src/scale":55,"vega-lite/src/type":59}],33:[function(e,t,r){"use strict";function n(e,t){s[e]=t}function i(e){return s[e]}function a(e,t,r,n){return t.nest&&n!==t.nest.length?(e.items.forEach(function(e){a(e,t,r,n+1)}),t.nest[n].orderGroupBy&&e.items.sort(c(t.nest[n].orderGroupBy,r,t.config))):(t.orderBy||t.chooseBy)&&(e.items.sort(u(t.orderBy||t.chooseBy,r,t.config)),t.chooseBy&&e.items.length>0&&e.items.splice(1)),e}function o(e,t,r,n){if(void 0!==e.getRankingScore(t))return e.getRankingScore(t);var a=i(t),o=a(e,r,n);return e.setRankingScore(t,o),o}function u(e,t,r){return function(n,i){return o(i,e,t,r).score-o(n,e,t,r).score}}function c(e,t,r){return function(n,i){var a=n.getTopSpecQueryModel(),u=i.getTopSpecQueryModel();return o(u,e,t,r).score-o(a,e,t,r).score}}r.effectiveness=e("./effectiveness/effectiveness"),r.aggregation=e("./aggregation");var s={};r.register=n,r.get=i,r.rank=a,r.comparator=u,r.groupComparator=c,r.EFFECTIVENESS="effectiveness",n(r.EFFECTIVENESS,r.effectiveness["default"]),n(r.aggregation.name,r.aggregation.score)},{"./aggregation":28,"./effectiveness/effectiveness":30}],34:[function(e,t,r){"use strict";function n(e,t){var r=p({min:t.min,max:t.max,maxbins:e}),n=E.extend({},t);return n.unique=a(r,t.unique),
n.distinct=(r.stop-r.start)/r.step,n.min=r.start,n.max=r.stop,n}function i(e,t){var r=E.extend({},t),n={};return E.keys(t.unique).forEach(function(r){var i=new Date(r),a=(e===c.TimeUnit.DAY?i.getDay():c.convert(e,new Date(r))).toString();n[a]=n[a]?n[a]+t.unique[r]:t.unique[r]}),r.unique=n,r.distinct=E.keys(n).length,r}function a(e,t){var r={};for(var n in t){var i=e.value(Number(n));r[i]?r[i]+=t[n]:r[i]=t[n]}return r}var o=e("vega-lite/src/type"),u=e("vega-lite/src/bin"),c=e("vega-lite/src/timeunit"),s=e("datalib/src/stats"),l=e("datalib/src/import/type"),p=e("datalib/src/bins/bins"),f=e("./config"),E=e("./util"),T=function(){function e(e){this.fieldSchemas=e,this.fieldSchemaIndex=e.reduce(function(e,t){return e[t.field]=t,e},{})}return e.build=function(t,r){void 0===r&&(r={}),r=E.extend({},f.DEFAULT_QUERY_CONFIG,r);var a=s.summary(t),u=l.inferAll(t),c=a.map(function(e){var n,i=e.field,a=u[i],c=e.distinct;if(a===A.NUMBER)n=o.Type.QUANTITATIVE;else if(a===A.INTEGER)n=c/e.count<r.numberOrdinalProportion?e.max-e.min===c-1&&E.contains([0,1],e.min)?o.Type.NOMINAL:o.Type.ORDINAL:o.Type.QUANTITATIVE;else if(a===A.DATE){n=o.Type.TEMPORAL,e.min=new Date(t[0][i]),e.max=new Date(t[0][i]);for(var s=0;s<t.length;s++){var l=new Date(t[s][i]).getTime();l<e.min.getTime()&&(e.min=new Date(l)),l>e.max.getTime()&&(e.max=new Date(l))}}else n=o.Type.NOMINAL;return{field:i,type:n,primitiveType:a,stats:e,timeStats:{},binStats:{}}}),p={nominal:0,ordinal:1,temporal:2,quantitative:3};c.sort(function(e,t){return p[e.type]<p[t.type]?-1:p[e.type]>p[t.type]?1:e.field.localeCompare(t.field)});for(var T=0,S=c;T<S.length;T++){var d=S[T];if(d.type===o.Type.QUANTITATIVE)for(var y=0,I=r.maxBinsList;y<I.length;y++){var h=I[y];d.binStats[h]=n(h,d.stats)}else if(d.type===o.Type.TEMPORAL)for(var g=0,m=r.timeUnits;g<m.length;g++){var N=m[g];void 0!==N&&(d.timeStats[N]=i(N,d.stats))}}return new e(c)},e.prototype.fields=function(){return this.fieldSchemas.map(function(e){return e.field})},e.prototype.primitiveType=function(e){return this.fieldSchemaIndex[e]?this.fieldSchemaIndex[e].primitiveType:null},e.prototype.type=function(e){return this.fieldSchemaIndex[e]?this.fieldSchemaIndex[e].type:null},e.prototype.cardinality=function(e,t){void 0===t&&(t=!0);var r=this.fieldSchemaIndex[e.field];if(e.aggregate||e.autoCount)return 1;if(e.bin){var a;a="boolean"==typeof e.bin?{maxbins:u.autoMaxBins(e.channel)}:e.bin;var o=a.maxbins;return r.binStats[o]||(r.binStats[o]=n(o,r.stats)),r.binStats[o].distinct}if(e.timeUnit){if(t)switch(e.timeUnit){case c.TimeUnit.SECONDS:return 60;case c.TimeUnit.MINUTES:return 60;case c.TimeUnit.HOURS:return 24;case c.TimeUnit.DAY:return 7;case c.TimeUnit.DATE:return 31;case c.TimeUnit.MONTH:return 12;case c.TimeUnit.QUARTER:return 4;case c.TimeUnit.MILLISECONDS:return 1e3}return r.timeStats[e.timeUnit]||(r.timeStats[e.timeUnit]=i(e.timeUnit,r.stats)),r.timeStats[e.timeUnit].distinct}return r?r.stats.distinct:null},e.prototype.domain=function(e){var t=this.fieldSchemaIndex[e.field],r=E.keys(t.stats.unique);return t.type===o.Type.QUANTITATIVE||t.primitiveType===A.DATE?r=[t.stats.min,t.stats.max]:t.primitiveType!==A.INTEGER&&t.primitiveType!==A.NUMBER||(r=r.map(function(e){return+e})),r.sort()},e.prototype.stats=function(e){var t=this.fieldSchemaIndex[e.field];return t?t.stats:null},e}();r.Schema=T,function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATE="date"]="DATE"}(r.PrimitiveType||(r.PrimitiveType={}));var A=r.PrimitiveType},{"./config":9,"./util":36,"datalib/src/bins/bins":3,"datalib/src/import/type":5,"datalib/src/stats":6,"vega-lite/src/bin":48,"vega-lite/src/timeunit":58,"vega-lite/src/type":59}],35:[function(e,t,r){"use strict";function n(e,t,r){var n={};return e=e.map(function(e){return r.smallBandSizeForHighCardinalityOrFacet&&(e=i(e,t,n,r)),r.nominalColorScaleForHighCardinality&&(e=a(e,t,n,r)),r.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=o(e,t,n,r)),e})}function i(e,t,r,n){[c.Channel.ROW,c.Channel.Y,c.Channel.COLUMN,c.Channel.X].forEach(function(t){r[t]=e.getEncodingQueryByChannel(t)});var i=r[c.Channel.Y];void 0!==i&&(r[c.Channel.ROW]||t.cardinality(i)>n.smallBandSizeForHighCardinalityOrFacet.maxCardinality)&&(void 0===i.scale&&(i.scale={}),i.scale&&f.contains([s.ScaleType.ORDINAL,void 0],p.scaleType(i))&&(i.scale.bandSize||(i.scale.bandSize=12)));var a=r[c.Channel.X];return void 0!==a&&(r[c.Channel.COLUMN]||t.cardinality(a)>n.smallBandSizeForHighCardinalityOrFacet.maxCardinality)&&(void 0===a.scale&&(a.scale={}),a.scale&&f.contains([s.ScaleType.ORDINAL,void 0],p.scaleType(a))&&(a.scale.bandSize||(a.scale.bandSize=12))),e}function a(e,t,r,n){r[c.Channel.COLOR]=e.getEncodingQueryByChannel(c.Channel.COLOR);var i=r[c.Channel.COLOR];return void 0!==i&&i.type===l.Type.NOMINAL&&t.cardinality(i)>n.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.range=n.nominalColorScaleForHighCardinality.palette))),e}function o(e,t,r,n){if([c.Channel.COLUMN,c.Channel.X,c.Channel.Y].forEach(function(t){r[t]=e.getEncodingQueryByChannel(t)}),void 0===r[c.Channel.COLUMN]){var i=r[c.Channel.X],a=r[c.Channel.Y];void 0!==a&&a.field&&p.scaleType(a)===s.ScaleType.ORDINAL&&void 0!==i&&t.cardinality(a)>n.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===i.axis&&(i.axis={}),i.axis&&!i.axis.orient&&(i.axis.orient=u.AxisOrient.TOP))}return e}var u=e("vega-lite/src/axis"),c=e("vega-lite/src/channel"),s=e("vega-lite/src/scale"),l=e("vega-lite/src/type"),p=e("./query/encoding"),f=e("./util");r.stylize=n,r.smallBandSizeForHighCardinalityOrFacet=i,r.nominalColorScaleForHighCardinality=a,r.xAxisOnTopForHighYCardinalityWithoutColumn=o},{"./query/encoding":22,"./util":36,"vega-lite/src/axis":47,"vega-lite/src/channel":49,"vega-lite/src/scale":55,"vega-lite/src/type":59}],36:[function(e,t,r){"use strict";function n(e,t){return-1!==e.indexOf(t)}function i(e,t){var r,n=0;for(r in e)if(!t(e[r],r,n++))return!1;return!0}function a(e,t,r){if(e.forEach)e.forEach.call(r,t);else for(var n in e)t.call(r,e[n],n,e)}function o(e,t){var r,n=0;for(r in e)if(t(e[r],r,n++))return!0;return!1}function u(e,t){return e.map(function(e){return s.isArray(e)?u(e,t):t(e)})}function c(e,t){return e.filter(function(e){return!n(t,e)})}var s=e("datalib/src/util"),l=e("datalib/src/util");r.keys=l.keys,r.duplicate=l.duplicate,r.extend=l.extend,r.isObject=l.isObject,r.isArray=l.isArray,r.contains=n,r.every=i,r.forEach=a,r.some=o,r.nestedMap=u,r.without=c},{"datalib/src/util":8}],37:[function(e,t,r){arguments[4][2][0].apply(r,arguments)},{dup:2}],38:[function(e,t,r){arguments[4][3][0].apply(r,arguments)},{"../time":40,"../util":41,dup:3}],39:[function(e,t,r){arguments[4][4][0].apply(r,arguments)},{"./util":41,dup:4}],40:[function(e,t,r){arguments[4][7][0].apply(r,arguments)},{"d3-time":37,dup:7}],41:[function(e,t,r){(function(e){function r(e,t){var r,n="";for(r=0;e>r;++r)n+=t;return n}function n(e,t,r){var n=0,i=e.split(c);return e=r?(i=i.reverse()).filter(function(e){return n+=e.length,t>=n}).reverse():i.filter(function(e){return n+=e.length,t>=n}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports,a="__name__";i.namedfunc=function(e,t){return t[a]=e,t},i.name=function(e){return null==e?null:e[a]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},i.extend=function(e){for(var t,r,n=1,i=arguments.length;i>n;++n){t=arguments[n];for(r in t)e[r]=t[r]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var t,r=[];for(t in e)r.push(t);return r},i.vals=function(e){var t,r=[];for(t in e)r.push(e[t]);return r},i.toMap=function(e,t){return(t=i.$(t))?e.reduce(function(e,r){return e[t(r)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},i.keystr=function(e){var t=e.length;if(!t)return"";for(var r=String(e[0]),n=1;t>n;++n)r+="|"+String(e[n]);return r};var o=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===o.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===o.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===o.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===o.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==o.call(e)},i.isDate=function(e){return"[object Date]"===o.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"===e?!1:!!e},i.date=function(e,t){var r=t?t:Date;return null==e||""===e?null:r.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var t;return i.isString(e)&&(t=i.field(e)).length>1?function(e,r){for(var n=0;n<t.length-1;++n)e=e[t[n]];e[t[n]]=r}:function(t,r){t[e]=r}},i.$func=function(e,t){return function(r){r=i.$(r)||i.identity;var n=e+(i.name(r)?"_"+i.name(r):"");return i.namedfunc(n,function(e){return t(r(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,t){e=i.$(e);var r=i.isArray(t)?i.toMap(t):t;return function(t){return!!r[e(t)]}},i.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var r=1;return"-"===e[0]?(r=-1,e=e.slice(1)):"+"===e[0]&&(r=1,e=e.slice(1)),t.push(r),i.accessor(e)}),function(r,n){var a,o,u,c;for(a=0,o=e.length;o>a;++a)if(u=e[a],c=i.cmp(u(r),u(n)))return c*t[a];return 0}},i.cmp=function(e,t){return(t>e||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0)},i.numcmp=function(e,t){return e-t},i.stablesort=function(e,t,r){var n=e.reduce(function(e,t,n){return e[r(t)]=n,e},{});return e.sort(function(e,i){var a=t(e),o=t(i);return o>a?-1:a>o?1:n[r(e)]-n[r(i)]}),e},i.permute=function(e){for(var t,r,n=e.length;n;)r=Math.floor(Math.random()*n--),t=e[n],e[n]=e[r],e[r]=t},i.pad=function(e,t,n,i){i=i||" ";var a=t-e.length;if(0>=a)return e;switch(n){case"left":return r(a,i)+e;case"middle":case"center":return r(Math.floor(a/2),i)+e+r(Math.ceil(a/2),i);default:return e+r(a,i)}},i.truncate=function(e,t,r,i,a){var o=e.length;if(t>=o)return e;a=void 0!==a?String(a):"â€¦";var u=Math.max(0,t-a.length);switch(r){case"left":return a+(i?n(e,u,1):e.slice(o-u));case"middle":case"center":var c=Math.ceil(u/2),s=Math.floor(u/2);return(i?n(e,c):e.slice(0,c))+a+(i?n(e,s,1):e.slice(o-s));default:return(i?n(e,u):e.slice(0,u))+a}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:1}],42:[function(e,t,r){var n="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r=t.space||"";"number"==typeof r&&(r=Array(r+1).join(" "));var o="boolean"==typeof t.cycles?t.cycles:!1,u=t.replacer||function(e,t){return t},c=t.cmp&&function(e){return function(t){return function(r,n){var i={key:r,value:t[r]},a={key:n,value:t[n]};return e(i,a)}}}(t.cmp),s=[];return function l(e,t,p,f){var E=r?"\n"+new Array(f+1).join(r):"",T=r?": ":":";if(p&&p.toJSON&&"function"==typeof p.toJSON&&(p=p.toJSON()),p=u.call(e,t,p),void 0!==p){if("object"!=typeof p||null===p)return n.stringify(p);if(i(p)){for(var A=[],S=0;S<p.length;S++){var d=l(p,S,p[S],f+1)||n.stringify(null);A.push(E+r+d)}return"["+A.join(",")+E+"]"}if(-1!==s.indexOf(p)){if(o)return n.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}s.push(p);for(var y=a(p).sort(c&&c(p)),A=[],S=0;S<y.length;S++){var t=y[S],I=l(p,t,p[t],f+1);if(I){var h=n.stringify(t)+T+I;A.push(E+r+h)}}return s.splice(s.indexOf(p),1),"{"+A.join(",")+E+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in e)t.call(e,n)&&r.push(n);return r}},{jsonify:43}],43:[function(e,t,r){r.parse=e("./lib/parse"),r.stringify=e("./lib/stringify")},{"./lib/parse":44,"./lib/stringify":45}],44:[function(e,t,r){var n,i,a,o,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},c=function(e){throw{name:"SyntaxError",message:e,at:n,text:a}},s=function(e){return e&&e!==i&&c("Expected '"+e+"' instead of '"+i+"'"),i=a.charAt(n),n+=1,i},l=function(){var e,t="";for("-"===i&&(t="-",s("-"));i>="0"&&"9">=i;)t+=i,s();if("."===i)for(t+=".";s()&&i>="0"&&"9">=i;)t+=i;if("e"===i||"E"===i)for(t+=i,s(),"-"!==i&&"+"!==i||(t+=i,s());i>="0"&&"9">=i;)t+=i,s();return e=+t,isFinite(e)?e:void c("Bad number")},p=function(){var e,t,r,n="";if('"'===i)for(;s();){if('"'===i)return s(),n;if("\\"===i)if(s(),"u"===i){for(r=0,t=0;4>t&&(e=parseInt(s(),16),isFinite(e));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else{if("string"!=typeof u[i])break;n+=u[i]}else n+=i}c("Bad string")},f=function(){for(;i&&" ">=i;)s()},E=function(){switch(i){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}c("Unexpected '"+i+"'")},T=function(){var e=[];if("["===i){if(s("["),f(),"]"===i)return s("]"),e;for(;i;){if(e.push(o()),f(),"]"===i)return s("]"),e;s(","),f()}}c("Bad array")},A=function(){var e,t={};if("{"===i){if(s("{"),f(),"}"===i)return s("}"),t;for(;i;){if(e=p(),f(),s(":"),Object.hasOwnProperty.call(t,e)&&c('Duplicate key "'+e+'"'),t[e]=o(),f(),"}"===i)return s("}"),t;s(","),f()}}c("Bad object")};o=function(){switch(f(),i){case"{":return A();case"[":return T();case'"':return p();case"-":return l();default:return i>="0"&&"9">=i?l():E()}},t.exports=function(e,t){var r;return a=e,n=0,i=" ",r=o(),f(),i&&c("Syntax error"),"function"==typeof t?function u(e,r){var n,i,a=e[r];if(a&&"object"==typeof a)for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(i=u(a,n),void 0!==i?a[n]=i:delete a[n]);return t.call(e,r,a)}({"":r},""):r}},{}],45:[function(e,t,r){function n(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var r,c,s,l,p,f=a,E=t[e];switch(E&&"object"==typeof E&&"function"==typeof E.toJSON&&(E=E.toJSON(e)),"function"==typeof u&&(E=u.call(t,e,E)),typeof E){case"string":return n(E);case"number":return isFinite(E)?String(E):"null";case"boolean":case"null":return String(E);case"object":if(!E)return"null";if(a+=o,p=[],"[object Array]"===Object.prototype.toString.apply(E)){for(l=E.length,r=0;l>r;r+=1)p[r]=i(r,E)||"null";return s=0===p.length?"[]":a?"[\n"+a+p.join(",\n"+a)+"\n"+f+"]":"["+p.join(",")+"]",a=f,s}if(u&&"object"==typeof u)for(l=u.length,r=0;l>r;r+=1)c=u[r],"string"==typeof c&&(s=i(c,E),s&&p.push(n(c)+(a?": ":":")+s));else for(c in E)Object.prototype.hasOwnProperty.call(E,c)&&(s=i(c,E),s&&p.push(n(c)+(a?": ":":")+s));return s=0===p.length?"{}":a?"{\n"+a+p.join(",\n"+a)+"\n"+f+"}":"{"+p.join(",")+"}",a=f,s}}var a,o,u,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,r){var n;if(a="",o="","number"==typeof r)for(n=0;r>n;n+=1)o+=" ";else"string"==typeof r&&(o=r);if(u=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],46:[function(e,t,r){"use strict";!function(e){e[e.VALUES="values"]="VALUES",e[e.COUNT="count"]="COUNT",e[e.VALID="valid"]="VALID",e[e.MISSING="missing"]="MISSING",e[e.DISTINCT="distinct"]="DISTINCT",e[e.SUM="sum"]="SUM",e[e.MEAN="mean"]="MEAN",e[e.AVERAGE="average"]="AVERAGE",e[e.VARIANCE="variance"]="VARIANCE",e[e.VARIANCEP="variancep"]="VARIANCEP",e[e.STDEV="stdev"]="STDEV",e[e.STDEVP="stdevp"]="STDEVP",e[e.MEDIAN="median"]="MEDIAN",e[e.Q1="q1"]="Q1",e[e.Q3="q3"]="Q3",e[e.MODESKEW="modeskew"]="MODESKEW",e[e.MIN="min"]="MIN",e[e.MAX="max"]="MAX",e[e.ARGMIN="argmin"]="ARGMIN",e[e.ARGMAX="argmax"]="ARGMAX"}(r.AggregateOp||(r.AggregateOp={}));var n=r.AggregateOp;r.AGGREGATE_OPS=[n.VALUES,n.COUNT,n.VALID,n.MISSING,n.DISTINCT,n.SUM,n.MEAN,n.AVERAGE,n.VARIANCE,n.VARIANCEP,n.STDEV,n.STDEVP,n.MEDIAN,n.Q1,n.Q3,n.MODESKEW,n.MIN,n.MAX,n.ARGMIN,n.ARGMAX],r.SUM_OPS=[n.COUNT,n.SUM,n.DISTINCT],r.SHARED_DOMAIN_OPS=[n.MEAN,n.AVERAGE,n.STDEV,n.STDEVP,n.MEDIAN,n.Q1,n.Q3,n.MIN,n.MAX]},{}],47:[function(e,t,r){"use strict";!function(e){e[e.TOP="top"]="TOP",e[e.RIGHT="right"]="RIGHT",e[e.LEFT="left"]="LEFT",e[e.BOTTOM="bottom"]="BOTTOM"}(r.AxisOrient||(r.AxisOrient={}));r.AxisOrient;r.defaultAxisConfig={offset:void 0,grid:void 0,labels:!0,labelMaxLength:25,tickSize:void 0,characterWidth:6},r.defaultFacetAxisConfig={axisWidth:0,labels:!0,grid:!1,tickSize:0}},{}],48:[function(e,t,r){"use strict";function n(e){switch(e){case i.ROW:case i.COLUMN:case i.SIZE:case i.SHAPE:return 6;default:return 10}}var i=e("./channel");r.autoMaxBins=n},{"./channel":49}],49:[function(e,t,r){"use strict";function n(e,t){return!!i(e)[t]}function i(e){switch(e){case r.X:case r.Y:case r.COLOR:case r.DETAIL:case r.ORDER:case r.OPACITY:case r.ROW:case r.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,line:!0,area:!0,text:!0};case r.X2:case r.Y2:return{rule:!0,bar:!0,area:!0};case r.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0};case r.SHAPE:return{point:!0};case r.TEXT:return{text:!0};case r.PATH:return{line:!0}}return{}}function a(e){switch(e){case r.X:case r.Y:case r.COLOR:case r.OPACITY:case r.LABEL:case r.DETAIL:return{measure:!0,dimension:!0};case r.ROW:case r.COLUMN:case r.SHAPE:return{measure:!1,dimension:!0};case r.X2:case r.Y2:case r.SIZE:case r.TEXT:return{measure:!0,dimension:!1};case r.PATH:return{measure:!1,dimension:!0}}throw new Error("Invalid encoding channel"+e)}function o(e){return!u.contains([r.DETAIL,r.PATH,r.TEXT,r.LABEL,r.ORDER],e)}var u=e("./util");!function(e){e[e.X="x"]="X",e[e.Y="y"]="Y",e[e.X2="x2"]="X2",e[e.Y2="y2"]="Y2",e[e.ROW="row"]="ROW",e[e.COLUMN="column"]="COLUMN",e[e.SHAPE="shape"]="SHAPE",e[e.SIZE="size"]="SIZE",e[e.COLOR="color"]="COLOR",e[e.TEXT="text"]="TEXT",e[e.DETAIL="detail"]="DETAIL",e[e.LABEL="label"]="LABEL",e[e.PATH="path"]="PATH",e[e.ORDER="order"]="ORDER",e[e.OPACITY="opacity"]="OPACITY"}(r.Channel||(r.Channel={}));var c=r.Channel;r.X=c.X,r.Y=c.Y,r.X2=c.X2,r.Y2=c.Y2,r.ROW=c.ROW,r.COLUMN=c.COLUMN,r.SHAPE=c.SHAPE,r.SIZE=c.SIZE,r.COLOR=c.COLOR,r.TEXT=c.TEXT,r.DETAIL=c.DETAIL,r.LABEL=c.LABEL,r.PATH=c.PATH,r.ORDER=c.ORDER,r.OPACITY=c.OPACITY,r.CHANNELS=[r.X,r.Y,r.X2,r.Y2,r.ROW,r.COLUMN,r.SIZE,r.SHAPE,r.COLOR,r.PATH,r.ORDER,r.OPACITY,r.TEXT,r.DETAIL,r.LABEL],r.UNIT_CHANNELS=u.without(r.CHANNELS,[r.ROW,r.COLUMN]),r.UNIT_SCALE_CHANNELS=u.without(r.UNIT_CHANNELS,[r.PATH,r.ORDER,r.DETAIL,r.TEXT,r.LABEL,r.X2,r.Y2]),r.NONSPATIAL_CHANNELS=u.without(r.UNIT_CHANNELS,[r.X,r.Y,r.X2,r.Y2]),r.NONSPATIAL_SCALE_CHANNELS=u.without(r.UNIT_SCALE_CHANNELS,[r.X,r.Y,r.X2,r.Y2]),r.STACK_GROUP_CHANNELS=[r.COLOR,r.DETAIL,r.ORDER,r.OPACITY,r.SIZE],r.supportMark=n,r.getSupportedMark=i,r.getSupportedRole=a,r.hasScale=o},{"./util":60}],50:[function(e,t,r){"use strict";function n(e){return!!(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds)}function i(e){return c.isNumber(e)?e-1+"":(console.warn("Potentially invalid quarter",e),e)}function a(e){if(c.isNumber(e))return e-1+"";var t=e.toLowerCase(),n=r.MONTHS.indexOf(t);if(-1!==n)return n+"";var i=t.substr(0,3),a=r.SHORT_MONTHS.indexOf(i);return-1!==a?a+"":(console.warn("Potentially invalid month",e),e)}function o(e){if(c.isNumber(e))return e%7+"";var t=e.toLowerCase(),n=r.DAYS.indexOf(t);if(-1!==n)return n+"";var i=t.substr(0,3),a=r.SHORT_DAYS.indexOf(i);return-1!==a?a+"":(console.warn("Potentially invalid day",e),e)}function u(e,t){void 0===t&&(t=!1);var r=[];if(t&&void 0!==e.day)for(var n=0,u=["year","quarter","month","date"];n<u.length;n++){var s=u[n];if(void 0!==e[s]){console.warn("Dropping day from datetime",JSON.stringify(e),"as day cannot be combined with",s),e=c.duplicate(e),delete e.day;break}}if(void 0!==e.year?r.push(e.year):void 0!==e.day?r.push(2006):r.push(0),void 0!==e.month){var l=t?a(e.month):e.month;r.push(l)}else if(void 0!==e.quarter){var p=t?i(e.quarter):e.quarter;r.push(p+"*3")}else r.push(0);if(void 0!==e.date)r.push(e.date);else if(void 0!==e.day){var f=t?o(e.day):e.day;r.push(f+"+1")}else r.push(1);for(var E=0,T=["hours","minutes","seconds","milliseconds"];E<T.length;E++){var A=T[E];void 0!==e[A]?r.push(e[A]):r.push(0)}return"datetime("+r.join(", ")+")"}var c=e("./util");r.isDateTime=n,r.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],r.SHORT_MONTHS=r.MONTHS.map(function(e){return e.substr(0,3)}),r.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],r.SHORT_DAYS=r.DAYS.map(function(e){return e.substr(0,3)}),r.dateTimeExpr=u},{"./util":60}],51:[function(e,t,r){"use strict";function n(e){var t=0;return e.color&&t++,e.opacity&&t++,e.size&&t++,e.shape&&t++,t}function i(e){return A.CHANNELS.filter(function(t){return a(e,t)})}function a(e,t){var r=e&&e[t];return r&&(void 0!==r.field||S.isArray(r)&&r.length>0)}function o(e){return S.some(A.CHANNELS,function(t){return!(!a(e,t)||!e[t].aggregate)})}function u(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function c(e){var t=[];return A.CHANNELS.forEach(function(r){a(e,r)&&(S.isArray(e[r])?e[r].forEach(function(e){t.push(e)}):t.push(e[r]))}),t}function s(e,t,r){l(A.CHANNELS,e,t,r)}function l(e,t,r,n){var i=0;e.forEach(function(e){a(t,e)&&(S.isArray(t[e])?t[e].forEach(function(t){r.call(n,t,e,i++)}):r.call(n,t[e],e,i++))})}function p(e,t,r){return f(A.CHANNELS,e,t,r)}function f(e,t,r,n){var i=[];return e.forEach(function(e){a(t,e)&&(S.isArray(t[e])?t[e].forEach(function(t){i.push(r.call(n,t,e))}):i.push(r.call(n,t[e],e)))}),i}function E(e,t,r,n){return T(A.CHANNELS,e,t,r,n)}function T(e,t,r,n,i){var o=n;return A.CHANNELS.forEach(function(e){a(t,e)&&(S.isArray(t[e])?t[e].forEach(function(t){o=r.call(i,o,t,e)}):o=r.call(i,o,t[e],e))}),o}var A=e("./channel"),S=e("./util");r.countRetinal=n,r.channels=i,r.has=a,r.isAggregate=o,r.isRanged=u,r.fieldDefs=c,r.forEach=s,r.channelMappingForEach=l,r.map=p,r.channelMappingMap=f,r.reduce=E,r.channelMappingReduce=T},{"./channel":49,"./util":60}],52:[function(e,t,r){"use strict";function n(e,t){void 0===t&&(t={});var r=e.field,n=t.prefix,i=t.suffix;if(c(e))r="count";else{var a=t.fn;t.nofn||(e.bin?(a="bin",i=t.binSuffix||(t.scaleType===f.ScaleType.ORDINAL?"range":"start")):!t.noAggregate&&e.aggregate?a=String(e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(r=a+"_"+r)}return i&&(r=r+"_"+i),n&&(r=n+"_"+r),t.datum&&(r='datum["'+r+'"]'),r}function i(e){return A.contains([T.NOMINAL,T.ORDINAL],e.type)||!!e.bin||e.type===T.TEMPORAL&&!!e.timeUnit}function a(e){return e&&e.field&&i(e)}function o(e){return e&&e.field&&!i(e)}function u(){return{field:"*",aggregate:p.AggregateOp.COUNT,type:T.QUANTITATIVE}}function c(e){return e.aggregate===p.AggregateOp.COUNT}function s(e,t,r){void 0===r&&(r={});var n=t[e.field],i=e.type;if(e.bin){var a=e.bin,o="boolean"==typeof a?void 0:a.maxbins;void 0===o&&(o=10);var u=A.getbins(n,o);return(u.stop-u.start)/u.step}if(i===T.TEMPORAL){var c=e.timeUnit;switch(c){case E.TimeUnit.SECONDS:return 60;case E.TimeUnit.MINUTES:return 60;case E.TimeUnit.HOURS:return 24;case E.TimeUnit.DAY:return 7;case E.TimeUnit.DATE:return 31;case E.TimeUnit.MONTH:return 12;case E.TimeUnit.QUARTER:return 4;case E.TimeUnit.YEAR:var s=t["year_"+e.field];return s?s.distinct-(n.missing>0&&r[i]?1:0):null}}return e.aggregate?1:n.distinct-(n.missing>0&&r[i]?1:0)}function l(e,t){if(null!=e.title)return e.title;if(c(e))return t.countTitle;var r=e.aggregate||e.timeUnit||e.bin&&"bin";return r?r.toString().toUpperCase()+"("+e.field+")":e.field}var p=e("./aggregate"),f=e("./scale"),E=e("./timeunit"),T=e("./type"),A=e("./util");r.aggregate={type:"string","enum":p.AGGREGATE_OPS,supportedEnums:{quantitative:p.AGGREGATE_OPS,ordinal:["median","min","max"],nominal:[],temporal:["mean","median","min","max"],"":["count"]},supportedTypes:A.toMap([T.QUANTITATIVE,T.NOMINAL,T.ORDINAL,T.TEMPORAL,""])},r.field=n,r.isDimension=a,r.isMeasure=o,r.count=u,r.isCount=c,r.cardinality=s,r.title=l},{"./aggregate":46,"./scale":55,"./timeunit":58,"./type":59,"./util":60}],53:[function(e,t,r){"use strict";function n(e){return e&&!!e.field&&void 0!==e.equal}function i(e){return!!(e&&e.field&&p.isArray(e.range)&&2===e.range.length)}function a(e){return e&&!!e.field&&p.isArray(e["in"])}function o(e){if(p.isString(e))return e;var t=e.timeUnit?"time("+l.fieldExpr(e.timeUnit,e.field)+")":s.field(e,{datum:!0});if(n(e))return t+"==="+u(e.equal,e.timeUnit);if(a(e))return"indexof(["+e["in"].map(function(t){return u(t,e.timeUnit)}).join(",")+"], "+t+") !== -1";if(i(e)){var r=e.range[0],o=e.range[1];if(null!==r&&null!==o)return"inrange("+t+", "+u(r,e.timeUnit)+", "+u(o,e.timeUnit)+")";if(null!==r)return t+" >= "+r;if(null!==o)return t+" <= "+o}}function u(e,t){if(c.isDateTime(e)){var r=c.dateTimeExpr(e,!0);return"time("+r+")"}if(l.isSingleTimeUnit(t)){var n={};n[t]=e;var r=c.dateTimeExpr(n,!0);return"time("+r+")"}return JSON.stringify(e)}var c=e("./datetime"),s=e("./fielddef"),l=e("./timeunit"),p=e("./util");r.isEqualFilter=n,r.isRangeFilter=i,r.isInFilter=a,r.expression=o},{"./datetime":50,"./fielddef":52,"./timeunit":58,"./util":60}],54:[function(e,t,r){"use strict";!function(e){e[e.AREA="area"]="AREA",e[e.BAR="bar"]="BAR",e[e.LINE="line"]="LINE",e[e.POINT="point"]="POINT",e[e.TEXT="text"]="TEXT",e[e.TICK="tick"]="TICK",e[e.RULE="rule"]="RULE",e[e.CIRCLE="circle"]="CIRCLE",e[e.SQUARE="square"]="SQUARE",e[e.ERRORBAR="errorBar"]="ERRORBAR"}(r.Mark||(r.Mark={}));var n=r.Mark;r.AREA=n.AREA,r.BAR=n.BAR,r.LINE=n.LINE,r.POINT=n.POINT,r.TEXT=n.TEXT,r.TICK=n.TICK,r.RULE=n.RULE,r.CIRCLE=n.CIRCLE,r.SQUARE=n.SQUARE,r.ERRORBAR=n.ERRORBAR,r.PRIMITIVE_MARKS=[r.AREA,r.BAR,r.LINE,r.POINT,r.TEXT,r.TICK,r.RULE,r.CIRCLE,r.SQUARE]},{}],55:[function(e,t,r){"use strict";!function(e){e[e.LINEAR="linear"]="LINEAR",e[e.LOG="log"]="LOG",e[e.POW="pow"]="POW",e[e.SQRT="sqrt"]="SQRT",e[e.QUANTILE="quantile"]="QUANTILE",e[e.QUANTIZE="quantize"]="QUANTIZE",e[e.ORDINAL="ordinal"]="ORDINAL",e[e.TIME="time"]="TIME",e[e.UTC="utc"]="UTC"}(r.ScaleType||(r.ScaleType={}));r.ScaleType;!function(e){e[e.SECOND="second"]="SECOND",e[e.MINUTE="minute"]="MINUTE",e[e.HOUR="hour"]="HOUR",e[e.DAY="day"]="DAY",e[e.WEEK="week"]="WEEK",e[e.MONTH="month"]="MONTH",e[e.YEAR="year"]="YEAR"}(r.NiceTime||(r.NiceTime={}));r.NiceTime;r.defaultScaleConfig={round:!0,textBandWidth:90,bandSize:21,padding:1,useRawDomain:!1,opacity:[.3,.8],nominalColorRange:"category10",sequentialColorRange:["#AFC6A3","#09622A"],shapeRange:"shapes",fontSizeRange:[8,40],ruleSizeRange:[1,5],tickSizeRange:[1,20]},r.defaultFacetScaleConfig={round:!0,padding:16}},{}],56:[function(e,t,r){"use strict";function n(e){return!!e&&!!e.field&&!!e.op}!function(e){e[e.ASCENDING="ascending"]="ASCENDING",e[e.DESCENDING="descending"]="DESCENDING",e[e.NONE="none"]="NONE"}(r.SortOrder||(r.SortOrder={}));r.SortOrder;r.isSortField=n},{}],57:[function(e,t,r){"use strict";function n(e,t,r){var n=r&&r.mark?r.mark.stacked:void 0;if(u.contains([c.NONE,null,!1],n))return null;if(!u.contains([o.BAR,o.AREA],e))return null;if(!a.isAggregate(t))return null;var s=i.STACK_GROUP_CHANNELS.reduce(function(e,r){return a.has(t,r)&&!t[r].aggregate&&e.push(r),e},[]);if(0===s.length)return null;var l=a.has(t,i.X),p=a.has(t,i.Y),f=l&&!!t.x.aggregate,E=p&&!!t.y.aggregate;return f!==E?{groupbyChannel:f?p?i.Y:null:l?i.X:null,fieldChannel:f?i.X:i.Y,stackByChannels:s,offset:n||c.ZERO}:null}var i=e("./channel"),a=e("./encoding"),o=e("./mark"),u=e("./util");!function(e){e[e.ZERO="zero"]="ZERO",e[e.CENTER="center"]="CENTER",e[e.NORMALIZE="normalize"]="NORMALIZE",e[e.NONE="none"]="NONE"}(r.StackOffset||(r.StackOffset={}));var c=r.StackOffset;r.stack=n},{"./channel":49,"./encoding":51,"./mark":54,"./util":60}],58:[function(e,t,r){"use strict";function n(e){return!!d[e]}function i(e,t){var n=new Date(0,0,1,0,0,0,0);return r.SINGLE_TIMEUNITS.forEach(function(r){if(o(e,r))switch(r){case S.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case S.YEAR:n.setFullYear(t.getFullYear());break;case S.QUARTER:n.setMonth(3*Math.floor(t.getMonth()/3));break;case S.MONTH:n.setMonth(t.getMonth());break;case S.DATE:n.setDate(t.getDate());break;case S.HOURS:n.setHours(t.getHours());break;case S.MINUTES:n.setMinutes(t.getMinutes());break;case S.SECONDS:n.setSeconds(t.getSeconds());break;case S.MILLISECONDS:n.setMilliseconds(t.getMilliseconds())}}),n}function a(e){return!!y[e]}function o(e,t){var r=e.toString(),n=t.toString(),i=r.indexOf(n);return i>-1&&(t!==S.SECONDS||0===i||"i"!==r.charAt(i-1))}function u(e){switch(e){case S.HOURS:case S.DAY:case S.MONTH:case S.QUARTER:return T.ScaleType.ORDINAL}return T.ScaleType.TIME}function c(e,t){function n(e){return e===S.QUARTER?"floor(month("+i+")/3)":e+"("+i+")"}var i='datum["'+t+'"]',a=r.SINGLE_TIMEUNITS.reduce(function(t,r){return o(e,r)&&(t[r]=n(r)),t},{});return a.day&&A.keys(a).length>1&&(console.warn('Time unit "'+e+'" is not supported. We are replacing it with ',(e+"").replace("day","date")+"."),delete a.day,a.date=n(S.DATE)),E.dateTimeExpr(a)}function s(e,t){if(A.contains([f.ROW,f.COLUMN,f.SHAPE,f.COLOR],t))return null;switch(e){case S.SECONDS:return A.range(0,60);case S.MINUTES:return A.range(0,60);case S.HOURS:return A.range(0,24);case S.DAY:return A.range(0,7);case S.DATE:return A.range(1,32);case S.MONTH:return A.range(0,12);case S.QUARTER:return[0,3,6,9]}return null}function l(e){return e?o(e,S.SECONDS)?"second":o(e,S.MINUTES)?"minute":o(e,S.HOURS)?"hour":o(e,S.DAY)||o(e,S.DATE)?"day":o(e,S.MONTH)?"month":o(e,S.YEAR)?"year":void 0:void 0}function p(e,t,r){if(e){var n=[];o(e,S.YEAR)&&n.push(r?"%y":"%Y"),o(e,S.QUARTER)&&n.push("'}}Q{{"+t+" | quarter}}{{"+t+" | time:'"),o(e,S.MONTH)&&n.push(r?"%b":"%B"),o(e,S.DAY)?n.push(r?"%a":"%A"):o(e,S.DATE)&&n.push("%d");var i=[];o(e,S.HOURS)&&i.push("%H"),o(e,S.MINUTES)&&i.push("%M"),o(e,S.SECONDS)&&i.push("%S"),o(e,S.MILLISECONDS)&&i.push("%L");var a=[];if(n.length>0&&a.push(n.join("-")),i.length>0&&a.push(i.join(":")),a.length>0){var u="{{"+t+" | time:'"+a.join(" ")+"'}}",c=t.replace(/(\[|\])/g,"\\$1");return u.replace(new RegExp("{{"+c+" \\| time:''}}","g"),"")}}}var f=e("./channel"),E=e("./datetime"),T=e("./scale"),A=e("./util");!function(e){e[e.YEAR="year"]="YEAR",e[e.MONTH="month"]="MONTH",e[e.DAY="day"]="DAY",e[e.DATE="date"]="DATE",e[e.HOURS="hours"]="HOURS",e[e.MINUTES="minutes"]="MINUTES",e[e.SECONDS="seconds"]="SECONDS",e[e.MILLISECONDS="milliseconds"]="MILLISECONDS",e[e.YEARMONTH="yearmonth"]="YEARMONTH",e[e.YEARMONTHDATE="yearmonthdate"]="YEARMONTHDATE",e[e.YEARMONTHDATEHOURS="yearmonthdatehours"]="YEARMONTHDATEHOURS",e[e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes"]="YEARMONTHDATEHOURSMINUTES",e[e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds"]="YEARMONTHDATEHOURSMINUTESSECONDS",
e[e.HOURSMINUTES="hoursminutes"]="HOURSMINUTES",e[e.HOURSMINUTESSECONDS="hoursminutesseconds"]="HOURSMINUTESSECONDS",e[e.MINUTESSECONDS="minutesseconds"]="MINUTESSECONDS",e[e.SECONDSMILLISECONDS="secondsmilliseconds"]="SECONDSMILLISECONDS",e[e.QUARTER="quarter"]="QUARTER",e[e.YEARQUARTER="yearquarter"]="YEARQUARTER",e[e.QUARTERMONTH="quartermonth"]="QUARTERMONTH",e[e.YEARQUARTERMONTH="yearquartermonth"]="YEARQUARTERMONTH"}(r.TimeUnit||(r.TimeUnit={}));var S=r.TimeUnit;r.SINGLE_TIMEUNITS=[S.YEAR,S.QUARTER,S.MONTH,S.DAY,S.DATE,S.HOURS,S.MINUTES,S.SECONDS,S.MILLISECONDS];var d=r.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});r.isSingleTimeUnit=n,r.convert=i,r.MULTI_TIMEUNITS=[S.YEARQUARTER,S.YEARQUARTERMONTH,S.YEARMONTH,S.YEARMONTHDATE,S.YEARMONTHDATEHOURS,S.YEARMONTHDATEHOURSMINUTES,S.YEARMONTHDATEHOURSMINUTESSECONDS,S.QUARTERMONTH,S.HOURSMINUTES,S.HOURSMINUTESSECONDS,S.MINUTESSECONDS,S.SECONDSMILLISECONDS];var y=r.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});r.isMultiTimeUnit=a,r.TIMEUNITS=r.SINGLE_TIMEUNITS.concat(r.MULTI_TIMEUNITS),r.containsTimeUnit=o,r.defaultScaleType=u,r.fieldExpr=c,r.rawDomain=s,r.smallestUnit=l,r.template=p},{"./channel":49,"./datetime":50,"./scale":55,"./util":60}],59:[function(e,t,r){"use strict";function n(e){var t=e;return r.TYPE_FROM_SHORT_TYPE[t.toUpperCase()]||t.toLowerCase()}!function(e){e[e.QUANTITATIVE="quantitative"]="QUANTITATIVE",e[e.ORDINAL="ordinal"]="ORDINAL",e[e.TEMPORAL="temporal"]="TEMPORAL",e[e.NOMINAL="nominal"]="NOMINAL"}(r.Type||(r.Type={}));var i=r.Type;r.QUANTITATIVE=i.QUANTITATIVE,r.ORDINAL=i.ORDINAL,r.TEMPORAL=i.TEMPORAL,r.NOMINAL=i.NOMINAL,r.SHORT_TYPE={quantitative:"Q",temporal:"T",nominal:"N",ordinal:"O"},r.TYPE_FROM_SHORT_TYPE={Q:r.QUANTITATIVE,T:r.TEMPORAL,O:r.ORDINAL,N:r.NOMINAL},r.getFullName=n},{}],60:[function(e,t,r){"use strict";function n(e,t){var r={};return t.forEach(function(t){e.hasOwnProperty(t)&&(r[t]=e[t])}),r}function i(e,t){var r=O.duplicate(e);return t.forEach(function(e){delete r[e]}),r}function a(e){return v.isString(e)||v.isNumber(e)||v.isBoolean(e)?String(e):m(e)}function o(e,t){return e.indexOf(t)>-1}function u(e,t){return e.filter(function(e){return!o(t,e)})}function c(e,t){return e.concat(u(t,e))}function s(e,t,r){if(e.forEach)e.forEach.call(r,t);else for(var n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n,e)}function l(e,t,r,n){if(e.reduce)return e.reduce.call(n,t,r);for(var i in e)e.hasOwnProperty(i)&&(r=t.call(n,r,e[i],i,e));return r}function p(e,t,r){if(e.map)return e.map.call(r,t);var n=[];for(var i in e)e.hasOwnProperty(i)&&n.push(t.call(r,e[i],i,e));return n}function f(e,t){for(var r=0,n=0;n<e.length;n++)if(t(e[n],n,r++))return!0;return!1}function E(e,t){for(var r=0,n=0;n<e.length;n++)if(!t(e[n],n,r++))return!1;return!0}function T(e){return[].concat.apply([],e)}function A(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)e=S(e,t[n]);return e}function S(e,t){if("object"!=typeof t||null===t)return e;for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&("object"!=typeof t[r]||null===t[r]?e[r]=t[r]:"object"!=typeof e[r]||null===e[r]?e[r]=A(t[r].constructor===Array?[]:{},t[r]):A(e[r],t[r]));return e}function d(e,t){return R({min:e.min,max:e.max,maxbins:t})}function y(e,t){var r,n,i,a=[],o={};for(n=0,i=e.length;i>n;++n)r=t?t(e[n]):e[n],r in o||(o[r]=1,a.push(e[n]));return a}function I(e){console.warn("[VL Warning]",e)}function h(e){console.error("[VL Error]",e)}function g(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t[r]&&e[r]&&t[r]!==e[r])return!0;return!1}var m=e("json-stable-stringify"),N=e("datalib/src/util");r.keys=N.keys,r.extend=N.extend,r.duplicate=N.duplicate,r.isArray=N.isArray,r.vals=N.vals,r.truncate=N.truncate,r.toMap=N.toMap,r.isObject=N.isObject,r.isString=N.isString,r.isNumber=N.isNumber,r.isBoolean=N.isBoolean;var O=e("datalib/src/util"),C=e("datalib/src/generate");r.range=C.range;var v=e("datalib/src/util");r.pick=n,r.omit=i,r.hash=a,r.contains=o,r.without=u,r.union=c,r.forEach=s,r.reduce=l,r.map=p,r.some=f,r.every=E,r.flatten=T,r.mergeDeep=A;var R=e("datalib/src/bins/bins");r.getbins=d,r.unique=y,r.warning=I,r.error=h,r.differ=g},{"datalib/src/bins/bins":38,"datalib/src/generate":39,"datalib/src/util":41,"json-stable-stringify":42}]},{},[14])(14)});
//# sourceMappingURL=compassql.min.js.map
