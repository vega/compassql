!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cql=e()}}(function(){var e;return function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e){return a({},n.DEFAULT_QUERY_CONFIG,e,{"enum":i(e["enum"])})}function i(e){var t=a({},s.DEFAULT_ENUM_INDEX,e,{binProps:o(e,"bin"),scaleProps:o(e,"scale"),axisProps:o(e,"axis"),legendProps:o(e,"legend")});return t}function o(e,t){return a({},s.DEFAULT_ENUM_INDEX[t+"Props"],e[t+"Props"])}var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("vega-lite/build/src/channel"),c=e("./property"),s=e("./wildcard");n.DEFAULT_QUERY_CONFIG={verbose:!1,defaultSpecConfig:{overlay:{line:!0},scale:{useUnaggregatedDomain:!0}},propertyPrecedence:c.DEFAULT_PROP_PRECEDENCE.map(c.toKey),"enum":s.DEFAULT_ENUM_INDEX,numberNominalProportion:.05,numberNominalLimit:40,constraintManuallySpecifiedValue:!1,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitMultipleNonPositionalChannels:!0,omitNonSumStack:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOrFacetOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,preferredBinAxis:u.Channel.X,preferredTemporalAxis:u.Channel.X,preferredOrdinalAxis:u.Channel.Y,preferredNominalAxis:u.Channel.Y,preferredFacet:u.Channel.ROW,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:20,maxCardinalityForShape:6,timeUnitShouldHaveVariation:!0,typeMatchesSchemaType:!0,stylize:!0,smallRangeStepForHighCardinalityOrFacet:{maxCardinality:10,rangeStep:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7,minPercentUniqueForKey:.8,minCardinalityForKey:50},n.extendConfig=r},{"./property":13,"./wildcard":39,"vega-lite/build/src/channel":57}],2:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("../property"),o=e("../wildcard"),a=e("../util"),u=function(){function e(e){this.constraint=e}return e.prototype.name=function(){return this.constraint.name},e.prototype.description=function(){return this.constraint.description},e.prototype.properties=function(){return this.constraint.properties},e.prototype.strict=function(){return this.constraint.strict},e}();n.AbstractConstraintModel=u;var c=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return a.every(this.constraint.properties,function(t){if(i.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return!e[n]||!o.isWildcard(e[n][r])}return!e[t]||!o.isWildcard(e[t])})},t.prototype.satisfy=function(e,t,n,r){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n,r)},t}(u);n.EncodingConstraintModel=c},{"../property":13,"../util":38,"../wildcard":39}],3:[function(e,t,n){"use strict";function r(e,t,n,r,u,c){for(var s=o.FIELD_CONSTRAINTS_BY_PROPERTY.get(e)||[],l=r.getEncodingQueryByIndex(n),f=0,d=s;f<d.length;f++){var p=d[f];if(p.strict()||c[p.name()]){var y=p.satisfy(l,u,r.wildcardIndex.encodings[n],c);if(!y){var g="(enc) "+p.name();return c.verbose&&console.log(g+" failed with "+r.toShorthand()+" for "+t.name),g}}}for(var h=a.VALUE_CONSTRAINTS_BY_PROPERTY.get(e)||[],m=0,v=h;m<v.length;m++){var p=v[m];if((p.strict()||c[p.name()])&&i.isValueQuery(l)){var y=p.satisfy(l,u,r.wildcardIndex.encodings[n],c);if(!y){var g="(enc) "+p.name();return c.verbose&&console.log(g+" failed with "+r.toShorthand()+" for "+t.name),g}}}return null}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../query/encoding"),o=e("./field"),a=e("./value");n.checkEncoding=r},{"../query/encoding":16,"./field":4,"./value":7}],4:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-lite/build/src/channel"),o=e("vega-lite/build/src/fielddef"),a=e("vega-lite/build/src/scale"),u=e("vega-lite/build/src/type"),c=e("../query/ExpandedType"),s=e("../property"),l=e("../propindex"),f=e("../wildcard"),d=e("../schema"),p=e("../util"),y=e("../query/encoding"),g=e("./base");n.FIELD_CONSTRAINTS=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[s.Property.TYPE,s.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.aggregate||!c.isDiscrete(e.type)}},{name:"asteriskFieldWithCountOnly",description:'Field="*" should be disallowed except aggregate="count"',properties:[s.Property.FIELD,s.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return"*"===e.field==("count"===e.aggregate)}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[s.Property.TYPE,s.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||e.type===u.Type.QUANTITATIVE}},{name:"channelFieldCompatible",description:"encoding channel's range type be compatible with channel type.",properties:[s.Property.CHANNEL,s.Property.TYPE,s.Property.BIN,s.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,i){var a=r({field:"f"},y.toFieldDef(e,["bin","timeUnit","type"]));return o.channelCompatibility(a,e.channel).compatible}},{name:"hasFn",description:"A field with as hasFn flag should have one of aggregate, timeUnit, or bin.",properties:[s.Property.AGGREGATE,s.Property.BIN,s.Property.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){return!e.hasFn||(!!e.aggregate||!!e.bin||!!e.timeUnit)}},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[s.Property.SCALE,s.getEncodingNestedProp("scale","zero"),s.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||!e.scale||e.scale.zero!==!0}},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[s.Property.AGGREGATE,s.Property.AUTOCOUNT,s.Property.TIMEUNIT,s.Property.BIN],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(y.isFieldQuery(e)){var i=(!f.isWildcard(e.aggregate)&&e.aggregate?1:0)+(!f.isWildcard(e.bin)&&e.bin?1:0)+(!f.isWildcard(e.timeUnit)&&e.timeUnit?1:0);return i<=1}return!0}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[s.Property.TYPE,s.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.timeUnit||e.type===u.Type.TEMPORAL}},{name:"timeUnitShouldHaveVariation",description:"A particular time unit should be applied only if they produce unique values.",properties:[s.Property.TIMEUNIT,s.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!e.timeUnit||e.type!==u.Type.TEMPORAL||(!n.has("timeUnit")&&!r.constraintManuallySpecifiedValue||t.timeUnitHasVariation(e))}},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:[].concat(s.SCALE_PROPS,[s.Property.SCALE,s.Property.TYPE]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.scale,o=y.scaleType(e);if(void 0===o||null===o)return!0;for(var u in i)if("type"!==u&&"name"!==u&&"enum"!==u){var c=u;if("point"===o){if(!a.scaleTypeSupportProperty("point",c)&&!a.scaleTypeSupportProperty("band",c))return!1}else if(!a.scaleTypeSupportProperty(o,c))return!1}}return!0}},{name:"scalePropertiesSupportedByChannel",description:"Not all scale properties are supported by all encoding channels",properties:[].concat(s.SCALE_PROPS,[s.Property.SCALE,s.Property.CHANNEL]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e){var i=e.channel,o=e.scale;if(i&&!f.isWildcard(i)&&o){if("row"===i||"column"===i)return!1;for(var u in o)if(o.hasOwnProperty(u)&&"type"!==u&&"name"!==u&&"enum"!==u){var c=void 0===a.channelScalePropertyIncompatability(i,u);if(!c)return!1}}}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[s.Property.FIELD,s.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if("*"===e.field)return!0;var i=t.primitiveType(e.field),o=e.type;if(!n.has("field")&&!n.has("type")&&!r.constraintManuallySpecifiedValue)return!0;switch(i){case d.PrimitiveType.BOOLEAN:case d.PrimitiveType.STRING:return o!==u.Type.QUANTITATIVE&&o!==u.Type.TEMPORAL;case d.PrimitiveType.NUMBER:case d.PrimitiveType.INTEGER:return o!==u.Type.TEMPORAL;case d.PrimitiveType.DATETIME:return o===u.Type.TEMPORAL;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[s.Property.FIELD,s.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!(n.has("field")||n.has("type")||r.constraintManuallySpecifiedValue)||("*"===e.field?e.type===u.Type.QUANTITATIVE:t.vlType(e.field)===e.type)}},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==i.Channel.COLOR||e.type!==u.Type.NOMINAL&&e.type!==c.ExpandedType.KEY||t.cardinality(e)<=r.maxCardinalityForCategoricalColor}},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD,s.Property.BIN,s.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==i.Channel.ROW&&e.channel!==i.Channel.COLUMN||t.cardinality(e)<=r.maxCardinalityForFacet}},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD,s.Property.BIN,s.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==i.Channel.SHAPE||t.cardinality(e)<=r.maxCardinalityForShape}},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[s.Property.TYPE,s.Property.SCALE,s.getEncodingNestedProp("scale","type"),s.Property.TIMEUNIT,s.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.type,o=y.scaleType(e);if(c.isDiscrete(i))return void 0===o||a.hasDiscreteDomain(o);if(i===u.Type.TEMPORAL)return e.timeUnit?p.contains([a.ScaleType.TIME,a.ScaleType.UTC,void 0],o)||a.hasDiscreteDomain(o):p.contains([a.ScaleType.TIME,a.ScaleType.UTC,void 0],o);if(i===u.Type.QUANTITATIVE)return e.bin?p.contains([a.ScaleType.LINEAR,void 0],o):p.contains([a.ScaleType.LOG,a.ScaleType.POW,a.ScaleType.SQRT,a.ScaleType.QUANTILE,a.ScaleType.QUANTIZE,a.ScaleType.LINEAR,void 0],o)}return!0}}].map(function(e){return new g.EncodingConstraintModel(e)}),n.FIELD_CONSTRAINT_INDEX=n.FIELD_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{}),n.FIELD_CONSTRAINTS_BY_PROPERTY=n.FIELD_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new l.PropIndex)},{"../property":13,"../propindex":14,"../query/ExpandedType":15,"../query/encoding":16,"../schema":36,"../util":38,"../wildcard":39,"./base":2,"vega-lite/build/src/channel":57,"vega-lite/build/src/fielddef":60,"vega-lite/build/src/scale":65,"vega-lite/build/src/type":67}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./encoding");n.encoding=r;var i=e("./spec");n.spec=i},{"./encoding":3,"./spec":6}],6:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var o=E.get(e)||[],a=0,u=o;a<u.length;a++){var c=u[a];if(c.strict()||i[c.name()]){var s=c.satisfy(n,r,i);if(!s){var l="(spec) "+c.name();return i.verbose&&console.log(l+" failed with "+n.toShorthand()+" for "+t.name),l}}}return null}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-lite/build/src/aggregate"),a=e("vega-lite/build/src/channel"),u=e("vega-lite/build/src/mark"),c=e("vega-lite/build/src/scale"),s=e("vega-lite/build/src/type"),l=e("../query/ExpandedType"),f=e("./base"),d=e("../wildcard"),p=e("../property"),y=e("../propindex"),g=e("../util"),h=e("../query/encoding"),m=a.NONSPATIAL_CHANNELS.reduce(function(e,t){return e[t]=!0,e},{}),v=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return g.every(this.constraint.properties,function(t){if(t===p.Property.MARK)return!d.isWildcard(e.getMark());if(p.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return g.every(e.getEncodings(),function(e){return!e[n]||!d.isWildcard(e[n][r])})}if(!p.isEncodingProperty(t))throw new Error("UNIMPLEMENTED");return g.every(e.getEncodings(),function(e){return!e[t]||!d.isWildcard(e[t])})})},t.prototype.satisfy=function(e,t,n){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n)},t}(f.AbstractConstraintModel);n.SpecConstraintModel=v,n.SPEC_CONSTRAINTS=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[p.Property.CHANNEL],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r={};return g.every(e.getEncodings(),function(e){return!!d.isWildcard(e.channel)||!r[e.channel]&&(r[e.channel]=!0,!0)})}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not recommend bar mark if scale does not start at zero",properties:[p.Property.MARK,p.Property.SCALE,p.getEncodingNestedProp("scale","zero"),p.Property.CHANNEL,p.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.BAR)for(var o=0,c=i;o<c.length;o++){var l=c[o];if(h.isFieldQuery(l)&&(l.channel===a.Channel.X||l.channel===a.Channel.Y)&&l.type===s.Type.QUANTITATIVE&&l.scale&&l.scale.zero===!1)return!1}return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[p.Property.BIN,p.Property.TIMEUNIT,p.Property.TYPE,p.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=g.some(e.getEncodings(),function(e){return h.isEnabledAutoCountQuery(e)});if(r)return g.every(e.getEncodings(),function(e){if(h.isValueQuery(e))return!1;if(h.isAutoCountQuery(e))return!0;switch(e.type){case s.Type.QUANTITATIVE:return!!e.bin;case s.Type.TEMPORAL:return!!e.timeUnit;case s.Type.ORDINAL:case l.ExpandedType.KEY:case s.Type.NOMINAL:return!0}throw new Error("Unsupported Type")});var i=e.wildcardIndex.encodingIndicesByProperty.get("autoCount")||[],o=g.every(i,function(t){var n=e.getEncodingQueryByIndex(t);return h.isAutoCountQuery(n)&&!d.isWildcard(n.autoCount)});return!o||g.some(e.getEncodings(),function(e){return(h.isFieldQuery(e)||h.isAutoCountQuery(e))&&e.type===s.Type.QUANTITATIVE?!h.isDisabledAutoCountQuery(e)&&(h.isFieldQuery(e)&&(!e.bin||d.isWildcard(e.bin))):!(!h.isFieldQuery(e)||e.type!==s.Type.TEMPORAL)&&(!e.timeUnit||d.isWildcard(e.timeUnit))})}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[p.Property.CHANNEL,p.Property.MARK],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r=e.getMark();return!!d.isWildcard(r)||g.every(e.getEncodings(),function(e){return!!d.isWildcard(e.channel)||a.supportMark(e.channel,r)})}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[p.Property.CHANNEL,p.Property.MARK],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:return e.channelUsed(a.Channel.X)&&e.channelUsed(a.Channel.Y);case u.Mark.TEXT:return e.channelUsed(a.Channel.TEXT);case u.Mark.BAR:case u.Mark.CIRCLE:case u.Mark.SQUARE:case u.Mark.TICK:case u.Mark.RULE:return e.channelUsed(a.Channel.X)||e.channelUsed(a.Channel.Y);case u.Mark.POINT:return!e.wildcardIndex.hasProperty(p.Property.CHANNEL)||e.channelUsed(a.Channel.X)||e.channelUsed(a.Channel.Y)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+JSON.stringify(r))}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()}},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"Omit aggregate plots with dimensions only on facets as that leads to inefficient use of space.",properties:[p.Property.CHANNEL,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(e.isAggregate()){var r=!1,i=!1,o=!1;if(e.specQuery.encodings.forEach(function(t,n){h.isValueQuery(t)||h.isDisabledAutoCountQuery(t)||h.isFieldQuery(t)&&!t.aggregate&&(i=!0,g.contains([a.Channel.ROW,a.Channel.COLUMN],t.channel)?e.wildcardIndex.hasEncodingProperty(n,p.Property.CHANNEL)&&(o=!0):r=!0)}),i&&!r&&(o||n.constraintManuallySpecifiedValue))return!1}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[p.Property.AGGREGATE,p.Property.AUTOCOUNT,p.Property.BIN,p.Property.TIMEUNIT,p.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()||g.some(e.getEncodings(),function(e){return!!h.isDiscrete(e)})}},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[p.Property.MARK,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!g.contains([u.Mark.BAR,u.Mark.LINE,u.Mark.AREA],e.getMark())||e.isAggregate()}},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[p.Property.CHANNEL,p.Property.MARK],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getMark();if(g.contains([u.Mark.TICK,u.Mark.BAR],r)&&e.channelUsed(a.Channel.SIZE)){if(n.constraintManuallySpecifiedValue)return!1;for(var i=e.specQuery.encodings,o=0;o<i.length;o++){var c=i[o];if(c.channel===a.Channel.SIZE)return!e.wildcardIndex.hasEncodingProperty(o,p.Property.CHANNEL)}}return!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[p.Property.MARK,p.Property.CHANNEL,p.Property.SCALE,p.getEncodingNestedProp("scale","type"),p.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.AREA||r===u.Mark.BAR)for(var o=0,s=i;o<s.length;o++){var l=s[o];if(h.isFieldQuery(l)&&(l.channel===a.Channel.X||l.channel===a.Channel.Y)&&l.scale){var f=h.scaleType(l);if(f===c.ScaleType.LOG)return!1}}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Unless manually specified, do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[p.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=0,o=!1,a=0;a<r.length;a++){var u=r[a];if(!h.isValueQuery(u)&&!h.isDisabledAutoCountQuery(u)){var c=u.channel;if(!d.isWildcard(c)&&m[c+""]&&(i+=1,e.wildcardIndex.hasEncodingProperty(a,p.Property.CHANNEL)&&(o=!0),i>1&&(o||n.constraintManuallySpecifiedValue)))return!1}}return!0}},{name:"omitNonPositionalOrFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[p.Property.CHANNEL],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=!1,o=!1,u=!1,c=!1,s=0;s<r.length;s++){var l=r[s];if(!h.isValueQuery(l)&&!h.isDisabledAutoCountQuery(l)){var f=l.channel;f===a.Channel.X?u=!0:f===a.Channel.Y?c=!0:d.isWildcard(f)||(i=!0,e.wildcardIndex.hasEncodingProperty(s,p.Property.CHANNEL)&&(o=!0))}}return!(o||n.constraintManuallySpecifiedValue&&i)||u&&c}},{name:"omitRaw",description:"Omit raw plots.",properties:[p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!!e.isAggregate()}},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[p.Property.AGGREGATE,p.Property.AUTOCOUNT,p.Property.TIMEUNIT,p.Property.BIN,p.Property.TYPE],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){if(e.isAggregate())for(var r=e.specQuery.encodings,i=0;i<r.length;i++){var o=r[i];if(!h.isValueQuery(o)&&!h.isDisabledAutoCountQuery(o)){if(h.isFieldQuery(o)&&o.type===s.Type.TEMPORAL&&!o.timeUnit&&(e.wildcardIndex.hasEncodingProperty(i,p.Property.TIMEUNIT)||n.constraintManuallySpecifiedValue))return!1;if(o.type===s.Type.QUANTITATIVE&&h.isFieldQuery(o)&&!o.bin&&!o.aggregate){if(e.wildcardIndex.hasEncodingProperty(i,p.Property.BIN)||e.wildcardIndex.hasEncodingProperty(i,p.Property.AGGREGATE)||e.wildcardIndex.hasEncodingProperty(i,p.Property.AUTOCOUNT))return!1;if(n.constraintManuallySpecifiedValue)return!1}}}return!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[p.Property.CHANNEL,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){return!!e.isAggregate()||g.every(e.specQuery.encodings,function(t,r){return!(!h.isValueQuery(t)&&!h.isDisabledAutoCountQuery(t))||(t.channel!==a.Channel.DETAIL||!e.wildcardIndex.hasEncodingProperty(r,p.Property.CHANNEL)&&!n.constraintManuallySpecifiedValue)})}},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[p.Property.FIELD],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r={},i={},o=e.specQuery.encodings,a=0;a<o.length;a++){var u=o[a];if(!h.isValueQuery(u)&&!h.isAutoCountQuery(u)){var c=void 0;if(u.field&&!d.isWildcard(u.field)&&(c=u.field),h.isAutoCountQuery(u)&&!d.isWildcard(u.autoCount)&&(c="count_*"),c){if(e.wildcardIndex.hasEncodingProperty(a,p.Property.FIELD)&&(i[c]=!0),r[c]&&(i[c]||n.constraintManuallySpecifiedValue))return!1;r[c]=!0}}}return!0}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[p.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getEncodings();return 1!==r.length||r[0].channel!==a.Channel.Y}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[p.Property.CHANNEL,p.Property.MARK,p.Property.TYPE,p.Property.TIMEUNIT,p.Property.BIN,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:if(e.isAggregate()){var i=e.getEncodingQueryByChannel(a.Channel.X),o=e.getEncodingQueryByChannel(a.Channel.Y),c=h.isContinuous(i),s=h.isContinuous(o);return i&&o&&c!==s&&!(h.isFieldQuery(i)&&!c&&g.contains(["nominal","key"],i.type))&&!(h.isFieldQuery(o)&&!s&&g.contains(["nominal","key"],o.type))}return!0;case u.Mark.TEXT:return!0;case u.Mark.BAR:case u.Mark.TICK:if(e.channelUsed(a.Channel.SIZE))return!1;var i=e.getEncodingQueryByChannel(a.Channel.X),o=e.getEncodingQueryByChannel(a.Channel.Y),l=h.isContinuous(i),f=h.isContinuous(o);return l!==f;case u.Mark.CIRCLE:case u.Mark.POINT:case u.Mark.SQUARE:case u.Mark.RULE:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitNonLinearScaleTypeWithStack",description:"Stacked plot should only use linear scale",properties:[p.Property.CHANNEL,p.Property.MARK,p.Property.AGGREGATE,p.Property.AUTOCOUNT,p.Property.SCALE,p.getEncodingNestedProp("scale","type"),p.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.stack();if(r)for(var i=0,o=e.getEncodings();i<o.length;i++){var u=o[i];if(!h.isValueQuery(u)&&(h.isFieldQuery(u)&&u.aggregate||h.isEnabledAutoCountQuery(u))&&u.type===s.Type.QUANTITATIVE&&g.contains([a.Channel.X,a.Channel.Y],u.channel)&&h.scaleType(u)!==c.ScaleType.LINEAR)return!1}return!0}},{name:"omitNonSumStack",description:"Stacked plot should use summative aggregation such as sum, count, or distinct",properties:[p.Property.CHANNEL,p.Property.MARK,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.stack();if(r){var i=e.getEncodingQueryByChannel(r.fieldChannel);return h.isFieldQuery(i)&&g.contains(o.SUM_OPS,i.aggregate)||h.isAutoCountQuery(i)&&!!i.autoCount}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both discrete should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[p.Property.CHANNEL,p.Property.TYPE,p.Property.TIMEUNIT,p.Property.BIN,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(n.autoAddCount){var r=e.getEncodingQueryByChannel("x"),i=e.getEncodingQueryByChannel("y");if((!h.isFieldQuery(r)||h.isDiscrete(r))&&(!h.isFieldQuery(i)||h.isDiscrete(i)))return!!e.isAggregate()&&g.every(e.getEncodings(),function(e){var t=e.channel;return!(t!==a.Channel.X&&t!==a.Channel.Y&&t!==a.Channel.ROW&&t!==a.Channel.COLUMN&&h.isFieldQuery(e)&&!e.aggregate)})}return!0}}].map(function(e){return new v(e)}),n.SPEC_CONSTRAINT_INDEX=n.SPEC_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{});var E=n.SPEC_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new y.PropIndex);n.checkSpec=r},{"../property":13,"../propindex":14,"../query/ExpandedType":15,"../query/encoding":16,"../util":38,"../wildcard":39,"./base":2,"vega-lite/build/src/aggregate":54,"vega-lite/build/src/channel":57,"vega-lite/build/src/mark":64,"vega-lite/build/src/scale":65,"vega-lite/build/src/type":67}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../property"),i=e("../propindex"),o=e("../util"),a=e("./base");n.VALUE_CONSTRAINTS=[{name:"doesNotSupportConstantValue",description:"row, column, x, y, and detail should not work with constant values.",properties:[r.Property.TYPE,r.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!o.contains(["row","column","x","y","detail"],e.channel)}}].map(function(e){return new a.EncodingConstraintModel(e)}),n.VALUE_CONSTRAINT_INDEX=n.VALUE_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{}),n.VALUE_CONSTRAINTS_BY_PROPERTY=n.VALUE_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new i.PropIndex)},{"../property":13,"../propindex":14,"../util":38,"./base":2}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.version="0.14.1",n.config=e("./config"),n.constraint=e("./constraint"),n.enumerate=e("./enumerator"),n.wildcard=e("./wildcard");var r=e("./generate");n.generate=r.generate,n.model=e("./model"),n.nest=e("./nest"),n.property=e("./property"),n.query=e("./query"),n.ranking=e("./ranking/ranking");var i=e("./recommend");n.recommend=i.recommend,n.schema=e("./schema"),n.util=e("./util")},{"./config":1,"./constraint":5,"./enumerator":9,"./generate":10,"./model":11,"./nest":12,"./property":13,"./query":18,"./ranking/ranking":34,"./recommend":35,"./schema":36,"./util":38,"./wildcard":39}],9:[function(e,t,n){"use strict";function r(e){return l.get(e)}function i(e){return function(t,n,r){return function(i,u){function c(f){if(f===l.length)return void i.push(u.duplicate());var d=l[f],p=t.encodings[d].get(e),y=u.getEncodingQueryByIndex(d),g=u.getEncodingProperty(d,e);s.isValueQuery(y)||s.isDisabledAutoCountQuery(y)||!g?c(f+1):(p["enum"].forEach(function(t){null===t&&(t=void 0),u.setEncodingProperty(d,e,t,p);var i=o.checkEncoding(e,p,d,u,n,r);if(!i){var s=a.checkSpec(e,p,u,n,r);s||c(f+1)}}),u.resetEncodingProperty(d,e,p))}var l=t.encodingIndicesByProperty.get(e);return c(0),i}}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./constraint/encoding"),a=e("./constraint/spec"),u=e("./property"),c=e("./propindex"),s=e("./query/encoding"),l=new c.PropIndex;n.getEnumerator=r,l.set("mark",function(e,t,n){return function(r,i){var o=i.getMark();return o["enum"].forEach(function(o){i.setMark(o);var u=a.checkSpec("mark",e.mark,i,t,n);u||r.push(i.duplicate())}),i.resetMark(),r}}),u.ENCODING_TOPLEVEL_PROPS.forEach(function(e){l.set(e,i(e))}),u.ENCODING_NESTED_PROPS.forEach(function(e){l.set(e,i(e))}),n.EncodingPropertyGeneratorFactory=i},{"./constraint/encoding":3,"./constraint/spec":6,"./property":13,"./propindex":14,"./query/encoding":16}],10:[function(e,t,n){"use strict";function r(e,t,n){void 0===n&&(n=i.DEFAULT_QUERY_CONFIG);var r=a.SpecQueryModel.build(e,t,n),s=r.wildcardIndex,l=[r];return n.propertyPrecedence.forEach(function(e){var r=u.fromKey(e);if(s.hasProperty(r)){var i=o.getEnumerator(r),a=i(s,t,n);l=l.reduce(a,[])}}),!n.stylize||null===n.nominalColorScaleForHighCardinality&&null===n.smallRangeStepForHighCardinalityOrFacet&&null===n.xAxisOnTopForHighYCardinalityWithoutColumn?l:c.stylize(l,t,n)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./config"),o=e("./enumerator"),a=e("./model"),u=e("./property"),c=e("./stylize");n.generate=r},{"./config":1,"./enumerator":9,"./model":11,"./property":13,"./stylize":37}],11:[function(e,t,n){"use strict";function r(e){for(var t=e.items[0];t&&i(t);)t=t.items[0];return t}function i(e){return void 0!==e.items}Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-lite/build/src/type"),a=e("./property"),u=e("./wildcard"),c=e("./wildcardindex"),s=e("./query/spec"),l=e("./query/encoding"),f=e("./query/groupby"),d=e("./query/shorthand"),p=e("./util"),y=function(){function e(e,t,n,r,i){
this._rankingScore={},this._spec=e,this._channelFieldCount=e.encodings.reduce(function(e,t){return u.isWildcard(t.channel)||l.isAutoCountQuery(t)&&t.autoCount===!1||(e[t.channel+""]=1),e},{}),this._wildcardIndex=t,this._assignedWildcardIndex=i,this._opt=r,this._schema=n}return e.build=function(t,n,r){var i=new c.WildcardIndex;if(u.isWildcard(t.mark)){var s=u.getDefaultName(a.Property.MARK);t.mark=u.initWildcard(t.mark,s,r["enum"].mark),i.setMark(t.mark)}if(t.encodings.forEach(function(e,t){l.isAutoCountQuery(e)&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=o.Type.QUANTITATIVE),l.isFieldQuery(e)&&void 0===e.type&&(e.type=u.SHORT_WILDCARD),a.ENCODING_TOPLEVEL_PROPS.forEach(function(o){if(u.isWildcard(e[o])){var a=u.getDefaultName(o)+t,c=u.getDefaultEnumValues(o,n,r),s=e[o]=u.initWildcard(e[o],a,c);i.setEncodingProperty(t,o,s)}}),a.ENCODING_NESTED_PROPS.forEach(function(o){var a=e[o.parent];if(a){var c=o.child;if(u.isWildcard(a[c])){var s=u.getDefaultName(o)+t,l=u.getDefaultEnumValues(o,n,r),f=a[c]=u.initWildcard(a[c],s,l);i.setEncodingProperty(t,o,f)}}})}),r.autoAddCount){var f={channel:{name:u.getDefaultName(a.Property.CHANNEL)+t.encodings.length,"enum":u.getDefaultEnumValues(a.Property.CHANNEL,n,r)},autoCount:{name:u.getDefaultName(a.Property.AUTOCOUNT)+t.encodings.length,"enum":[!1,!0]},type:o.Type.QUANTITATIVE};t.encodings.push(f);var d=t.encodings.length-1;i.setEncodingProperty(d,a.Property.CHANNEL,f.channel),i.setEncodingProperty(d,a.Property.AUTOCOUNT,f.autoCount)}return new e(t,i,n,r,{})},Object.defineProperty(e.prototype,"wildcardIndex",{get:function(){return this._wildcardIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specQuery",{get:function(){return this._spec},enumerable:!0,configurable:!0}),e.prototype.duplicate=function(){return new e(p.duplicate(this._spec),this._wildcardIndex,this._schema,this._opt,p.duplicate(this._assignedWildcardIndex))},e.prototype.setMark=function(e){var t=this._spec.mark.name;this._assignedWildcardIndex[t]=this._spec.mark=e},e.prototype.resetMark=function(){var e=this._spec.mark=this._wildcardIndex.mark;delete this._assignedWildcardIndex[e.name]},e.prototype.getMark=function(){return this._spec.mark},e.prototype.getEncodingProperty=function(e,t){var n=this._spec.encodings[e];return a.isEncodingNestedProp(t)?n[t.parent][t.child]:n[t]},e.prototype.setEncodingProperty=function(e,t,n,r){var i=this._spec.encodings[e];t===a.Property.CHANNEL&&i.channel&&!u.isWildcard(i.channel)&&this._channelFieldCount[i.channel]--,a.isEncodingNestedProp(t)?i[t.parent][t.child]=n:a.hasNestedProperty(t)&&n===!0?i[t]=p.extend({},i[t],{"enum":void 0,name:void 0}):i[t]=n,this._assignedWildcardIndex[r.name]=n,t===a.Property.CHANNEL&&(this._channelFieldCount[n]=(this._channelFieldCount[n]||0)+1)},e.prototype.resetEncodingProperty=function(e,t,n){var r=this._spec.encodings[e];t===a.Property.CHANNEL&&this._channelFieldCount[r.channel]--,a.isEncodingNestedProp(t)?r[t.parent][t.child]=n:r[t]=n,delete this._assignedWildcardIndex[n.name]},e.prototype.channelUsed=function(e){return this._channelFieldCount[e]>0},e.prototype.stack=function(){return s.stack(this._spec)},e.prototype.getEncodings=function(){return this._spec.encodings.filter(function(e){return!l.isDisabledAutoCountQuery(e)})},e.prototype.getEncodingQueryByChannel=function(e){for(var t=0,n=this._spec.encodings;t<n.length;t++){var r=n[t];if(r.channel===e)return r}},e.prototype.getEncodingQueryByIndex=function(e){return this._spec.encodings[e]},e.prototype.isAggregate=function(){return s.isAggregate(this._spec)},e.prototype.toShorthand=function(e){if(e){var t=f.parseGroupBy(e);return d.spec(this._spec,t.include,t.replacer)}return d.spec(this._spec)},e.prototype._encoding=function(){for(var e={},t=0,n=this._spec.encodings;t<n.length;t++){var r=n[t],i={};if(l.isEnabledAutoCountQuery(r))i={aggregate:"count",field:"*",type:"quantitative"};else if(l.isValueQuery(r)||l.isDisabledAutoCountQuery(r))continue;if(u.isWildcard(r.channel))return null;for(var o=[a.Property.AGGREGATE,a.Property.BIN,a.Property.TIMEUNIT,a.Property.FIELD,a.Property.TYPE,a.Property.SCALE,a.Property.SORT,a.Property.AXIS,a.Property.LEGEND],c=0,s=o;c<s.length;c++){var f=s[c];if(u.isWildcard(r[f]))return null;void 0!==r[f]&&(d.PROPERTY_SUPPORTED_CHANNELS[f]&&!d.PROPERTY_SUPPORTED_CHANNELS[f][r.channel]||(i[f]=r[f]))}i.bin===!1&&delete i.bin,e[r.channel]=i}return e},e.prototype.toSpec=function(e){if(u.isWildcard(this._spec.mark))return null;var t={};return e=e||this._spec.data,e&&(t.data=e),this._spec.transform&&(t.transform=this._spec.transform),t.mark=this._spec.mark,t.encoding=this._encoding(),null===t.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(t.config=p.extend({},this._opt.defaultSpecConfig,this._spec.config)),t)},e.prototype.getRankingScore=function(e){return this._rankingScore[e]},e.prototype.setRankingScore=function(e,t){this._rankingScore[e]=t},e}();n.SpecQueryModel=y,n.getTopSpecQueryItem=r,n.isSpecQueryGroup=i},{"./property":13,"./query/encoding":16,"./query/groupby":17,"./query/shorthand":20,"./query/spec":21,"./util":38,"./wildcard":39,"./wildcardindex":40,"vega-lite/build/src/type":67}],12:[function(e,t,n){"use strict";function r(e,t){p[e]=t}function i(e,t){if(t){for(var n={name:"",path:"",items:[]},r={},i=[],o=[],a=[],c=0;c<t.length;c++){i.push(c>0?i[c-1].duplicate():new s.PropIndex),o.push(c>0?o[c-1].duplicate():new s.PropIndex);var d=t[c].groupBy;if(u.isArray(d)){var y=l.parseGroupBy(d,i[c],o[c]);a.push(y.replacer)}}return e.forEach(function(e){for(var o="",c=n,s=0;s<t.length;s++){var l=c.groupBy=t[s].groupBy;c.orderGroupBy=t[s].orderGroupBy;var d=u.isArray(l)?f.spec(e.specQuery,i[s],a[s]):p[l](e);o+="/"+d,r[o]||(r[o]={name:d,path:o,items:[]},c.items.push(r[o])),c=r[o]}c.items.push(e)}),n}return{name:"",path:"",items:e}}function o(e){var t=d.stack(e.specQuery);return t?"stack="+t.offset+"|":""}Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-lite/build/src/channel"),u=e("datalib/src/util"),c=e("./property"),s=e("./propindex"),l=e("./query/groupby"),f=e("./query/shorthand"),d=e("./query/spec"),p={};n.registerKeyFn=r,n.FIELD="field",n.FIELD_TRANSFORM="fieldTransform",n.ENCODING="encoding",n.TRANSPOSE="transpose",n.SPEC="spec",n.nest=i;var y=[c.Property.FIELD],g=l.parseGroupBy(y);r(n.FIELD,function(e){return f.spec(e.specQuery,g.include,g.replacer)}),n.PARSED_GROUP_BY_FIELD_TRANSFORM=l.parseGroupBy(l.GROUP_BY_FIELD_TRANSFORM),r(n.FIELD_TRANSFORM,function(e){return f.spec(e.specQuery,n.PARSED_GROUP_BY_FIELD_TRANSFORM.include,n.PARSED_GROUP_BY_FIELD_TRANSFORM.replacer)}),n.PARSED_GROUP_BY_ENCODING=l.parseGroupBy(l.GROUP_BY_ENCODING),r(n.ENCODING,function(e){return f.spec(e.specQuery,n.PARSED_GROUP_BY_ENCODING.include,n.PARSED_GROUP_BY_ENCODING.replacer)}),r(n.TRANSPOSE,function(e){return e.getMark()+"|"+o(e)+e.getEncodings().map(function(e){var t=f.fieldDef(e),n=e.channel===a.Channel.X||e.channel===a.Channel.Y?"xy":e.channel===a.Channel.ROW||e.channel===a.Channel.COLUMN?"facet":e.channel;return n+":"+t}).sort().join("|")}),r(n.SPEC,function(e){return JSON.stringify(e.specQuery)})},{"./property":13,"./propindex":14,"./query/groupby":17,"./query/shorthand":20,"./query/spec":21,"datalib/src/util":48,"vega-lite/build/src/channel":57}],13:[function(e,t,n){"use strict";function r(e){return!!e.parent}function i(e){return e in y}function o(e){return h[e]}function a(e){return r(e)?e.parent+T+e.child:e}function u(e){var t=e.split(T);if(1===t.length)return e;if(2===t.length)return{parent:t[0],child:t[1]};throw"Invalid property key with "+t.length+" dots: "+e}function c(e,t){return(O[e]||{})[t]}function s(e){return i(e)||r(e)}Object.defineProperty(n,"__esModule",{value:!0});var l=e("vega-lite/build/src/axis"),f=e("vega-lite/build/src/scale"),d=e("vega-lite/build/src/legend"),p=e("./util");n.isEncodingNestedProp=r,n.ENCODING_TOPLEVEL_PROPS=["channel","aggregate","autoCount","bin","timeUnit","hasFn","sort","field","type","scale","axis","legend"];var y=p.toMap(n.ENCODING_TOPLEVEL_PROPS);n.isEncodingTopLevelProperty=i;var g=["bin","scale","sort","axis","legend"],h=p.toMap(g);n.hasNestedProperty=o,n.BIN_CHILD_PROPS=["maxbins","divide","extent","base","step","steps","minstep"],n.SORT_CHILD_PROPS=["field","op","order"],n.SCALE_CHILD_PROPS=["clamp","domain","exponent","nice","range","rangeStep","round","type","zero"];var m=n.BIN_CHILD_PROPS.map(function(e){return{parent:"bin",child:e}});n.SORT_PROPS=n.SORT_CHILD_PROPS.map(function(e){return{parent:"sort",child:e}}),n.SCALE_PROPS=f.SCALE_PROPERTIES.map(function(e){return{parent:"scale",child:e}});var v=l.AXIS_PROPERTIES.map(function(e){return{parent:"axis",child:e}}),E=d.LEGEND_PROPERTIES.map(function(e){return{parent:"legend",child:e}});n.ENCODING_NESTED_PROPS=[].concat(m,n.SORT_PROPS,n.SCALE_PROPS,v,E);var T=".";n.toKey=a,n.fromKey=u;var O=n.ENCODING_NESTED_PROPS.reduce(function(e,t){return e[t.parent]=e[t.parent]||[],e[t.parent][t.child]=t,e},{});n.getEncodingNestedProp=c,n.isEncodingProperty=s,n.ALL_ENCODING_PROPS=[].concat(n.ENCODING_TOPLEVEL_PROPS,n.ENCODING_NESTED_PROPS),n.DEFAULT_PROP_PRECEDENCE=["type","field","bin","timeUnit","aggregate","autoCount","channel","mark","scale","sort","axis","legend"].concat(m,n.SCALE_PROPS,v,E,n.SORT_PROPS);var N;!function(e){e.MARK="mark",e.TRANSFORM="transform",e.STACK="stack",e.CHANNEL="channel",e.AGGREGATE="aggregate",e.AUTOCOUNT="autoCount",e.BIN="bin",e.HAS_FN="hasFn",e.TIMEUNIT="timeUnit",e.FIELD="field",e.TYPE="type",e.SORT="sort",e.SCALE="scale",e.AXIS="axis",e.LEGEND="legend"}(N=n.Property||(n.Property={}))},{"./util":38,"vega-lite/build/src/axis":55,"vega-lite/build/src/legend":61,"vega-lite/build/src/scale":65}],14:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./util"),o=e("./property"),a=function(){function e(e){void 0===e&&(e=null),this.index=e?r({},e):{}}return e.prototype.has=function(e){return o.toKey(e)in this.index},e.prototype.get=function(e){return this.index[o.toKey(e)]},e.prototype.set=function(e,t){return this.index[o.toKey(e)]=t,this},e.prototype.setByKey=function(e,t){this.index[e]=t},e.prototype.map=function(t){var n=new e;for(var r in this.index)n.index[r]=t(this.index[r]);return n},e.prototype.size=function(){return i.keys(this.index).length},e.prototype.duplicate=function(){return new e(this.index)},e}();n.PropIndex=a},{"./property":13,"./util":38}],15:[function(e,t,n){"use strict";function r(e){return e===o.Type.ORDINAL||e===o.Type.NOMINAL||e===i.KEY}Object.defineProperty(n,"__esModule",{value:!0});var i,o=e("vega-lite/build/src/type");!function(e){e.QUANTITATIVE=o.Type.QUANTITATIVE,e.ORDINAL=o.Type.ORDINAL,e.TEMPORAL=o.Type.TEMPORAL,e.NOMINAL=o.Type.NOMINAL,e.KEY="key"}(i=n.ExpandedType||(n.ExpandedType={})),n.isDiscrete=r},{"vega-lite/build/src/type":67}],16:[function(e,t,n){"use strict";function r(e){return null!==e&&void 0!==e&&e.value}function i(e){return null!==e&&void 0!==e&&e.field}function o(e){return null!==e&&void 0!==e&&"autoCount"in e}function a(e){return o(e)&&e.autoCount===!1}function u(e){return o(e)&&e.autoCount===!0}function c(e,t){if(void 0===t&&(t=["aggregate","bin","timeUnit","field","type"]),i(e))return t.reduce(function(t,n){if(g.isWildcard(e[n]))throw new Error("Cannot convert "+JSON.stringify(e)+" to fielddef: "+n+" is wildcard");return void 0!==e[n]&&(t[n]=e[n]),t},{});if(e.autoCount===!1)throw new Error("Cannot convert {autoCount: false} into a field def");return t.reduce(function(t,n){if(g.isWildcard(e[n]))throw new Error("Cannot convert "+JSON.stringify(e)+" to fielddef: "+n+" is wildcard");switch(n){case"type":t.type="quantitative";break;case"aggregate":t.aggregate="count"}return t},{})}function s(e){return i(e)&&d.isContinuous(c(e,["bin","timeUnit","field","type"]))}function l(e){return i(e)&&d.isDiscrete(c(e,["bin","timeUnit","field","type"]))}function f(e){var t=e.scale===!0||e.scale===g.SHORT_WILDCARD?{}:e.scale||{},n=e.type,r=e.channel,i=e.timeUnit,o=e.bin,a=void 0,u={};if(!(g.isWildcard(t.type)||g.isWildcard(n)||g.isWildcard(r)||g.isWildcard(o))){if(t.type)return t.type;var c=void 0;if(!("temporal"===n&&g.isWildcard(i)||"quantitative"===n&&g.isWildcard(o))){var s=n===p.ExpandedType.KEY?"nominal":n,l={type:s,timeUnit:i,bin:o};return y.scaleType(t.type,r,l,a,c,u)}}}Object.defineProperty(n,"__esModule",{value:!0});var d=e("vega-lite/build/src/fielddef"),p=e("./ExpandedType"),y=e("vega-lite/build/src/compile/scale/type"),g=e("../wildcard");n.isValueQuery=r,n.isFieldQuery=i,n.isAutoCountQuery=o,n.isDisabledAutoCountQuery=a,n.isEnabledAutoCountQuery=u,n.toFieldDef=c,n.isContinuous=s,n.isDiscrete=l,n.scaleType=f},{"../wildcard":39,"./ExpandedType":15,"vega-lite/build/src/compile/scale/type":58,"vega-lite/build/src/fielddef":60}],17:[function(e,t,n){"use strict";function r(e){return a.isObject(e)&&!!e.property}function i(e,t,n){return t=t||new s.PropIndex,n=n||new s.PropIndex,e.forEach(function(e){r(e)?(t.setByKey(e.property,!0),n.setByKey(e.property,e.replace)):t.setByKey(e,!0)}),{include:t,replaceIndex:n,replacer:u.getReplacerIndex(n)}}function o(e){return a.isArray(e)?e.map(function(e){if(r(e)){if(e.replace){var t=l.keys(e.replace).reduce(function(t,n){var r=e.replace[n];return(t[r]=t[r]||[]).push(n),t},{});return e.property+"["+l.keys(t).map(function(e){var n=t[e].sort();return n.join(",")+"=>"+e}).join(";")+"]"}return e.property}return e}).join(","):e}Object.defineProperty(n,"__esModule",{value:!0});var a=e("datalib/src/util"),u=e("./shorthand"),c=e("../property"),s=e("../propindex"),l=e("../util");n.REPLACE_BLANK_FIELDS={"*":""},n.REPLACE_XY_CHANNELS={x:"xy",y:"xy"},n.REPLACE_FACET_CHANNELS={row:"facet",column:"facet"},n.REPLACE_MARK_STYLE_CHANNELS={color:"style",opacity:"style",shape:"style",size:"style"},n.isExtendedGroupBy=r,n.parseGroupBy=i,n.toString=o,n.GROUP_BY_FIELD_TRANSFORM=[c.Property.FIELD,c.Property.TYPE,c.Property.AGGREGATE,c.Property.BIN,c.Property.TIMEUNIT,c.Property.STACK],n.GROUP_BY_ENCODING=n.GROUP_BY_FIELD_TRANSFORM.concat([{property:c.Property.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}])},{"../property":13,"../propindex":14,"../util":38,"./shorthand":20,"datalib/src/util":48}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.encoding=e("./encoding");var r=e("./normalize");n.normalize=r.normalize,n.groupBy=e("./groupby"),n.shorthand=e("./shorthand"),n.spec=e("./spec"),n.transform=e("./transform")},{"./encoding":16,"./groupby":17,"./normalize":19,"./shorthand":20,"./spec":21,"./transform":22}],19:[function(e,t,n){"use strict";function r(e){if(e.groupBy){var t={groupBy:e.groupBy};e.orderBy&&(t.orderGroupBy=e.orderBy);var n={spec:i.duplicate(e.spec),nest:[t]};return e.chooseBy&&(n.chooseBy=e.chooseBy),e.config&&(n.config=e.config),n}return i.duplicate(e)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../util");n.normalize=r},{"../util":38}],20:[function(e,t,n){"use strict";function r(e){return e.map(function(e){return i(e)})}function i(e){return function(t){return void 0!==e[t]?e[t]:t}}function o(e,t){return N.isWildcard(e)?!N.isShortWildcard(e)&&e["enum"]?N.SHORT_WILDCARD+JSON.stringify(e["enum"]):N.SHORT_WILDCARD:t?t(e):e}function a(e,t){return t?t(e):e}function u(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=O.fromSpec(e);return c(i,t,r)}function c(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=[];if(t.get(S.Property.MARK)&&i.push(o(e.mark,r.get(S.Property.MARK))),e.transform&&e.transform.length>0&&i.push("transform:"+JSON.stringify(e.transform)),t.get(S.Property.STACK)){var a=O.stack(e);if(a){var u=t.duplicate().set("type",!1),c=l(a.fieldEncQ,u,r),f=l(a.groupByEncQ,u,r);i.push("stack={field:"+c+","+(f?"by:"+f+",":"")+"offset:"+a.offset+"}")}}if(e.encodings){var d=e.encodings.reduce(function(e,n){if(!T.isDisabledAutoCountQuery(n)){var i=s(n,t,r);i&&e.push(i)}return e},[]).sort().join("|");d&&i.push(d)}return i.join("|")}function s(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=[];if(t.get(S.Property.CHANNEL)&&i.push(o(e.channel,r.get(S.Property.CHANNEL))),T.isFieldQuery(e)){var a=l(e,t,r);a&&i.push(a)}else T.isValueQuery(e)&&i.push(e.value);return i.join(":")}function l(e,t,r){if(void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE),t.get(S.Property.AGGREGATE)&&T.isDisabledAutoCountQuery(e))return"-";var i,a=f(e,t,r),u=d(e,t,r);if(T.isFieldQuery(e)){if(i=t.get("field")?o(e.field,r.get("field")):"...",t.get(S.Property.TYPE))if(N.isWildcard(e.type))i+=","+o(e.type,r.get(S.Property.TYPE));else{var c=((e.type||v.Type.QUANTITATIVE)+"").substr(0,1);i+=","+o(c,r.get(S.Property.TYPE))}i+=u.map(function(e){var t=e.value instanceof Array?"["+e.value+"]":e.value;return","+e.key+"="+t}).join("")}else T.isAutoCountQuery(e)&&(i="*,q");if(!i)return null;if(a){var s=E.isString(a)?a:N.SHORT_WILDCARD+(P.keys(a).length>0?JSON.stringify(a):"");return s+"("+i+")"}return i}function f(e,t,n){if(t.get(S.Property.AGGREGATE)&&e.aggregate&&!N.isWildcard(e.aggregate))return a(e.aggregate,n.get(S.Property.AGGREGATE));if(t.get(S.Property.AGGREGATE)&&T.isEnabledAutoCountQuery(e))return a("count",n.get(S.Property.AGGREGATE));if(t.get(S.Property.TIMEUNIT)&&e.timeUnit&&!N.isWildcard(e.timeUnit))return a(e.timeUnit,n.get(S.Property.TIMEUNIT));if(t.get(S.Property.BIN)&&e.bin&&!N.isWildcard(e.bin))return"bin";for(var r=null,i=0,o=[S.Property.AGGREGATE,S.Property.AUTOCOUNT,S.Property.TIMEUNIT,S.Property.BIN];i<o.length;i++){var u=o[i],c=e[u];t.get(u)&&e[u]&&N.isWildcard(c)&&(r=r||{},r[u]=N.isShortWildcard(c)?c:c["enum"])}return r&&e.hasFn&&(r.hasFn=!0),r}function d(e,t,r){var i=[];if(!P.isBoolean(e.bin)&&!N.isShortWildcard(e.bin)){var u=e.bin;for(var c in u){var s=S.getEncodingNestedProp("bin",c);s&&t.get(s)&&void 0!==u[c]&&i.push({key:c,value:o(u[c],r.get(s))})}i.sort(function(e,t){return e.key.localeCompare(t.key)})}for(var l=0,f=[S.Property.SCALE,S.Property.SORT,S.Property.AXIS,S.Property.LEGEND];l<f.length;l++){var d=f[l];if((N.isWildcard(e.channel)||n.PROPERTY_SUPPORTED_CHANNELS[d][e.channel])&&t.get(d)&&void 0!==e[d]){var p=e[d];if(P.isBoolean(p)||null===p)i.push({key:d+"",value:p||!1});else if(E.isString(p))i.push({key:d+"",value:a(JSON.stringify(p),r.get(d))});else{var y=[];for(var c in p){var g=S.getEncodingNestedProp(d,c);g&&t.get(g)&&void 0!==p[c]&&y.push({key:c,value:o(p[c],r.get(g))})}if(y.length>0){var h=y.sort(function(e,t){return e.key.localeCompare(t.key)}).reduce(function(e,t){return e[t.key]=t.value,e},{});i.push({key:d+"",value:JSON.stringify(h)})}}}}return i}function p(e){for(var t=e.split("|"),n={mark:t[0],encodings:[]},r=1;r<t.length;r++){var i=t[r],o=y(i,":",1),a=o[0],u=o[1];if(C[a]||"?"===a){var c=M.encoding(a,u);n.encodings.push(c)}else"transform"!==a||(n.transform=JSON.parse(u))}return n}function y(e,t,n){for(var r=[],i=0,o=0;o<n;o++){var a=e.indexOf(t,i);if(a===-1)break;r.push(e.substring(i,a)),i=a+1}if(r.push(e.substr(i)),r.length!==n+1)for(;r.length!==n+1;)r.push("");return r}Object.defineProperty(n,"__esModule",{value:!0});var g=e("vega-lite/build/src/aggregate"),h=e("vega-lite/build/src/channel"),m=e("vega-lite/build/src/timeunit"),v=e("vega-lite/build/src/type"),E=e("datalib/src/util"),T=e("./encoding"),O=e("./spec"),N=e("../wildcard"),S=e("../property"),A=e("../propindex"),P=e("../util");n.getReplacerIndex=r,n.getReplacer=i,n.value=o,n.replace=a,n.REPLACE_NONE=new A.PropIndex,n.INCLUDE_ALL=[].concat(S.DEFAULT_PROP_PRECEDENCE,S.SORT_PROPS,[S.Property.TRANSFORM,S.Property.STACK]).reduce(function(e,t){return e.set(t,!0)},new A.PropIndex),n.vlSpec=u,n.PROPERTY_SUPPORTED_CHANNELS={axis:{x:!0,y:!0,row:!0,column:!0},legend:{color:!0,opacity:!0,size:!0,shape:!0},scale:{x:!0,y:!0,color:!0,opacity:!0,row:!0,column:!0,size:!0,shape:!0},sort:{x:!0,y:!0,path:!0,order:!0}},n.spec=c,n.encoding=s,n.fieldDef=l;var C=E.toMap(h.CHANNELS),b=E.toMap(g.AGGREGATE_OPS),_=E.toMap(m.SINGLE_TIMEUNITS),I=E.toMap(m.MULTI_TIMEUNITS);n.parse=p,n.splitWithTail=y;var M;!function(e){function t(e,t){var r={channel:e};return r=t.indexOf("(")!==-1?i(r,t):n(r,y(t,",",2))}function n(e,t){e.field=t[0],e.type=v.getFullName(t[1].toUpperCase())||"?";for(var n=t[2],i=0,o=0;o<n.length;){var a=n.indexOf("=",o),u=void 0;if(a===-1)break;var c=n.substring(o,a);if("{"===n[o+c.length+1]){var s=o+c.length+1;i=r(s,n,"}");var l=n.substring(s,i+1);u=JSON.parse(l),o=i+2}else if("["===n[o+c.length+1]){var f=o+c.length+1,d=r(f,n,"]"),p=n.substring(f,d+1);u=JSON.parse(p),o=d+2}else{var y=o,g=n.indexOf(",",o+c.length);g===-1&&(g=n.length),o=g+1,u=JSON.parse(n.substring(y+c.length+1,g))}S.hasNestedProperty(c)?e[c]=u:e.bin[c]=u}return e}function r(e,t,n){for(var r=e;r<t.length;r++)if(t[r]===n)return r}function i(e,t){if("?"===t[0]){var i=r(1,t,"}"),o=JSON.parse(t.substring(1,i+1));for(var a in o)P.isArray(o[a])?e[a]={"enum":o[a]}:e[a]=o[a];return n(e,y(t.substring(i+2,t.length-1),",",2))}var u=t.substring(0,t.indexOf("(")),c=t.substring(u.length+1,t.length-1),s=y(c,",",2);return b[u]?(e.aggregate=u,n(e,s)):I[u]||_[u]?(e.timeUnit=u,n(e,s)):"bin"===u?(e.bin={},n(e,s)):void 0}e.encoding=t,e.rawFieldDef=n,e.getClosingIndex=r,e.fn=i}(M=n.shorthandParser||(n.shorthandParser={}))},{"../property":13,"../propindex":14,"../util":38,"../wildcard":39,"./encoding":16,"./spec":21,"datalib/src/util":48,"vega-lite/build/src/aggregate":54,"vega-lite/build/src/channel":57,"vega-lite/build/src/timeunit":66,"vega-lite/build/src/type":67}],21:[function(e,t,n){"use strict";function r(e){return l.extend(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},{mark:e.mark,encodings:l.keys(e.encoding).map(function(t){var n={channel:t},r=e.encoding[t];for(var i in r)s.isEncodingTopLevelProperty(i)&&void 0!==r[i]&&(l.contains(["bin","scale","axis","legend"],i)&&null===r[i]?n[i]=!1:n[i]=r[i]);return n})},e.config?{config:e.config}:{})}function i(e){return l.some(e.encodings,function(e){return f.isFieldQuery(e)&&!c.isWildcard(e.aggregate)&&!!e.aggregate||f.isEnabledAutoCountQuery(e)})}function o(e){var t=e.config,n=t?t.stack:void 0;if(l.contains(["none",null,!1],n))return null;if(!l.contains(["bar","area"],e.mark))return null;if(!i(e))return null;var r=e.encodings.reduce(function(e,t){return l.contains(u.STACK_BY_CHANNELS,t.channel)&&(f.isValueQuery(t)||f.isFieldQuery(t)&&!t.aggregate)&&e.push({channel:t.channel,fieldDef:t}),e},[]);if(0===r.length)return null;var o=e.encodings.reduce(function(e,t){return e||(t.channel===u.Channel.X?t:null)},null),a=e.encodings.reduce(function(e,t){return e||(t.channel===u.Channel.Y?t:null)},null),c=f.isFieldQuery(o)&&!!o.aggregate||f.isAutoCountQuery(o)&&!!o.autoCount,s=f.isFieldQuery(a)&&!!a.aggregate||f.isAutoCountQuery(a)&&!!a.autoCount;return c!==s?{groupbyChannel:c?a?u.Y:null:o?u.X:null,groupByEncQ:c?a:o,fieldChannel:c?u.X:u.Y,fieldEncQ:c?o:a,stackBy:r,offset:n||"zero"}:null}function a(e,t){void 0===t&&(t={});var n=t.exclude?d.toMap(t.exclude.map(s.toKey)):{};if(c.isWildcard(e.mark)&&!n.mark)return!0;for(var r=0,i=e.encodings;r<i.length;r++){var o=i[r];for(var a in o){var u=a;if(o.hasOwnProperty(u)&&s.isEncodingTopLevelProperty(u)){if(c.isWildcard(o[u])&&!n[u])return!0;var f=o[u];for(var p in f)if(f.hasOwnProperty(p)&&!l.contains(["enum","name"],p)){var y={parent:u,child:p};if(c.isWildcard(f[p])&&!n[s.toKey(y)])return!0}}}}return!1}Object.defineProperty(n,"__esModule",{value:!0});var u=e("vega-lite/build/src/channel"),c=e("../wildcard"),s=e("../property"),l=e("../util"),f=e("./encoding"),d=e("datalib/src/util");n.fromSpec=r,n.isAggregate=i,n.stack=o,n.hasWildcard=a},{"../property":13,"../util":38,"../wildcard":39,"./encoding":16,"datalib/src/util":48,"vega-lite/build/src/channel":57}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],23:[function(e,t,n){"use strict";function r(e,t,n){var r=o(e,t,n);return{score:r.score,features:[r]}}function i(e){return c.isDiscrete(e)||!!e.timeUnit}function o(e,t,r){var o=e.getEncodings();if(e.isAggregate()){var s=function(e){return c.isFieldQuery(e)&&(e.type===a.Type.QUANTITATIVE&&!e.bin&&!e.aggregate||e.type===a.Type.TEMPORAL&&!e.timeUnit)};if(u.some(o,s))return{type:n.name,score:.1,feature:"Aggregate with raw continuous"};if(u.some(o,function(e){return c.isFieldQuery(e)&&i(e)})){var l=u.some(o,function(e){return c.isFieldQuery(e)&&"count"===e.aggregate||c.isEnabledAutoCountQuery(e)}),f=u.some(o,function(e){return c.isFieldQuery(e)&&!!e.bin});return l?{type:n.name,score:.8,feature:"Aggregate with count"}:f?{type:n.name,score:.7,feature:"Aggregate with bin but without count"}:{type:n.name,score:.9,feature:"Aggregate without count and without bin"}}return{type:n.name,score:.3,feature:"Aggregate without dimension"}}return u.some(o,function(e){return c.isFieldQuery(e)&&!i(e)})?{type:n.name,score:1,feature:"Raw with measure"}:{type:n.name,score:.2,feature:"Raw without measure"}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-lite/build/src/type"),u=e("../util"),c=e("../query/encoding");n.name="aggregationQuality",n.score=r},{"../query/encoding":16,"../util":38,"vega-lite/build/src/type":67}],24:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-lite/build/src/channel"),a=e("../../config"),u=e("./type"),c=e("./base"),s=function(e){function t(){return e.call(this,"Axis")||this}return r(t,e),t.prototype.initScore=function(e){void 0===e&&(e={}),e=i({},a.DEFAULT_QUERY_CONFIG,e);var t={},n=[{feature:u.BIN_Q,opt:"preferredBinAxis"},{feature:u.T,opt:"preferredTemporalAxis"},{feature:u.TIMEUNIT_T,opt:"preferredTemporalAxis"},{feature:u.TIMEUNIT_O,opt:"preferredTemporalAxis"},{feature:u.O,opt:"preferredOrdinalAxis"},{feature:u.N,opt:"preferredNominalAxis"}];return n.forEach(function(n){e[n.opt]===o.Channel.X?t[n.feature+"_"+o.Channel.Y]=-.01:e[n.opt]===o.Channel.Y&&(t[n.feature+"_"+o.Channel.X]=-.01)}),t},t.prototype.featurize=function(e,t){return e+"_"+t},t.prototype.getScore=function(e,t,n){var r=this;return e.getEncodings().reduce(function(e,t){var n=u.getExtendedType(t),i=r.featurize(n,t.channel),o=r.getFeatureScore(i);return o&&e.push(o),e},[])},t}(c.Scorer);n.AxisScorer=s},{"../../config":1,"./base":25,"./type":31,"vega-lite/build/src/channel":57}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e){this.type=e,this.scoreIndex=this.initScore()}return e.prototype.getFeatureScore=function(e){var t=this.type,n=this.scoreIndex[e];if(void 0!==n)return{type:t,feature:e,score:n}},e}();n.Scorer=r},{}],26:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./base"),o=e("../../query/encoding"),a=function(e){function t(){return e.call(this,"Dimension")||this}return r(t,e),t.prototype.initScore=function(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}},t.prototype.getScore=function(e,t,n){var r=this;return e.isAggregate()&&e.getEncodings().reduce(function(e,t){if(o.isFieldQuery(t)&&!t.aggregate){var n=r.getFeatureScore(t.channel+"");if(n&&n.score>e.score)return n}return e},{type:"Dimension",feature:"No Dimension",score:-5}),[]},t}(i.Scorer);n.DimensionScorer=a},{"../../query/encoding":16,"./base":25}],27:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./base"),a=e("../../config"),u=e("vega-lite/build/src/channel"),c=function(e){function t(){return e.call(this,"Facet")||this}return r(t,e),t.prototype.initScore=function(e){e=i({},a.DEFAULT_QUERY_CONFIG,e);var t={};return e.preferredFacet===u.Channel.ROW?t[u.Channel.COLUMN]=-.01:e.preferredFacet===u.Channel.COLUMN&&(t[u.Channel.ROW]=-.01),t},t.prototype.getScore=function(e,t,n){var r=this;return e.getEncodings().reduce(function(e,t){var n=r.getFeatureScore(t.channel);return n&&e.push(n),e},[])},t}(o.Scorer);n.FacetScorer=c},{"../../config":1,"./base":25,"vega-lite/build/src/channel":57}],28:[function(e,t,n){"use strict";function r(e,t,n){var r=l.reduce(function(r,i){var o=i.getScore(e,t,n);return r.concat(o)},[]);return{score:r.reduce(function(e,t){return e+t.score},0),features:r}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./axis"),o=e("./dimension"),a=e("./facet"),u=e("./sizechannel"),c=e("./typechannel"),s=e("./mark"),l=[new i.AxisScorer,new o.DimensionScorer,new a.FacetScorer,new s.MarkScorer,new u.SizeChannelScorer,new c.TypeChannelScorer];n.effectiveness=r},{"./axis":24,"./dimension":26,"./facet":27,"./mark":29,"./sizechannel":30,"./typechannel":32}],29:[function(e,t,n){"use strict";function r(e,t,n,r){return e+"_"+t+"_"+n+"_"+r}function i(){var e=[s.Q,s.T],t=[s.BIN_Q,s.TIMEUNIT_O,s.O,s.N],n=t.concat([s.NONE]),i={};return e.forEach(function(t){e.forEach(function(e){var n={point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(t,e,!0,o);i[a]=n});var o={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(o,function(n,o){var a=r(t,e,!1,o);i[a]=n})})}),e.forEach(function(e){n.forEach(function(t){var n={tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n;var u=r(t,e,!0,o);i[u]=n})}),[s.TIMEUNIT_T].forEach(function(t){var n={point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n;var u=r(t,e,!0,o);i[u]=n})}),[s.NONE,s.N,s.O].forEach(function(t){var n={bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})}),[s.BIN_Q].forEach(function(t){var n={bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})}),[s.TIMEUNIT_T,s.TIMEUNIT_O].forEach(function(t){var n={line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})})}),[s.TIMEUNIT_T].forEach(function(e){[s.TIMEUNIT_T].forEach(function(t){var n={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n})}),n.forEach(function(t){var n={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);
i[a]=n}),c.forEach(n,function(n,o){var a=r(t,e,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(t,e,!1,o);i[a]=n})})}),n.forEach(function(e){n.forEach(function(t){var n={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n})})}),i}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-lite/build/src/channel"),u=e("vega-lite/build/src/mark"),c=e("../../util"),s=e("./type"),l=e("./base"),f=function(e){function t(){return e.call(this,"Mark")||this}return o(t,e),t.prototype.initScore=function(){return i()},t.prototype.getScore=function(e,t,n){var r=e.getMark();r!==u.Mark.CIRCLE&&r!==u.Mark.SQUARE||(r=u.Mark.POINT);var i=e.getEncodingQueryByChannel(a.Channel.X),o=i?s.getExtendedType(i):s.NONE,c=e.getEncodingQueryByChannel(a.Channel.Y),l=c?s.getExtendedType(c):s.NONE,f=!e.isAggregate(),d=o+"_"+l+"_"+f+"_"+r,p=this.getFeatureScore(d);return[p]},t}(l.Scorer);n.MarkScorer=f,n.featurize=r},{"../../util":38,"./base":25,"./type":31,"vega-lite/build/src/channel":57,"vega-lite/build/src/mark":64}],30:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./base"),o=function(e){function t(){return e.call(this,"SizeChannel")||this}return r(t,e),t.prototype.initScore=function(){return{bar_size:-2,tick_size:-2}},t.prototype.getScore=function(e,t,n){var r=this,i=e.getMark();return e.getEncodings().reduce(function(e,t){var n=i+"_"+t.channel,o=r.getFeatureScore(n);return o&&e.push(o),e},[])},t}(i.Scorer);n.SizeChannelScorer=o},{"./base":25}],31:[function(e,t,n){"use strict";function r(e){if(e.bin)return i.BIN_Q;if(e.timeUnit){var t=u.scaleType(e);return o.hasDiscreteDomain(t)?i.TIMEUNIT_O:i.TIMEUNIT_T}return e.type}Object.defineProperty(n,"__esModule",{value:!0});var i,o=e("vega-lite/build/src/scale"),a=e("vega-lite/build/src/type"),u=e("../../query/encoding"),c=e("../../query/ExpandedType");!function(e){e[e.Q=a.Type.QUANTITATIVE]="Q",e[e.BIN_Q="bin_"+a.Type.QUANTITATIVE]="BIN_Q",e[e.T=a.Type.TEMPORAL]="T",e[e.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",e[e.TIMEUNIT_O="timeUnit_"+a.Type.ORDINAL]="TIMEUNIT_O",e[e.O=a.Type.ORDINAL]="O",e[e.N=a.Type.NOMINAL]="N",e[e.K=c.ExpandedType.KEY]="K",e[e.NONE="-"]="NONE"}(i=n.ExtendedType||(n.ExtendedType={})),n.Q=i.Q,n.BIN_Q=i.BIN_Q,n.T=i.T,n.TIMEUNIT_T=i.TIMEUNIT_T,n.TIMEUNIT_O=i.TIMEUNIT_O,n.O=i.O,n.N=i.N,n.K=i.K,n.NONE=i.NONE,n.getExtendedType=r},{"../../query/ExpandedType":15,"../../query/encoding":16,"vega-lite/build/src/scale":65,"vega-lite/build/src/type":67}],32:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../query/shorthand"),o=e("../../util"),a=e("./type"),u=e("./base");n.TERRIBLE=-10;var c=function(e){function t(){return e.call(this,"TypeChannel")||this}return r(t,e),t.prototype.initScore=function(){var e=this,t={},r={x:0,y:0,size:-.575,color:-.725,text:-2,opacity:-3,shape:n.TERRIBLE,row:n.TERRIBLE,column:n.TERRIBLE,detail:2*n.TERRIBLE};[a.Q,a.T,a.TIMEUNIT_T].forEach(function(n){o.keys(r).forEach(function(i){t[e.featurize(n,i)]=r[i]})});var i=o.extend({},r,{row:-.75,column:-.75,shape:-3.1,text:-3.2,detail:-4});[a.BIN_Q,a.TIMEUNIT_O,a.O].forEach(function(n){o.keys(i).forEach(function(r){t[e.featurize(n,r)]=i[r]})});var u={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,detail:-2,size:-3,opacity:-3.1};return o.keys(u).forEach(function(n){t[e.featurize(a.N,n)]=u[n]}),t},t.prototype.featurize=function(e,t){return e+"_"+t},t.prototype.getScore=function(e,t,n){var r=this,u=e.getEncodings().reduce(function(e,t){var n=i.fieldDef(t);return(e[n]=e[n]||[]).push(t),e},{}),c=[];return o.forEach(u,function(e){var t=e.reduce(function(e,t){var n=a.getExtendedType(t),i=r.featurize(n,t.channel),o=r.getFeatureScore(i);return null===e||o.score>e.score?o:e},null);c.push(t)}),c},t}(u.Scorer);n.TypeChannelScorer=c},{"../../query/shorthand":20,"../../util":38,"./base":25,"./type":31}],33:[function(e,t,n){"use strict";function r(e,t,n){var r=e.wildcardIndex.encodingIndicesByProperty.get("field");if(!r)return{score:0,features:[]};for(var o=e.specQuery.encodings,a=t.fieldSchemas.length,u=[],c=0,s=1,l=r.length-1;l>=0;l--){var f=r[l],d=o[f],p=void 0;if(i.isFieldQuery(d)){p=d.field;var y=e.wildcardIndex.encodings[f].get("field"),g=t.fieldSchema(p).index,h=-g*s;c+=h,u.push({score:h,type:"fieldOrder",feature:"field "+y.name+" is "+p+" (#"+g+" in the schema)"}),s*=a}}return{score:c,features:u}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../query/encoding");n.name="fieldOrder",n.score=r},{"../query/encoding":16}],34:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}function i(e,t){p[e]=t}function o(e){return p[e]}function a(e,t,n,r){return t.nest&&r!==t.nest.length?(e.items.forEach(function(e){a(e,t,n,r+1)}),t.nest[r].orderGroupBy&&e.items.sort(c(t.nest[r].orderGroupBy,n,t.config))):(t.orderBy||t.chooseBy)&&(e.items.sort(u(t.orderBy||t.chooseBy,n,t.config)),t.chooseBy&&e.items.length>0&&e.items.splice(1)),e}function u(e,t,n){return function(r,i){return e instanceof Array?s(e,r,i,t,n):s([e],r,i,t,n)}}function c(e,t,n){return function(r,i){var o=f.getTopSpecQueryItem(r),a=f.getTopSpecQueryItem(i);return e instanceof Array?s(e,o,a,t,n):s([e],o,a,t,n)}}function s(e,t,n,r,i){for(var o=0,a=e;o<a.length;o++){var u=a[o],c=l(n,u,r,i).score-l(t,u,r,i).score;if(0!==c)return c}return 0}function l(e,t,n,r){if(void 0!==e.getRankingScore(t))return e.getRankingScore(t);var i=o(t),a=i(e,n,r);return e.setRankingScore(t,a),a}Object.defineProperty(n,"__esModule",{value:!0});var f=e("../model"),d=e("./effectiveness");r(e("./effectiveness")),n.aggregation=e("./aggregation"),n.fieldOrder=e("./fieldorder");var p={};n.register=i,n.get=o,n.rank=a,n.comparatorFactory=u,n.groupComparatorFactory=c,n.getScore=l,n.EFFECTIVENESS="effectiveness",i(n.EFFECTIVENESS,d.effectiveness),i(n.aggregation.name,n.aggregation.score),i(n.fieldOrder.name,n.fieldOrder.score)},{"../model":11,"./aggregation":23,"./effectiveness":28,"./fieldorder":33}],35:[function(e,t,n){"use strict";function r(e,t,n){e=i({},c.normalize(e),{config:i({},o.DEFAULT_QUERY_CONFIG,n,e.config)});var r=a.generate(e.spec,t,e.config),l=u.nest(r,e.nest),f=s.rank(l,e,t,0);return{query:e,result:f}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./config"),a=e("./generate"),u=e("./nest"),c=e("./query/normalize"),s=e("./ranking/ranking");n.recommend=r},{"./config":1,"./generate":10,"./nest":12,"./query/normalize":19,"./ranking/ranking":34}],36:[function(e,t,n){"use strict";function r(e,t,n){void 0===t&&(t={fields:[]}),void 0===n&&(n={}),n=v.extend({},m.DEFAULT_QUERY_CONFIG,n);var r=d.summary(e),a=p.inferAll(e),u=t.fields.reduce(function(e,t){return e[t.name]=t,e},{}),l=r.map(function(t,r){var i,o=t.field,c="date"===a[o]?T.DATETIME:a[o],l=t.distinct;if(c===T.NUMBER)i=s.Type.QUANTITATIVE;else if(c===T.INTEGER)i=l<n.numberNominalLimit&&l/t.count<n.numberNominalProportion?s.Type.NOMINAL:s.Type.QUANTITATIVE;else if(c===T.DATETIME){i=s.Type.TEMPORAL,t.min=new Date(e[0][o]),t.max=new Date(e[0][o]);for(var f=0,d=e;f<d.length;f++){var p=d[f],y=new Date(p[o]).getTime();y<t.min.getTime()&&(t.min=new Date(y)),y>t.max.getTime()&&(t.max=new Date(y))}}else i=s.Type.NOMINAL;i===s.Type.NOMINAL&&l/t.count>n.minPercentUniqueForKey&&t.count>n.minCardinalityForKey&&(i=h.ExpandedType.KEY);var g={name:o,originalIndex:r,vlType:i,type:c,stats:t,timeStats:{},binStats:{}},m=u[g.name];return g=v.extend(g,m)}),f={nominal:0,key:1,ordinal:2,temporal:3,quantitative:4};l.sort(function(e,t){return f[e.vlType]<f[t.vlType]?-1:f[e.vlType]>f[t.vlType]?1:e.name.localeCompare(t.name)}),l.forEach(function(e,t){return e.index=t});for(var y=0,g=l;y<g.length;y++){var O=g[y];if(O.vlType===s.Type.QUANTITATIVE)for(var N=0,S=n["enum"].binProps.maxbins;N<S.length;N++){var A=S[N];O.binStats[A]=i(A,O.stats)}else if(O.vlType===s.Type.TEMPORAL)for(var P=0,C=n["enum"].timeUnit;P<C.length;P++){var b=C[P];void 0!==b&&(O.timeStats[b]=o(b,O.stats))}}var _=c({},t,{fields:l});return new E(_)}function i(e,t){var n=y({min:t.min,max:t.max,maxbins:e}),r=v.extend({},t);return r.unique=a(n,t.unique),r.distinct=(n.stop-n.start)/n.step,r.min=n.start,r.max=n.stop,r}function o(e,t){var n=v.extend({},t),r={};return v.keys(t.unique).forEach(function(n){var i,o="null"===n?null:new Date(n);i=null===o?null:isNaN(o.getTime())?"Invalid Date":(e===f.TimeUnit.DAY?o.getDay():f.convert(e,o)).toString(),r[i]=(r[i]||0)+t.unique[n]}),n.unique=r,n.distinct=v.keys(r).length,n}function a(e,t){var n={};for(var r in t){var i=void 0;i=null===r?null:isNaN(Number(r))?NaN:e.value(Number(r)),n[i]=(n[i]||0)+t[r]}return n}function u(e,t){return t.reduce(function(t,n){return e[n]?t+1:t},0)}var c=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("vega-lite/build/src/type"),l=e("vega-lite/build/src/bin"),f=e("vega-lite/build/src/timeunit"),d=e("datalib/src/stats"),p=e("datalib/src/import/type"),y=e("datalib/src/bins/bins"),g=e("./query/encoding"),h=e("./query/ExpandedType"),m=e("./config"),v=e("./util");n.build=r;var E=function(){function e(e){this._tableSchema=e,this._fieldSchemaIndex=e.fields.reduce(function(e,t){return e[t.name]=t,e},{})}return e.prototype.fieldNames=function(){return this._tableSchema.fields.map(function(e){return e.name})},Object.defineProperty(e.prototype,"fieldSchemas",{get:function(){return this._tableSchema.fields},enumerable:!0,configurable:!0}),e.prototype.fieldSchema=function(e){return this._fieldSchemaIndex[e]},e.prototype.tableSchema=function(){var e=v.duplicate(this._tableSchema);return e.fields.sort(function(e,t){return e.originalIndex-t.originalIndex}),e},e.prototype.primitiveType=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].type:null},e.prototype.vlType=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].vlType:null},e.prototype.cardinality=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var r=this._fieldSchemaIndex[e.field];if(e.aggregate||g.isAutoCountQuery(e)&&e.autoCount)return 1;if(e.bin){var a=void 0;a="boolean"==typeof e.bin?{maxbins:l.autoMaxBins(e.channel)}:e.bin;var c=a.maxbins;return r.binStats[c]||(r.binStats[c]=i(c,r.stats)),r.binStats[c].distinct}if(e.timeUnit){if(t)switch(e.timeUnit){case f.TimeUnit.SECONDS:return 60;case f.TimeUnit.MINUTES:return 60;case f.TimeUnit.HOURS:return 24;case f.TimeUnit.DAY:return 7;case f.TimeUnit.DATE:return 31;case f.TimeUnit.MONTH:return 12;case f.TimeUnit.QUARTER:return 4;case f.TimeUnit.MILLISECONDS:return 1e3}var s=e.timeUnit,d=r.timeStats;return d[s]||(d[s]=o(e.timeUnit,r.stats)),n?d[s].distinct-u(d[s].unique,["Invalid Date",null]):d[s].distinct}return r?n?r.stats.distinct-u(r.stats.unique,[NaN,null]):r.stats.distinct:null},e.prototype.timeUnitHasVariation=function(e){if(e.timeUnit){if(e.timeUnit===f.TimeUnit.DAY){var t=v.extend({},e,{timeUnit:f.TimeUnit.DATE});if(this.cardinality(t,!1,!0)<=1)return!1}for(var n=e.timeUnit,r=0,i=f.SINGLE_TIMEUNITS;r<i.length;r++){var o=i[r];if(f.containsTimeUnit(n,o)){var a=v.extend({},e,{timeUnit:o});if(this.cardinality(a,!1,!0)<=1)return!1}}return!0}},e.prototype.domain=function(e){var t=this._fieldSchemaIndex[e.field],n=v.keys(t.stats.unique);return t.vlType===s.Type.QUANTITATIVE?[+t.stats.min,+t.stats.max]:t.type===T.DATETIME?[t.stats.min,t.stats.max]:t.type===T.INTEGER||t.type===T.NUMBER?(n=n.map(function(e){return+e}),n.sort(v.cmp)):n.map(function(e){return"null"===e?null:e}).sort(v.cmp)},e.prototype.stats=function(e){var t=this._fieldSchemaIndex[e.field];return t?t.stats:null},e}();n.Schema=E;var T;!function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATETIME="datetime"]="DATETIME"}(T=n.PrimitiveType||(n.PrimitiveType={}))},{"./config":1,"./query/ExpandedType":15,"./query/encoding":16,"./util":38,"datalib/src/bins/bins":43,"datalib/src/import/type":45,"datalib/src/stats":46,"vega-lite/build/src/bin":56,"vega-lite/build/src/timeunit":66,"vega-lite/build/src/type":67}],37:[function(e,t,n){"use strict";function r(e,t,n){var r={};return e=e.map(function(e){return n.smallRangeStepForHighCardinalityOrFacet&&(e=i(e,t,r,n)),n.nominalColorScaleForHighCardinality&&(e=o(e,t,r,n)),n.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=a(e,t,r,n)),e})}function i(e,t,n,r){[u.Channel.ROW,u.Channel.Y,u.Channel.COLUMN,u.Channel.X].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)});var i=n[u.Channel.Y];if(void 0!==i&&l.isFieldQuery(i)&&(n[u.Channel.ROW]||t.cardinality(i)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===i.scale&&(i.scale={});var o=l.scaleType(i);i.scale&&(void 0===o||c.hasDiscreteDomain(o))&&(i.scale.rangeStep||(i.scale.rangeStep=12))}var a=n[u.Channel.X];if(l.isFieldQuery(a)&&(n[u.Channel.COLUMN]||t.cardinality(a)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===a.scale&&(a.scale={});var s=l.scaleType(a);a.scale&&(void 0===s||c.hasDiscreteDomain(s))&&(a.scale.rangeStep||(a.scale.rangeStep=12))}return e}function o(e,t,n,r){n[u.Channel.COLOR]=e.getEncodingQueryByChannel(u.Channel.COLOR);var i=n[u.Channel.COLOR];return l.isFieldQuery(i)&&void 0!==i&&(i.type===s.Type.NOMINAL||i.type===f.ExpandedType.KEY)&&t.cardinality(i)>r.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.range=r.nominalColorScaleForHighCardinality.palette))),e}function a(e,t,n,r){if([u.Channel.COLUMN,u.Channel.X,u.Channel.Y].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)}),void 0===n[u.Channel.COLUMN]){var i=n[u.Channel.X],o=n[u.Channel.Y];l.isFieldQuery(i)&&l.isFieldQuery(o)&&void 0!==o&&o.field&&c.hasDiscreteDomain(l.scaleType(o))&&void 0!==i&&t.cardinality(o)>r.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===i.axis&&(i.axis={}),i.axis&&!i.axis.orient&&(i.axis.orient="top"))}return e}Object.defineProperty(n,"__esModule",{value:!0});var u=e("vega-lite/build/src/channel"),c=e("vega-lite/build/src/scale"),s=e("vega-lite/build/src/type"),l=e("./query/encoding"),f=e("./query/ExpandedType");n.stylize=r,n.smallRangeStepForHighCardinalityOrFacet=i,n.nominalColorScaleForHighCardinality=o,n.xAxisOnTopForHighYCardinalityWithoutColumn=a},{"./query/ExpandedType":15,"./query/encoding":16,"vega-lite/build/src/channel":57,"vega-lite/build/src/scale":65,"vega-lite/build/src/type":67}],38:[function(e,t,n){"use strict";function r(e,t){return e.indexOf(t)!==-1}function i(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function o(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)}function a(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1}function u(e,t){return e.map(function(e){return s.isArray(e)?u(e,t):t(e)})}function c(e,t){return e.filter(function(e){return!r(t,e)})}Object.defineProperty(n,"__esModule",{value:!0});var s=e("datalib/src/util"),l=e("datalib/src/util");n.cmp=l.cmp,n.keys=l.keys,n.duplicate=l.duplicate,n.extend=l.extend,n.isObject=l.isObject,n.isArray=l.isArray,n.isBoolean=l.isBoolean,n.toMap=l.toMap,n.contains=r,n.every=i,n.forEach=o,n.some=a,n.nestedMap=u,n.without=c},{"datalib/src/util":48}],39:[function(e,t,n){"use strict";function r(e){return i(e)||o(e)}function i(e){return e===n.SHORT_WILDCARD}function o(e){return!(void 0===e||!e["enum"]&&!e.name||f.isArray(e))}function a(e,t,r){return f.extend({},{name:t,"enum":r},e===n.SHORT_WILDCARD?{}:e)}function u(e){for(var t={},n={},r=function(e){for(var r=[0],i=0;i<e.length;i++)e.charAt(i).toUpperCase()===e.charAt(i)&&r.push(i);var o=r.map(function(t){return e.charAt(t)}).join("").toLowerCase();if(!n[o])return t[e]=o,n[o]=!0,"continue";if(r[r.length-1]!==e.length-1&&(o=r.concat([e.length-1]).map(function(t){return e.charAt(t)}).join("").toLowerCase(),!n[o]))return t[e]=o,n[o]=!0,"continue";for(var i=1;!t[e];i++){var a=o+"_"+i;if(!n[a]){t[e]=a,n[a]=!0;break}}},i=0,o=e;i<o.length;i++){var a=o[i];r(a)}return t}function c(e){if(l.isEncodingNestedProp(e))return n.DEFAULT_NAME[e.parent]+"-"+n.DEFAULT_NAME[e.parent+"Props"][e.child];if(n.DEFAULT_NAME[e])return n.DEFAULT_NAME[e];throw new Error("Default name undefined for "+e)}function s(e,t,n){if("field"===e||l.isEncodingNestedProp(e)&&"sort"===e.parent&&"field"===e.child)return t.fieldNames();var r;if(r=l.isEncodingNestedProp(e)?n["enum"][e.parent+"Props"][e.child]:n["enum"][e],void 0!==r)return r;throw new Error("No default enumValues for "+JSON.stringify(e))}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./property"),f=e("./util"),d=e("vega-lite/build/src/axis"),p=e("vega-lite/build/src/channel"),y=e("vega-lite/build/src/mark"),g=e("vega-lite/build/src/scale"),h=e("vega-lite/build/src/legend"),m=e("vega-lite/build/src/timeunit"),v=e("vega-lite/build/src/type");n.SHORT_WILDCARD="?",n.isWildcard=r,n.isShortWildcard=i,n.isWildcardDef=o,n.initWildcard=a,n.DEFAULT_NAME={mark:"m",channel:"c",aggregate:"a",autoCount:"#",hasFn:"h",bin:"b",sort:"so",scale:"s",axis:"ax",legend:"l",timeUnit:"tu",field:"f",type:"t",binProps:{maxbins:"mb",min:"mi",max:"ma",base:"b",step:"s",steps:"ss",minstep:"ms",divide:"d"},sortProps:{field:"f",op:"o",order:"or"},scaleProps:u(g.SCALE_PROPERTIES),axisProps:u(d.AXIS_PROPERTIES),legendProps:u(h.LEGEND_PROPERTIES)},n.getDefaultName=c;var E=[!1,!0],T={maxbins:[5,10,20],extent:[void 0],base:[10],step:[void 0],steps:[void 0],minstep:[void 0],divide:[[5,2]]},O={field:[void 0],op:["min","mean"],order:["ascending","descending"]},N={type:[void 0,g.ScaleType.LOG],domain:[void 0],exponent:[1,2],clamp:E,nice:E,round:E,zero:E,padding:[void 0],paddingInner:[void 0],paddingOuter:[void 0],interpolate:[void 0],range:[void 0],rangeStep:[17,21],scheme:[void 0]},S={zindex:[1,0],offset:[void 0],orient:[void 0],values:[void 0],domain:E,grid:E,format:[void 0],labels:E,labelAngle:[void 0],labelPadding:[void 0],maxExtent:[void 0],minExtent:[void 0],position:[void 0],ticks:E,tickCount:[void 0],tickSize:[void 0],title:[void 0],titleMaxLength:[void 0],titlePadding:[void 0]},A={entryPadding:[void 0],orient:["left","right"],offset:[void 0],format:[void 0],values:[void 0],tickCount:[void 0],title:[void 0],type:[void 0],zindex:[void 0]};n.DEFAULT_ENUM_INDEX={mark:[y.Mark.POINT,y.Mark.BAR,y.Mark.LINE,y.Mark.AREA,y.Mark.TICK],channel:[p.X,p.Y,p.ROW,p.COLUMN,p.SIZE,p.COLOR],aggregate:[void 0,"mean"],autoCount:E,bin:E,hasFn:E,timeUnit:[void 0,m.TimeUnit.YEAR,m.TimeUnit.MONTH,m.TimeUnit.MINUTES,m.TimeUnit.SECONDS],field:[void 0],type:[v.Type.NOMINAL,v.Type.ORDINAL,v.Type.QUANTITATIVE,v.Type.TEMPORAL],sort:["ascending","descending"],scale:[!0],axis:E,legend:E,binProps:T,sortProps:O,scaleProps:N,axisProps:S,legendProps:A},n.getDefaultEnumValues=s},{"./property":13,"./util":38,"vega-lite/build/src/axis":55,"vega-lite/build/src/channel":57,"vega-lite/build/src/legend":61,"vega-lite/build/src/mark":64,"vega-lite/build/src/scale":65,"vega-lite/build/src/timeunit":66,"vega-lite/build/src/type":67}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./property"),i=e("./propindex"),o=function(){function e(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty=new i.PropIndex}return e.prototype.setEncodingProperty=function(e,t,n){var r=this._encodings,o=r[e]=r[e]||new i.PropIndex;o.set(t,n);var a=this._encodingIndicesByProperty;return a.set(t,a.get(t)||[]),a.get(t).push(e),this},e.prototype.hasEncodingProperty=function(e,t){return!!this._encodings[e]&&this._encodings[e].has(t)},e.prototype.hasProperty=function(e){if(r.isEncodingProperty(e))return this.encodingIndicesByProperty.has(e);if("mark"===e)return!!this.mark;throw new Error("Unimplemented for property "+e)},e.prototype.isEmpty=function(){return!this.mark&&0===this.encodingIndicesByProperty.size()},e.prototype.setMark=function(e){return this._mark=e,this},Object.defineProperty(e.prototype,"mark",{get:function(){return this._mark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodings",{get:function(){return this._encodings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodingIndicesByProperty",{get:function(){return this._encodingIndicesByProperty},enumerable:!0,configurable:!0}),e}();n.WildcardIndex=o},{"./property":13,"./propindex":14}],41:[function(e,t,n){},{}],42:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(t.d3_time={})}(this,function(e){"use strict";function t(e,n,r,a){function u(t){return e(t=new Date((+t))),t}return u.floor=u,u.round=function(t){var r=new Date((+t)),i=new Date(t-1);return e(r),e(i),n(i,1),t-r<i-t?r:i},u.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},u.offset=function(e,t){return n(e=new Date((+e)),null==t?1:Math.floor(t)),e},u.range=function(t,r,i){var o=[];if(t=new Date(t-1),r=new Date((+r)),i=null==i?1:Math.floor(i),!(t<r&&i>0))return o;for(n(t,1),e(t),t<r&&o.push(new Date((+t)));n(t,i),e(t),t<r;)o.push(new Date((+t)));return o},u.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(u.count=function(t,n){return i.setTime(+t),o.setTime(+n),e(i),e(o),Math.floor(r(i,o))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(a?function(t){return a(t)%e===0}:function(t){return u.count(0,t)%e===0}):u:null}),u}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,o=new Date,a=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});a.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):a:null};var u=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),c=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),s=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),f=n(0),d=n(1),p=n(2),y=n(3),g=n(4),h=n(5),m=n(6),v=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),E=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),T=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),O=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),N=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),S=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),A=r(0),P=r(1),C=r(2),b=r(3),_=r(4),I=r(5),M=r(6),R=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),U=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),D=a.range,w=u.range,L=c.range,x=s.range,F=l.range,k=f.range,Q=d.range,H=p.range,Y=y.range,j=g.range,B=h.range,W=m.range,G=f.range,q=v.range,V=E.range,z=a,X=D,K=T.range,$=O.range,J=N.range,Z=S.range,ee=A.range,te=P.range,ne=C.range,re=b.range,ie=_.range,oe=I.range,ae=M.range,ue=A.range,ce=R.range,se=U.range,le="0.1.1";e.version=le,e.milliseconds=D,e.seconds=w,e.minutes=L,e.hours=x,e.days=F,e.sundays=k,e.mondays=Q,e.tuesdays=H,e.wednesdays=Y,e.thursdays=j,e.fridays=B,e.saturdays=W,e.weeks=G,e.months=q,e.years=V,e.utcMillisecond=z,e.utcMilliseconds=X,e.utcSeconds=K,e.utcMinutes=$,e.utcHours=J,e.utcDays=Z,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=oe,e.utcSaturdays=ae,e.utcWeeks=ue,e.utcMonths=ce,e.utcYears=se,e.millisecond=a,e.second=u,e.minute=c,e.hour=s,e.day=l,e.sunday=f,e.monday=d,e.tuesday=p,e.wednesday=y,e.thursday=g,e.friday=h,e.saturday=m,e.week=f,e.month=v,e.year=E,e.utcSecond=T,e.utcMinute=O,e.utcHour=N,e.utcDay=S,e.utcSunday=A,e.utcMonday=P,e.utcTuesday=C,e.utcWednesday=b,e.utcThursday=_,e.utcFriday=I,e.utcSaturday=M,e.utcWeek=A,e.utcMonth=R,e.utcYear=U,e.interval=t})},{}],43:[function(e,t,n){function r(e){if(!e)throw Error("Missing binning options.");var t,n,r,u,c,s,l,f=e.maxbins||15,d=e.base||10,p=Math.log(d),y=e.div||[5,2],g=e.min,h=e.max,m=h-g;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,m/f,0,e.steps.length))];else{for(n=Math.ceil(Math.log(f)/p),r=e.minstep||0,t=Math.max(r,Math.pow(d,Math.round(Math.log(m)/p)-n));Math.ceil(m/t)>f;)t*=d;for(s=0;s<y.length;++s)c=t/y[s],c>=r&&m/c<=f&&(t=c)}return c=Math.log(t),u=c>=0?0:~~(-c/p)+1,l=Math.pow(d,-u-1),g=Math.min(g,Math.floor(g/t+l)*t),h=Math.ceil(h/t)*t,{start:g,stop:h,step:t,unit:{precision:u},value:o,index:a}}function i(e,t,n,r){for(;n<r;){var i=n+r>>>1;s.cmp(e[i],t)<0?n=i+1:r=i}return n}function o(e){return this.step*Math.floor(e/this.step+f)}function a(e){return Math.floor((e-this.start)/this.step+f)}function u(e){return this.unit.date(o.call(this,e))}function c(e){return a.call(this,this.unit.unit(e))}var s=e("../util"),l=e("../time"),f=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?l.utc:l,n=e.min,i=e.max,o=e.maxbins||20,a=e.minbins||4,s=+i-+n,f=e.unit?t[e.unit]:t.find(s,a,o),d=r({min:null!=f.min?f.min:f.unit(n),max:null!=f.max?f.max:f.unit(i),maxbins:o,minstep:f.minstep,steps:f.step});return d.unit=f,d.index=c,e.raw||(d.value=u),d},t.exports=r},{"../time":47,"../util":48}],44:[function(e,t,n){var r=e("./util"),i=t.exports;i.repeat=function(e,t){var n,r=Array(t);for(n=0;n<t;++n)r[n]=e;return r},i.zeros=function(e){return i.repeat(0,e)},i.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],o=-1;if(n<0)for(;(r=e+n*++o)>t;)i.push(r);else for(;(r=e+n*++o)<t;)i.push(r);return i},i.random={},i.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,r=function(){return e+n*Math.random()};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r>=e&&r<=t?1/n:0},r.cdf=function(r){return r<e?0:r>t?1:(r-e)/n},r.icdf=function(t){return t>=0&&t<=1?e+t*n:NaN},r},i.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,r=function(){return e+Math.floor(n*Math.random())};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r===Math.floor(r)&&r>=e&&r<t?1/n:0},r.cdf=function(r){var i=Math.floor(r);return i<e?0:i>=t?1:(i-e+1)/n},r.icdf=function(t){return t>=0&&t<=1?e-1+Math.floor(t*n):NaN},r},i.random.normal=function(e,t){e=e||0,t=t||1;var n,r=function(){var r,i,o=0,a=0;if(void 0!==n)return o=n,n=void 0,o;do o=2*Math.random()-1,a=2*Math.random()-1,r=o*o+a*a;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=e+a*i*t,e+o*i*t};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(n){var r=Math.exp(Math.pow(n-e,2)/(-2*Math.pow(t,2)));return 1/(t*Math.sqrt(2*Math.PI))*r},r.cdf=function(n){var r,i=(n-e)/t,o=Math.abs(i);if(o>37)r=0;else{var a,u=Math.exp(-o*o/2);o<7.07106781186547?(a=.0352624965998911*o+.700383064443688,a=a*o+6.37396220353165,a=a*o+33.912866078383,a=a*o+112.079291497871,a=a*o+221.213596169931,a=a*o+220.206867912376,r=u*a,a=.0883883476483184*o+1.75566716318264,a=a*o+16.064177579207,a=a*o+86.7807322029461,a=a*o+296.564248779674,a=a*o+637.333633378831,a=a*o+793.826512519948,a=a*o+440.413735824752,r/=a):(a=o+.65,a=o+4/a,a=o+3/a,a=o+2/a,a=o+1/a,r=u/a/2.506628274631)}return i>0?1-r:r},r.icdf=function(n){if(n<=0||n>=1)return NaN;var r=2*n-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,a=Math.log(1-r*r)/i,u=(r>0?1:-1)*Math.sqrt(Math.sqrt(o*o-a)-o);return e+t*Math.SQRT2*u},r},i.random.bootstrap=function(e,t){var n=e.filter(r.isValid),o=n.length,a=t?i.random.normal(0,t):null,u=function(){return n[~~(Math.random()*o)]+(a?a():0)};return u.samples=function(e){return i.zeros(e).map(u)},u}},{"./util":48}],45:[function(e,t,n){function r(e,t){return t?void(e[f]=t):e&&e[f]||null}function i(e){return l.keys(e)}function o(e){return"["+e+"]"}function a(e,t){e=l.array(e),t=l.$(t);var n,r,i;if(e[f]&&(n=t(e[f]),l.isString(n)))return n;for(r=0,i=e.length;!l.isValid(n)&&r<i;++r)n=t?t(e[r]):e[r];return l.isDate(n)?"date":l.isNumber(n)?"number":l.isBoolean(n)?"boolean":l.isString(n)?"string":null}function u(e,t){if(e.length){var n=t?l.identity:(t=i(e[0]),o);return t.reduce(function(t,r){return t[r]=a(e,n(r)),t},{})}}function c(e,t){e=l.array(e),t=l.$(t);var n,r,i,o=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<o.length;++r)l.isValid(i)&&!p[o[r]](i)&&(o.splice(r,1),r-=1);if(0===o.length)return"string"}return o[0]}function s(e,t){var n=t?l.identity:(t=i(e[0]),o);return t.reduce(function(t,r){return t[r]=c(e,n(r)),t},{})}var l=e("../util"),f="__types__",d={"boolean":l["boolean"],integer:l.number,number:l.number,date:l.date,string:function(e){return null==e||""===e?null:e+""}},p={"boolean":function(e){return"true"===e||"false"===e||l.isBoolean(e)},integer:function(e){return p.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!l.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};a.annotation=r,a.all=u,a.infer=c,a.inferAll=s,a.parsers=d,t.exports=a},{"../util":48}],46:[function(e,t,n){function r(e,t,n){var r=e&&e.nullh||0,i=c.random.normal(0,1),o=s.mean(t,n),a=s.stdev(t,n)/Math.sqrt(s.count.valid(t,n));
if(0===a)return o-r===0?1:0;var u=(o-r)/a;return 2*i.cdf(-Math.abs(u))}function i(e,t,n,r){var i,o=r?t.map(a.$(n)):t,u=r?t.map(a.$(r)):n,c=s.count(o),l=s.count(u),f=Array();if(c!==l)throw Error("Array lengths must match.");for(i=0;i<c;++i)a.isValid(o[i])&&a.isValid(u[i])&&f.push(o[i]-u[i]);return s.z.test(f,e&&e.nullh||0)}function o(e,t,n,r){var i=r?t.map(a.$(n)):t,o=r?t.map(a.$(r)):n,u=s.count.valid(i),l=s.count.valid(o),f=c.random.normal(0,1),d=s.mean(i)-s.mean(o)-(e&&e.nullh||0),p=Math.sqrt(s.variance(i)/u+s.variance(o)/l);if(0===p)return 0===d?1:0;var y=d/p;return 2*f.cdf(-Math.abs(y))}var a=e("./util"),u=e("./import/type"),c=e("./generate"),s=t.exports;s.unique=function(e,t,n){t=a.$(t),n=n||[];var r,i,o,u={};for(i=0,o=e.length;i<o;++i)r=t?t(e[i]):e[i],r in u||(u[r]=1,n.push(r));return n},s.count=function(e){return e&&e.length||0},s.count.valid=function(e,t){t=a.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],a.isValid(n)&&(o+=1);return o},s.count.missing=function(e,t){t=a.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],null==n&&(o+=1);return o},s.count.distinct=function(e,t){t=a.$(t);var n,r,i,o={},u=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],n in o||(o[n]=1,u+=1);return u},s.count.map=function(e,t){t=a.$(t);var n,r,i,o={};for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],o[n]=n in o?o[n]+1:1;return o},s.median=function(e,t){return t&&(e=e.map(a.$(t))),e=e.filter(a.isValid).sort(a.cmp),s.quantile(e,.5)},s.quartile=function(e,t){t&&(e=e.map(a.$(t))),e=e.filter(a.isValid).sort(a.cmp);var n=s.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},s.quantile=function(e,t,n){void 0===n&&(n=t,t=a.identity),t=a.$(t);var r=(e.length-1)*n+1,i=Math.floor(r),o=+t(e[i-1]),u=r-i;return u?o+u*(t(e[i])-o):o},s.sum=function(e,t){t=a.$(t);for(var n,r=0,i=0,o=e.length;i<o;++i)n=t?t(e[i]):e[i],a.isValid(n)&&(r+=n);return r},s.mean=function(e,t){t=a.$(t);var n,r,i,o,u,c=0;for(r=0,o=0,i=e.length;r<i;++r)u=t?t(e[r]):e[r],a.isValid(u)&&(n=u-c,c+=n/++o);return c},s.mean.geometric=function(e,t){t=a.$(t);var n,r,i,o,u=1;for(o=0,n=0,r=e.length;o<r;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){if(i<=0)throw Error("Geometric mean only defined for positive values.");u*=i,++n}return u=n>0?Math.pow(u,1/n):0},s.mean.harmonic=function(e,t){t=a.$(t);var n,r,i,o,u=0;for(o=0,n=0,r=e.length;o<r;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(u+=1/i,++n);return n/u},s.variance=function(e,t){if(t=a.$(t),!a.isArray(e)||e.length<2)return 0;var n,r,i,o,u=0,c=0;for(r=0,i=0;r<e.length;++r)o=t?t(e[r]):e[r],a.isValid(o)&&(n=o-u,u+=n/++i,c+=n*(o-u));return c/=i-1},s.stdev=function(e,t){return Math.sqrt(s.variance(e,t))},s.modeskew=function(e,t){var n=s.mean(e,t),r=s.median(e,t),i=s.stdev(e,t);return 0===i?0:(n-r)/i},s.min=function(e,t){return s.extent(e,t)[0]},s.max=function(e,t){return s.extent(e,t)[1]},s.extent=function(e,t){t=a.$(t);var n,r,i,o,u=e.length;for(o=0;o<u;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){n=r=i;break}for(;o<u;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(i<n&&(n=i),i>r&&(r=i));return[n,r]},s.extent.index=function(e,t){t=a.$(t);var n,r,i,o,u=-1,c=-1,s=e.length;for(o=0;o<s;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){n=r=i,u=c=o;break}for(;o<s;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(i<n&&(n=i,u=o),i>r&&(r=i,c=o));return[u,c]},s.dot=function(e,t,n){var r,i,o=0;if(n)for(t=a.$(t),n=a.$(n),r=0;r<e.length;++r)i=t(e[r])*n(e[r]),i===i&&(o+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)i=e[r]*t[r],i===i&&(o+=i)}return o},s.dist=function(e,t,n,r){var i,o,u=a.isFunction(n)||a.isString(n),c=e,s=u?e:t,l=u?r:n,f=2===l||null==l,d=e.length,p=0;for(u&&(t=a.$(t),n=a.$(n)),o=0;o<d;++o)i=u?t(c[o])-n(s[o]):c[o]-s[o],p+=f?i*i:Math.pow(Math.abs(i),l);return f?Math.sqrt(p):Math.pow(p,1/l)},s.cohensd=function(e,t,n){var r=n?e.map(a.$(t)):e,i=n?e.map(a.$(n)):t,o=s.mean(r),u=s.mean(i),c=s.count.valid(r),l=s.count.valid(i);if(c+l-2<=0)return 0;var f=s.variance(r),d=s.variance(i),p=Math.sqrt(((c-1)*f+(l-1)*d)/(c+l-2));return 0===p?0:(o-u)/p},s.covariance=function(e,t,n){var r,i,o,u,c,l=n?e.map(a.$(t)):e,f=n?e.map(a.$(n)):t,d=l.length,p=s.mean(l),y=s.mean(f),g=0,h=0;if(d!==f.length)throw Error("Input lengths must match.");for(r=0;r<d;++r)if(i=l[r],u=a.isValid(i),o=f[r],c=a.isValid(o),u&&c)g+=(i-p)*(o-y),++h;else if(u||c)throw Error("Valid values must align.");return g/(h-1)},s.rank=function(e,t){t=a.$(t)||a.identity;var n,r,i,o=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(a.comparator("val")),u=e.length,c=Array(u),s=-1,l={};for(n=0;n<u;++n){if(r=o[n].val,s<0&&l===r)s=n-1;else if(s>-1&&l!==r){for(i=1+(n-1+s)/2;s<n;++s)c[o[s].idx]=i;s=-1}c[o[n].idx]=n+1,l=r}if(s>-1)for(i=1+(u-1+s)/2;s<u;++s)c[o[s].idx]=i;return c},s.cor=function(e,t,n){var r=n;n=r?e.map(a.$(n)):t,t=r?e.map(a.$(t)):e;var i=s.dot(t,n),o=s.mean(t),u=s.mean(n),c=s.stdev(t),l=s.stdev(n),f=e.length;return(i-f*o*u)/((f-1)*c*l)},s.cor.rank=function(e,t,n){var r,i,o,a=n?s.rank(e,t):s.rank(e),u=n?s.rank(e,n):s.rank(t),c=e.length;for(r=0,i=0;r<c;++r)o=a[r]-u[r],i+=o*o;return 1-6*i/(c*(c*c-1))},s.cor.dist=function(e,t,n){var r,i,o,u,c=n?e.map(a.$(t)):e,l=n?e.map(a.$(n)):t,f=s.dist.mat(c),d=s.dist.mat(l),p=f.length;for(r=0,i=0,o=0,u=0;r<p;++r)i+=f[r]*f[r],o+=d[r]*d[r],u+=f[r]*d[r];return Math.sqrt(u/Math.sqrt(i*o))},s.linearRegression=function(e,t,n){var r,i,o=n?e.map(a.$(t)):e,u=n?e.map(a.$(n)):t,c=o.length,l=s.covariance(o,u),f=s.stdev(o),d=s.stdev(u),p=l/(f*f),y=s.mean(u)-p*s.mean(o),g={slope:p,intercept:y,R:l/(f*d),rss:0};for(i=0;i<c;++i)a.isValid(o[i])&&a.isValid(u[i])&&(r=p*o[i]+y-u[i],g.rss+=r*r);return g},s.bootstrap={},s.bootstrap.ci=function(e,t,n,r,i){var o,u,l,f,d,p,y;for(a.isFunction(t)||a.isString(t)?(o=e.map(a.$(t)),u=n,l=r,f=i):(o=e,u=t,l=n,f=r),u=u?+u:1e3,l=l||.05,d=c.random.bootstrap(o,f),y=0,p=Array(u);y<u;++y)p[y]=s.mean(d.samples(o.length));return p.sort(a.numcmp),[s.quantile(p,l/2),s.quantile(p,1-l/2)]},s.z={},s.z.ci=function(e,t,n){var r=e,i=t;(a.isFunction(t)||a.isString(t))&&(r=e.map(a.$(t)),i=n),i=i||.05;var o=.05===i?1.96:c.random.normal(0,1).icdf(1-i/2),u=s.mean(r),l=s.stdev(r)/Math.sqrt(s.count.valid(r));return[u-o*l,u+o*l]},s.z.test=function(e,t,n,u){return a.isFunction(n)||a.isString(n)?(u&&u.paired?i:o)(u,e,t,n):a.isArray(t)?(n&&n.paired?i:o)(n,e,t):a.isFunction(t)||a.isString(t)?r(n,e,t):r(t,e)},s.dist.mat=function(e){var t,n,r,i=e.length,o=i*i,a=Array(o),u=c.zeros(i),s=0;for(n=0;n<i;++n)for(a[n*i+n]=0,r=n+1;r<i;++r)a[n*i+r]=t=Math.abs(e[n]-e[r]),a[r*i+n]=t,u[n]+=t,u[r]+=t;for(n=0;n<i;++n)s+=u[n],u[n]/=i;for(s/=o,n=0;n<i;++n)for(r=n;r<i;++r)a[n*i+r]+=s-u[n]-u[r],a[r*i+n]=a[n*i+r];return a},s.entropy=function(e,t){t=a.$(t);var n,r,i=0,o=0,u=e.length;for(n=0;n<u;++n)i+=t?t(e[n]):e[n];if(0===i)return 0;for(n=0;n<u;++n)r=(t?t(e[n]):e[n])/i,r&&(o+=r*Math.log(r));return-o/Math.LN2},s.mutual=function(e,t,n,r){var i,o,u,c=r?e.map(a.$(t)):e,s=r?e.map(a.$(n)):t,l=r?e.map(a.$(r)):n,f={},d={},p=l.length,y=0,g=0,h=0;for(u=0;u<p;++u)f[c[u]]=0,d[s[u]]=0;for(u=0;u<p;++u)f[c[u]]+=l[u],d[s[u]]+=l[u],y+=l[u];for(o=1/(y*Math.LN2),u=0;u<p;++u)0!==l[u]&&(i=y*l[u]/(f[c[u]]*d[s[u]]),g+=l[u]*o*Math.log(i),h+=l[u]*o*Math.log(l[u]/y));return[g,1+g/h]},s.mutual.info=function(e,t,n,r){return s.mutual(e,t,n,r)[0]},s.mutual.dist=function(e,t,n,r){return s.mutual(e,t,n,r)[1]},s.profile=function(e,t){var n,r,i,o,c,l=0,f=0,d=0,p=0,y=null,g=null,h=0,m=[],v={};for(i=0;i<e.length;++i)o=t?t(e[i]):e[i],v[o]=o in v?v[o]+1:(p+=1,1),null==o?++d:a.isValid(o)&&(c="string"==typeof o?o.length:o,(null===y||c<y)&&(y=c),(null===g||c>g)&&(g=c),n=c-l,l+=n/++f,h+=n*(c-l),m.push(c));return h/=f-1,r=Math.sqrt(h),m.sort(a.cmp),{type:u(e,t),unique:v,count:e.length,valid:f,missing:d,distinct:p,min:y,max:g,mean:l,stdev:r,median:o=s.quantile(m,.5),q1:s.quantile(m,.25),q3:s.quantile(m,.75),modeskew:0===r?0:(l-o)/r}},s.summary=function(e,t){t=t||a.keys(e[0]);var n=t.map(function(t){var n=s.profile(e,a.$(t));return n.field=t,n});return n.__summary__=!0,n}},{"./generate":44,"./import/type":45,"./util":48}],47:[function(e,t,n){function r(e){return s.setTime(+e),s}function i(e,t,n,r,i,o){var a={type:e,date:t,unit:n};return r?a.step=r:a.minstep=1,null!=i&&(a.min=i),null!=o&&(a.max=o),a}function o(e,t,n,r,o,a){return i(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},r,o,a)}function a(e,t,n,r){var i,o,a,u=y[0];for(i=1,o=y.length;i<o;++i)if(u=y[i],t>u[0]){if(a=t/u[0],a>r)return e[y[i-1][1]];if(a>=n)return e[u[1]]}return e[y[o-1][1]]}function u(e){var t,n,r={};for(t=0,n=e.length;t<n;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return a(e,t,n,r)},r}var c=e("d3-time"),s=new Date,l=new Date(0,0,1).setFullYear(0),f=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),d=[o("second",c.second,l),o("minute",c.minute,l),o("hour",c.hour,l),o("day",c.day,l,[1,7]),o("month",c.month,l,[1,3,6]),o("year",c.year,l),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return r(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return r(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return r(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return r(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return r(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return r(e).getMonth()},[1],0,11)],p=[o("second",c.utcSecond,f),o("minute",c.utcMinute,f),o("hour",c.utcHour,f),o("day",c.utcDay,f,[1,7]),o("month",c.utcMonth,f,[1,3,6]),o("year",c.utcYear,f),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return r(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return r(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return r(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return r(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return r(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return r(e).getUTCMonth()},[1],0,11)],y=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=u(d),t.exports.utc=u(p)},{"d3-time":42}],48:[function(e,t,n){(function(e){function n(e,t){var n,r="";for(n=0;n<e;++n)r+=t;return r}function r(e,t,n){var r=0,i=e.split(c);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,r<=t}).reverse():i.filter(function(e){return r+=e.length,r<=t}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports,o="__name__";i.namedfunc=function(e,t){return t[o]=e,t},i.name=function(e){return null==e?null:e[o]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},i.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},i.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},i.toMap=function(e,t){return(t=i.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},i.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;r<t;++r)n+="|"+String(e[r]);return n};var a=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===a.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===a.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===a.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===a.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==a.call(e)},i.isDate=function(e){return"[object Date]"===a.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"!==e&&!!e},i.date=function(e,t){var n=t?t:Date;return null==e||""===e?null:n.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var t;return i.isString(e)&&(t=i.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},i.$func=function(e,t){return function(n){n=i.$(n)||i.identity;var r=e+(i.name(n)?"_"+i.name(n):"");return i.namedfunc(r,function(e){return t(n(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,t){e=i.$(e);var n=i.isArray(t)?i.toMap(t):t;return function(t){return!!n[e(t)]}},i.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),i.accessor(e)}),function(n,r){var o,a,u,c;for(o=0,a=e.length;o<a;++o)if(u=e[o],c=i.cmp(u(n),u(r)))return c*t[o];return 0}},i.cmp=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0)},i.numcmp=function(e,t){return e-t},i.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var o=t(e),a=t(i);return o<a?-1:o>a?1:r[n(e)]-r[n(i)]}),e},i.permute=function(e){for(var t,n,r=e.length;r;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t},i.pad=function(e,t,r,i){i=i||" ";var o=t-e.length;if(o<=0)return e;switch(r){case"left":return n(o,i)+e;case"middle":case"center":return n(Math.floor(o/2),i)+e+n(Math.ceil(o/2),i);default:return e+n(o,i)}},i.truncate=function(e,t,n,i,o){var a=e.length;if(a<=t)return e;o=void 0!==o?String(o):"";var u=Math.max(0,t-o.length);switch(n){case"left":return o+(i?r(e,u,1):e.slice(a-u));case"middle":case"center":var c=Math.ceil(u/2),s=Math.floor(u/2);return(i?r(e,c):e.slice(0,c))+o+(i?r(e,s,1):e.slice(a-s));default:return(i?r(e,u):e.slice(0,u))+o}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:41}],49:[function(e,t,n){var r="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var a="boolean"==typeof t.cycles&&t.cycles,u=t.replacer||function(e,t){return t},c=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},o={key:r,value:t[r]};return e(i,o)}}}(t.cmp),s=[];return function l(e,t,f,d){var p=n?"\n"+new Array(d+1).join(n):"",y=n?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),f=u.call(e,t,f),void 0!==f){if("object"!=typeof f||null===f)return r.stringify(f);if(i(f)){for(var g=[],h=0;h<f.length;h++){var m=l(f,h,f[h],d+1)||r.stringify(null);g.push(p+n+m)}return"["+g.join(",")+p+"]"}if(s.indexOf(f)!==-1){if(a)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}s.push(f);for(var v=o(f).sort(c&&c(f)),g=[],h=0;h<v.length;h++){var t=v[h],E=l(f,t,f[t],d+1);if(E){var T=r.stringify(t)+y+E;g.push(p+n+T)}}return s.splice(s.indexOf(f),1),"{"+g.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},o=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n}},{jsonify:50}],50:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":51,"./lib/stringify":52}],51:[function(e,t,n){var r,i,o,a,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},c=function(e){throw{name:"SyntaxError",message:e,at:r,text:o}},s=function(e){return e&&e!==i&&c("Expected '"+e+"' instead of '"+i+"'"),i=o.charAt(r),r+=1,i},l=function(){var e,t="";for("-"===i&&(t="-",s("-"));i>="0"&&i<="9";)t+=i,s();if("."===i)for(t+=".";s()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,s(),"-"!==i&&"+"!==i||(t+=i,s());i>="0"&&i<="9";)t+=i,s();return e=+t,isFinite(e)?e:void c("Bad number")},f=function(){var e,t,n,r="";if('"'===i)for(;s();){if('"'===i)return s(),r;if("\\"===i)if(s(),"u"===i){for(n=0,t=0;t<4&&(e=parseInt(s(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof u[i])break;r+=u[i]}else r+=i}c("Bad string")},d=function(){for(;i&&i<=" ";)s()},p=function(){switch(i){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}c("Unexpected '"+i+"'")},y=function(){var e=[];if("["===i){if(s("["),d(),"]"===i)return s("]"),e;for(;i;){if(e.push(a()),d(),"]"===i)return s("]"),e;s(","),d()}}c("Bad array")},g=function(){var e,t={};if("{"===i){if(s("{"),d(),"}"===i)return s("}"),t;for(;i;){if(e=f(),d(),s(":"),Object.hasOwnProperty.call(t,e)&&c('Duplicate key "'+e+'"'),t[e]=a(),d(),"}"===i)return s("}"),t;s(","),d()}}c("Bad object")};a=function(){switch(d(),i){case"{":return g();case"[":return y();case'"':return f();case"-":return l();default:return i>="0"&&i<="9"?l():p()}},t.exports=function(e,t){var n;return o=e,r=0,i=" ",n=a(),d(),i&&c("Syntax error"),"function"==typeof t?function u(e,n){var r,i,o=e[n];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i=u(o,r),void 0!==i?o[r]=i:delete o[r]);return t.call(e,n,o)}({"":n},""):n}},{}],52:[function(e,t,n){function r(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var n,c,s,l,f,d=o,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof u&&(p=u.call(t,e,p)),typeof p){case"string":return r(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(o+=a,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(l=p.length,n=0;n<l;n+=1)f[n]=i(n,p)||"null";return s=0===f.length?"[]":o?"[\n"+o+f.join(",\n"+o)+"\n"+d+"]":"["+f.join(",")+"]",o=d,s}if(u&&"object"==typeof u)for(l=u.length,n=0;n<l;n+=1)c=u[n],"string"==typeof c&&(s=i(c,p),s&&f.push(r(c)+(o?": ":":")+s));else for(c in p)Object.prototype.hasOwnProperty.call(p,c)&&(s=i(c,p),s&&f.push(r(c)+(o?": ":":")+s));return s=0===f.length?"{}":o?"{\n"+o+f.join(",\n"+o)+"\n"+d+"}":"{"+f.join(",")+"}",o=d,s}}var o,a,u,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var r;if(o="",a="","number"==typeof n)for(r=0;r<n;r+=1)a+=" ";else"string"==typeof n&&(a=n);if(u=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],53:[function(t,n,r){(function(t){var r,i,o,a,u,c,s,l,f,d,p,y,g,h,m,v;!function(r){function i(e,t){return function(n,r){return e[n]=t?t(n,r):r}}var o="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:{};"function"==typeof e&&e.amd?e("tslib",["exports"],function(e){r(i(o,i(e)))}):r("object"==typeof n&&"object"==typeof n.exports?i(o,i(n.exports)):i(o))}(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};r=function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]]);return n},a=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},u=function(e,t){return function(n,r){t(n,r,e)}},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function u(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}c((r=r.apply(e,t||[])).next())})},l=function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,u,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},f=function(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},d=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},p=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(u){i={error:u}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a},y=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},g=function(e){return this instanceof g?(this.v=e,this):new g(e)},h=function(e,t,n){function r(e){l[e]&&(s[e]=function(t){return new Promise(function(n,r){f.push([e,t,n,r])>1||i(e,t)})})}function i(e,t){try{o(l[e](t))}catch(n){c(f[0][3],n)}}function o(e){e.value instanceof g?Promise.resolve(e.value.v).then(a,u):c(f[0][2],e)}function a(e){i("next",e)}function u(e){i("throw",e)}function c(e,t){e(t),f.shift(),f.length&&i(f[0][0],f[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,l=n.apply(e,t||[]),f=[];return s={},r("next"),r("throw"),r("return"),s[Symbol.asyncIterator]=function(){return this},s},m=function(e){function t(t,i){e[t]&&(n[t]=function(n){return(r=!r)?{value:g(e[t](n)),done:"return"===t}:i?i(n):n})}var n,r;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n},v=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof d?d(e):e[Symbol.iterator]()},e("__extends",r),e("__assign",i),e("__rest",o),e("__decorate",a),e("__param",u),e("__metadata",c),e("__awaiter",s),e("__generator",l),e("__exportStar",f),e("__values",d),e("__read",p),e("__spread",y),e("__await",g),e("__asyncGenerator",h),e("__asyncDelegator",m),e("__asyncValues",v)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util");n.AGGREGATE_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","ci0","ci1","modeskew","min","max","argmin","argmax"],n.AGGREGATE_OP_INDEX=r.toSet(n.AGGREGATE_OPS),n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],n.SHARED_DOMAIN_OP_INDEX=r.toSet(n.SHARED_DOMAIN_OPS)},{"./util":68}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"]},{}],56:[function(e,t,n){"use strict";function r(e){return a.isBoolean(e)?"bin":"bin"+a.keys(e).map(function(t){return"_"+t+"_"+e[t]}).join("")}function i(e){switch(e){case o.ROW:case o.COLUMN:case o.SIZE:case o.COLOR:case o.OPACITY:case o.SHAPE:return 6;default:return 10}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./channel"),a=e("./util");n.binToString=r,n.autoMaxBins=i},{"./channel":57,"./util":68}],57:[function(e,t,n){"use strict";function r(e){return!!p[e]}function i(e){return!!y[e]}function o(e,t){return t in a(e)}function a(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.TOOLTIP:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}}function u(e){return!d.contains([n.DETAIL,n.TEXT,n.ORDER,n.TOOLTIP],e)}function c(e,t){switch(e){case n.ROW:case n.COLUMN:return"band"===t;case n.X:case n.Y:case n.SIZE:case n.OPACITY:return t in g;case n.COLOR:return"band"!==t;case n.SHAPE:return"ordinal"===t}return!1}function s(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:case n.X2:case n.Y2:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:case n.TEXT:case n.TOOLTIP:return"discrete";case n.COLOR:return"flexible";case n.DETAIL:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}Object.defineProperty(n,"__esModule",{value:!0});var l,f=e("./scale"),d=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail",e.TOOLTIP="tooltip"}(l=n.Channel||(n.Channel={})),n.X=l.X,n.Y=l.Y,n.X2=l.X2,n.Y2=l.Y2,n.ROW=l.ROW,n.COLUMN=l.COLUMN,n.SHAPE=l.SHAPE,n.SIZE=l.SIZE,n.COLOR=l.COLOR,n.TEXT=l.TEXT,n.DETAIL=l.DETAIL,n.ORDER=l.ORDER,n.OPACITY=l.OPACITY,n.TOOLTIP=l.TOOLTIP,n.CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP];var p=d.toSet(n.CHANNELS);n.SINGLE_DEF_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY,n.TEXT,n.TOOLTIP],n.isChannel=r,n.UNIT_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP],n.SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY];var y=d.toSet(n.SCALE_CHANNELS);n.isScaleChannel=i,n.NONSPATIAL_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL,n.TOOLTIP],n.SPATIAL_SCALE_CHANNELS=[n.X,n.Y],n.NONSPATIAL_SCALE_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.LEVEL_OF_DETAIL_CHANNELS=d.without(n.NONSPATIAL_CHANNELS,["order"]),n.STACK_BY_CHANNELS=[n.COLOR,n.DETAIL,n.ORDER,n.OPACITY,n.SIZE],n.supportMark=o,n.getSupportedMark=a,n.hasScale=u;var g=d.toSet(d.without(f.SCALE_TYPES,["ordinal","sequential"]));n.supportScaleType=c,n.rangeType=s},{"./scale":65,"./util":68}],58:[function(e,t,n){"use strict";function r(e,t,n,r,o,s){var l=i(t,n,r,o,s);return u.hasScale(t)?void 0!==e?u.supportScaleType(t,e)?a(e,n)?e:(c.warn(c.message.scaleTypeNotWorkWithFieldDef(e,l)),l):(c.warn(c.message.scaleTypeNotWorkWithChannel(t,e,l)),l):l:null}function i(e,t,n,r,i){if(p.contains(["row","column"],e))return"band";switch(t.type){case"nominal":return"color"===e||"discrete"===u.rangeType(e)?"ordinal":o(e,n,r,i);case"ordinal":return"color"===e?"sequential":"discrete"===u.rangeType(e)?(c.warn(c.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal"):o(e,n,r,i);case"temporal":return"color"===e?f.isDiscreteByDefault(t.timeUnit)?"ordinal":"sequential":"discrete"===u.rangeType(e)?(c.warn(c.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):f.isDiscreteByDefault(t.timeUnit)?o(e,n,r,i):"time";case"quantitative":return"color"===e?t.bin?"bin-ordinal":"sequential":"discrete"===u.rangeType(e)?(c.warn(c.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear"}throw new Error(c.message.invalidFieldType(t.type))}function o(e,t,n,r){if(p.contains(["x","y"],e)){if("rect"===t)return"band";if("bar"===t)return"band"}return"point"}function a(e,t){var n=t.type;return y.contains([d.Type.ORDINAL,d.Type.NOMINAL],n)?void 0===e||l.hasDiscreteDomain(e):n===d.Type.TEMPORAL?t.timeUnit?y.contains([s.ScaleType.TIME,s.ScaleType.UTC,void 0],e)||l.hasDiscreteDomain(e):y.contains([s.ScaleType.TIME,s.ScaleType.UTC,void 0],e):n!==d.Type.QUANTITATIVE||(t.bin?e===s.ScaleType.BIN_LINEAR||e===s.ScaleType.BIN_ORDINAL:y.contains([s.ScaleType.LOG,s.ScaleType.POW,s.ScaleType.SQRT,s.ScaleType.QUANTILE,s.ScaleType.QUANTIZE,s.ScaleType.LINEAR,void 0],e))}Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../channel"),c=e("../../log"),s=e("../../scale"),l=e("../../scale"),f=e("../../timeunit"),d=e("../../type"),p=e("../../util"),y=e("../../util");n.scaleType=r,n.fieldDefMatchScaleType=a},{"../../channel":57,"../../log":62,"../../scale":65,"../../timeunit":66,"../../type":67,"../../util":68}],59:[function(e,t,n){"use strict";function r(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function i(e){if(s.isNumber(e))return e>4&&c.warn(c.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(c.message.invalidTimeUnit("quarter",e))}function o(e){if(s.isNumber(e))return e-1+"";var t=e.toLowerCase(),r=n.MONTHS.indexOf(t);if(r!==-1)return r+"";var i=t.substr(0,3),o=n.SHORT_MONTHS.indexOf(i);if(o!==-1)return o+"";throw new Error(c.message.invalidTimeUnit("month",e))}function a(e){if(s.isNumber(e))return e%7+"";var t=e.toLowerCase(),r=n.DAYS.indexOf(t);if(r!==-1)return r+"";var i=t.substr(0,3),o=n.SHORT_DAYS.indexOf(i);if(o!==-1)return o+"";throw new Error(c.message.invalidTimeUnit("day",e))}function u(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&s.keys(e).length>1&&(c.warn(c.message.droppedDay(e)),e=s.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(l):n.push(0),void 0!==e.month){var r=t?o(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var u=t?i(e.quarter):e.quarter;n.push(u+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var f=t?a(e.day):e.day;
n.push(f+"+1")}else n.push(1);for(var d=0,p=["hours","minutes","seconds","milliseconds"];d<p.length;d++){var y=p[d];void 0!==e[y]?n.push(e[y]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}Object.defineProperty(n,"__esModule",{value:!0});var c=e("./log"),s=e("./util"),l=2006;n.isDateTime=r,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.dateTimeExpr=u},{"./log":62,"./util":68}],60:[function(e,t,n){"use strict";function r(e){return e&&!b.isString(e)&&"repeat"in e}function i(e){return!!e&&!!e.condition}function o(e){return!!e&&!!e.condition&&a(e.condition)}function a(e){return!(!e||!e.field&&"count"!==e.aggregate)}function u(e){return e&&"value"in e&&void 0!==e.value}function c(e){return!(!e||!e.scale&&!e.sort)}function s(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(d(e))n="count_*";else{var o=void 0;t.nofn||(e.bin?(o=N.binToString(e.bin),i=t.binSuffix):e.aggregate?o=String(t.aggregate||e.aggregate):e.timeUnit&&(o=String(e.timeUnit))),o&&(n=o+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.expr&&(n=t.expr+"["+b.stringValue(n)+"]"),n}function l(e){switch(e.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!e.bin;case"temporal":return P.isDiscreteByDefault(e.timeUnit)}throw new Error(A.message.invalidFieldType(e.type))}function f(e){return!l(e)}function d(e){return"count"===e.aggregate}function p(e,t){if(d(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}function y(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(S.rangeType(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function g(e){return a(e)?e:o(e)?e.condition:void 0}function h(e,t){return a(e)?m(e,t):o(e)?T.__assign({},e,{condition:m(e.condition,t)}):e}function m(e,t){if(e.aggregate&&!O.AGGREGATE_OP_INDEX[e.aggregate]){var n=(e.aggregate,T.__rest(e,["aggregate"]));A.warn(A.message.invalidAggregate(e.aggregate)),e=n}if(e.bin&&(e=T.__assign({},e,{bin:v(e.bin,t)})),e.type){var r=C.getFullName(e.type);e.type!==r&&(e=T.__assign({},e,{type:r}))}else{var i=y(e,t);A.warn(A.message.emptyOrInvalidFieldType(e.type,t,i)),e=T.__assign({},e,{type:i})}var o=E(e,t),a=o.compatible,u=o.warning;return a||A.warn(u),e}function v(e,t){return b.isBoolean(e)?{maxbins:N.autoMaxBins(t)}:e.maxbins||e.step?e:T.__assign({},e,{maxbins:N.autoMaxBins(t)})}function E(e,t){switch(t){case"row":case"column":return f(e)&&!e.timeUnit?{compatible:!1,warning:A.message.facetChannelShouldBeDiscrete(t)}:_;case"x":case"y":case"color":case"text":case"detail":case"tooltip":return _;case"opacity":case"size":case"x2":case"y2":return l(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:_;case"shape":return"nominal"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data only"}:_;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:_}throw new Error("channelCompatability not implemented for channel "+t)}Object.defineProperty(n,"__esModule",{value:!0});var T=e("tslib"),O=e("./aggregate"),N=e("./bin"),S=e("./channel"),A=e("./log"),P=e("./timeunit"),C=e("./type"),b=e("./util");n.isRepeatRef=r,n.isConditionalDef=i,n.hasConditionFieldDef=o,n.isFieldDef=a,n.isValueDef=u,n.isScaleFieldDef=c,n.field=s,n.isDiscrete=l,n.isContinuous=f,n.isCount=d,n.title=p,n.defaultType=y,n.getFieldDef=g,n.normalize=h,n.normalizeFieldDef=m,n.normalizeBin=v;var _={compatible:!0};n.channelCompatibility=E},{"./aggregate":54,"./bin":56,"./channel":57,"./log":62,"./timeunit":66,"./type":67,"./util":68,tslib:53}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultLegendConfig={orient:void 0},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"]},{}],62:[function(e,t,n){"use strict";function r(e){var t=d=new p;e(t),a()}function i(e){return function(){var t=d=new p;e(t),a()}}function o(e){return d=e}function a(){return d=f}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.warn.apply(d,arguments)}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.info.apply(d,arguments)}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];d.debug.apply(d,arguments)}Object.defineProperty(n,"__esModule",{value:!0});var l=e("vega-util"),f=l.logger(l.Warn),d=f,p=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=p,n.runLocalLogger=r,n.wrap=i,n.set=o,n.reset=a,n.warn=u,n.info=c,n.debug=s;var y;!function(e){function t(e){return"Cannot project a selection on encoding channel "+e+", which has no field."}function n(e){return'Unknown repeated value "'+e+'".'}function r(e){return"Unrecognized parse "+e+"."}function i(e,t,n){return"An ancestor parsed field "+e+" as "+n+" but a child wants to parse the field as "+t+"."}function o(e){return"Ignoring an invalid transform: "+JSON.stringify(e)+"."}function a(e){return'Invalid field type "'+e+'"'}function u(e){return'Invalid aggregation operator "'+e+'"'}function c(e,t,n){return"Invalid field type ("+e+") for channel "+t+", using "+n+" instead."}function s(e,t){return"Dropping "+JSON.stringify(e)+" from channel "+t+" since it does not contain data field or value."}function l(e,t,n){return e+" dropped as it is incompatible with "+t+(n?" when "+n:"")+"."}function f(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function d(e,t){return"Using discrete channel "+e+" to encode "+t+" field can be misleading as it does not encode "+("ordinal"===t?"order":"magnitude")+"."}function p(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode continous fields. In this case, we use vertical by default"}function y(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode discrete or empty fields."}function g(e,t){return"Specified orient "+e+" overridden with "+t}function h(e){return"Cannot use "+e+" with non-color channel."}function m(e){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(e)+")."}function v(e){return"Unaggregated domain not applicable for "+e+" since it produces values outside the origin domain of the source data."}function E(e){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(e)+")."}function T(e){return"Using size field when "+e+"-channel has a band scale is not supported."}function O(e){return"Cannot apply size to non-oriented mark "+e+"."}function N(e){return"rangeStep for "+e+" is dropped as top-level "+("x"===e?"width":"height")+" is provided."}function S(e,t,n){return"Channel "+e+" does not work with "+t+" scale. We are using "+n+" scale instead."}function A(e,t){return"FieldDef does not work with "+e+" scale. We are using "+t+" scale instead."}function P(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function C(e,t){return'Scale type "'+t+'" does not work with mark '+e+"."}function b(e){return"Setting the scale to be independent for "+e+" means we also have to set the guide (axis or legend) to be independent."}function _(e){return"Cannot set "+e+'-scale\'s "domain" as it is binned. Please use "bin"\'s "extent" instead.'}function I(e){return"Cannot stack "+e+" if there is already "+e+"2"}function M(e){return"Cannot stack non-linear scale ("+e+")"}function R(e){return"Cannot stack when the aggregate function is non-summative ("+e+")"}function U(e,t){return"Invalid "+e+": "+t}function D(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."}function w(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.cannotProjectOnChannelWithoutField=t,e.noSuchRepeatedValue=n,e.unrecognizedParse=r,e.differentParse=i,e.invalidTransformIgnored=o,e.NO_FIELDS_NEEDS_AS="If `from.fields` is not specified, `as` has to be a string that specifies the key to be used for the the data from the secondary source.",e.invalidFieldType=a,e.invalidAggregate=u,e.emptyOrInvalidFieldType=c,e.emptyFieldDef=s,e.incompatibleChannel=l,e.facetChannelShouldBeDiscrete=f,e.discreteChannelCannotEncode=d,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=p,e.unclearOrientDiscreteOrEmpty=y,e.orientOverridden=g,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=h,e.unaggregateDomainHasNoEffectForRawField=m,e.unaggregateDomainWithNonSharedDomainOp=v,e.unaggregatedDomainWithLogScale=E,e.CANNOT_USE_RANGE_WITH_POSITION="Cannot use custom range with x or y channel.  Please customize width, height, padding, or rangeStep instead.",e.cannotUseSizeFieldWithBandSize=T,e.cannotApplySizeToNonOrientedMark=O,e.rangeStepDropped=N,e.scaleTypeNotWorkWithChannel=S,e.scaleTypeNotWorkWithFieldDef=A,e.scalePropertyNotWorkWithScaleType=P,e.scaleTypeNotWorkWithMark=C,e.independentScaleMeansIndependentGuide=b,e.conflictedDomain=_,e.INVAID_DOMAIN="Invalid scale domain",e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=I,e.cannotStackNonLinearScale=M,e.cannotStackNonSummativeAggregate=R,e.invalidTimeUnit=U,e.dayReplacedWithDate=D,e.droppedDay=w}(y=n.message||(n.message={}))},{"vega-util":69}],63:[function(e,t,n){"use strict";function r(e){return!!e.or}function i(e){return!!e.and}function o(e){return!!e.not}Object.defineProperty(n,"__esModule",{value:!0}),n.isLogicalOr=r,n.isLogicalAnd=i,n.isLogicalNot=o},{}],64:[function(e,t,n){"use strict";function r(e){return e.type}function i(e){var t=r(e)?e.type:e;return t in u}Object.defineProperty(n,"__esModule",{value:!0});var o,a=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square"}(o=n.Mark||(n.Mark={})),n.AREA=o.AREA,n.BAR=o.BAR,n.LINE=o.LINE,n.POINT=o.POINT,n.TEXT=o.TEXT,n.TICK=o.TICK,n.RECT=o.RECT,n.RULE=o.RULE,n.CIRCLE=o.CIRCLE,n.SQUARE=o.SQUARE,n.PRIMITIVE_MARKS=[n.AREA,n.BAR,n.LINE,n.POINT,n.TEXT,n.TICK,n.RECT,n.RULE,n.CIRCLE,n.SQUARE],n.isMarkDef=r;var u=a.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=i,n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],n.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={bar:["binSpacing","continuousBandSize","discreteBandSize"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultTextConfig={},n.defaultTickConfig={thickness:1}},{"./util":68}],65:[function(e,t,n){"use strict";function r(e,t){return h[e]===h[t]}function i(e){return m[e]}function o(e){return e in T}function a(e){return e in O}function u(e){return e in E}function c(e){return e in v}function s(e){return e&&!!e.name}function l(e){return e&&e.selection}function f(e,t){switch(t){case"type":case"domain":case"range":case"scheme":return!0;case"interpolate":return g.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return c(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return g.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return c(e)||"sequential"===e;case"nice":return c(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e||"log"===e;case"zero":return"bin-ordinal"===e||!o(e)&&!g.contains(["log","time","utc","bin-linear"],e)}throw new Error("Invalid scale property "+t+".")}function d(e,t){switch(t){case"range":if("x"===e||"y"===e)return y.message.CANNOT_USE_RANGE_WITH_POSITION;return;case"rangeStep":return;case"padding":case"paddingInner":case"paddingOuter":return;case"interpolate":case"scheme":if("color"!==e)return y.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"round":case"clamp":case"exponent":case"nice":case"zero":return}throw new Error('Invalid scale property "${propName}".')}Object.defineProperty(n,"__esModule",{value:!0});var p,y=e("./log"),g=e("./util");!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(p=n.ScaleType||(n.ScaleType={})),n.SCALE_TYPES=["linear","bin-linear","log","pow","sqrt","time","utc","sequential","ordinal","bin-ordinal","point","band"];var h={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};n.scaleCompatible=r;var m={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:0,band:1,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};n.scaleTypePrecedence=i,n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var v=g.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var E=g.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var T=g.toSet(n.DISCRETE_DOMAIN_SCALES),O=g.toSet(["bin-linear","bin-ordinal"]);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=o,n.isBinScale=a,n.hasContinuousDomain=u,n.isContinuousToContinuous=c,n.defaultScaleConfig={round:!0,textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,shapes:["circle","square","cross","diamond","triangle-up","triangle-down"]},n.isExtendedScheme=s,n.isSelectionDomain=l,n.SCALE_PROPERTIES=["type","domain","range","round","rangeStep","scheme","padding","paddingInner","paddingOuter","clamp","nice","exponent","zero","interpolate"],n.scaleTypeSupportProperty=f,n.channelScalePropertyIncompatability=d},{"./log":62,"./util":68}],66:[function(e,t,n){"use strict";function r(e){return!!h[e]}function i(e,t){var r=new Date(0,0,1,0,0,0,0);return n.SINGLE_TIMEUNITS.forEach(function(n){if(a(e,n))switch(n){case d.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case d.YEAR:r.setFullYear(t.getFullYear());break;case d.QUARTER:r.setMonth(3*Math.floor(t.getMonth()/3));break;case d.MONTH:r.setMonth(t.getMonth());break;case d.DATE:r.setDate(t.getDate());break;case d.HOURS:r.setHours(t.getHours());break;case d.MINUTES:r.setMinutes(t.getMinutes());break;case d.SECONDS:r.setSeconds(t.getSeconds());break;case d.MILLISECONDS:r.setMilliseconds(t.getMilliseconds())}}),r}function o(e){return!!m[e]}function a(e,t){var n=e.indexOf(t);return n>-1&&(t!==d.SECONDS||0===n||"i"!==e.charAt(n-1))}function u(e,t){function r(e){return e===d.QUARTER?"("+o+"quarter("+i+")-1)":""+o+e+"("+i+")"}var i="datum["+g.stringValue(t)+"]",o=f(e)?"utc":"",u=n.SINGLE_TIMEUNITS.reduce(function(t,n){return a(e,n)&&(t[n]=r(n)),t},{});return u.day&&g.keys(u).length>1&&(y.warn(y.message.dayReplacedWithDate(e)),delete u.day,u.date=r(d.DATE)),p.dateTimeExpr(u)}function c(e){if(e)return a(e,d.SECONDS)?"second":a(e,d.MINUTES)?"minute":a(e,d.HOURS)?"hour":a(e,d.DAY)||a(e,d.DATE)?"day":a(e,d.MONTH)?"month":a(e,d.YEAR)?"year":void 0}function s(e,t,n,r){if(e){var i=[],o="",u=a(e,d.YEAR);a(e,d.QUARTER)&&(o="'Q' + quarter("+t+")"),a(e,d.MONTH)&&i.push(n!==!1?"%b":"%B"),a(e,d.DAY)?i.push(n?"%a":"%A"):a(e,d.DATE)&&i.push("%d"+(u?",":"")),u&&i.push(n?"%y":"%Y");var c=[];a(e,d.HOURS)&&c.push("%H"),a(e,d.MINUTES)&&c.push("%M"),a(e,d.SECONDS)&&c.push("%S"),a(e,d.MILLISECONDS)&&c.push("%L");var s=[];return i.length>0&&s.push(i.join(" ")),c.length>0&&s.push(c.join(":")),s.length>0&&(o&&(o+=" + ' ' + "),o+=r?"utcFormat("+t+", '"+s.join(" ")+"')":"timeFormat("+t+", '"+s.join(" ")+"')"),o||void 0}}function l(e){switch(e){case"hours":case"day":case"month":case"quarter":return!0}return!1}function f(e){return"utc"===e.substr(0,3)}Object.defineProperty(n,"__esModule",{value:!0});var d,p=e("./datetime"),y=e("./log"),g=e("./util");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth",e.UTCYEAR="utcyear",e.UTCMONTH="utcmonth",e.UTCDAY="utcday",e.UTCDATE="utcdate",e.UTCHOURS="utchours",e.UTCMINUTES="utcminutes",e.UTCSECONDS="utcseconds",e.UTCMILLISECONDS="utcmilliseconds",e.UTCYEARMONTH="utcyearmonth",e.UTCYEARMONTHDATE="utcyearmonthdate",e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",e.UTCMONTHDATE="utcmonthdate",e.UTCHOURSMINUTES="utchoursminutes",e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",e.UTCMINUTESSECONDS="utcminutesseconds",e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",e.UTCQUARTER="utcquarter",e.UTCYEARQUARTER="utcyearquarter",e.UTCQUARTERMONTH="utcquartermonth",e.UTCYEARQUARTERMONTH="utcyearquartermonth"}(d=n.TimeUnit||(n.TimeUnit={})),n.SINGLE_TIMEUNITS=[d.YEAR,d.QUARTER,d.MONTH,d.DAY,d.DATE,d.HOURS,d.MINUTES,d.SECONDS,d.MILLISECONDS];var h=n.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isSingleTimeUnit=r,n.convert=i,n.MULTI_TIMEUNITS=[d.YEARQUARTER,d.YEARQUARTERMONTH,d.YEARMONTH,d.YEARMONTHDATE,d.YEARMONTHDATEHOURS,d.YEARMONTHDATEHOURSMINUTES,d.YEARMONTHDATEHOURSMINUTESSECONDS,d.QUARTERMONTH,d.HOURSMINUTES,d.HOURSMINUTESSECONDS,d.MINUTESSECONDS,d.SECONDSMILLISECONDS];var m=n.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isMultiTimeUnit=o,n.TIMEUNITS=[d.YEAR,d.QUARTER,d.MONTH,d.DAY,d.DATE,d.HOURS,d.MINUTES,d.SECONDS,d.MILLISECONDS,d.YEARQUARTER,d.YEARQUARTERMONTH,d.YEARMONTH,d.YEARMONTHDATE,d.YEARMONTHDATEHOURS,d.YEARMONTHDATEHOURSMINUTES,d.YEARMONTHDATEHOURSMINUTESSECONDS,d.QUARTERMONTH,d.HOURSMINUTES,d.HOURSMINUTESSECONDS,d.MINUTESSECONDS,d.SECONDSMILLISECONDS],n.containsTimeUnit=a,n.fieldExpr=u,n.smallestUnit=c,n.formatExpression=s,n.isDiscreteByDefault=l},{"./datetime":59,"./log":62,"./util":68}],67:[function(e,t,n){"use strict";function r(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(i=n.Type||(n.Type={})),n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.getFullName=r},{}],68:[function(e,t,n){"use strict";function r(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function i(e,t){var n=E(e);return t.forEach(function(e){delete n[e]}),n}function o(e){return A.isString(e)||A.isNumber(e)||T(e)?String(e):S(e)}function a(e,t){return e.indexOf(t)>-1}function u(e,t){return e.filter(function(e){return!a(t,e)})}function c(e,t){return e.concat(u(t,e))}function s(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function l(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function f(e){return[].concat.apply([],e)}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=p(e,o)}return e}function p(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||A.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=d(t[n].constructor===Array?[]:{},t[n]):d(e[n],t[n]));return e}function y(e,t){for(var n,r=[],i={},o=0,a=e;o<a.length;o++){var u=a[o];n=t(u),n in i||(i[n]=1,r.push(u))}return r}function g(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function h(e,t){for(var n in e)if(n in t)return!0;return!1}function m(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1}function v(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function E(e){return JSON.parse(JSON.stringify(e))}function T(e){return e===!0||e===!1}function O(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function N(e,t){return P.isLogicalNot(e)?"!("+N(e.not,t)+")":P.isLogicalAnd(e)?"("+e.and.map(function(e){return N(e,t)}).join(") && (")+")":P.isLogicalOr(e)?"("+e.or.map(function(e){return N(e,t)}).join(") || (")+")":t(e)}Object.defineProperty(n,"__esModule",{value:!0});var S=e("json-stable-stringify"),A=e("vega-util"),P=e("./logical"),C=e("vega-util");n.extend=C.extend,n.isArray=C.isArray,n.isObject=C.isObject,n.isNumber=C.isNumber,n.isString=C.isString,n.truncate=C.truncate,n.toSet=C.toSet,n.stringValue=C.stringValue,n.pick=r,n.omit=i,n.hash=o,n.contains=a,n.without=u,n.union=c,n.some=s,n.every=l,n.flatten=f,n.mergeDeep=d,n.unique=y,n.differ=g,n.hasIntersection=h,n.differArray=m,n.keys=Object.keys,n.vals=v,n.duplicate=E,n.isBoolean=T,n.varName=O,n.logicalExpr=N},{"./logical":63,"json-stable-stringify":49,"vega-util":69}],69:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function r(e){return s(e)?"["+e.map(r)+"]":l(e)||f(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function i(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}function o(e){return F(e)?e:x(e)?e:Date.parse(e)}var a=function(e,t,n){return e.fields=t||[],e.fname=n,e},u=function(e){throw Error(e)},c=function(e){function t(){o.push(l+e.substring(n,r)),l="",n=r+1}var n,r,i,o=[],a=null,c=0,s=e.length,l="";for(e+="",n=r=0;r<s;++r)if(i=e[r],"\\"===i)l+=e.substring(n,r),n=++r;else if(i===a)t(),a=null,c=-1;else{if(a)continue;n===c&&'"'===i?(n=r+1,a=i):n===c&&"'"===i?(n=r+1,a=i):"."!==i||c?"["===i?(r>n&&t(),c=n=r+1):"]"===i&&(c||u("Access path missing open bracket: "+e),c>0&&t(),c=0,n=r+1):r>n?t():n=r+1}return c&&u("Access path missing closing bracket: "+e),a&&u("Access path missing closing quote: "+e),r>n&&(++r,t()),o},s=Array.isArray,l=function(e){return e===Object(e)},f=function(e){return"string"==typeof e},d=function(e,t){var n=c(e),i="return _["+n.map(r).join("][")+"];";return a(Function("_",i),[e=1===n.length?n[0]:e],t||e)},p=[],y=d("id"),g=a(function(e){return e},p,"identity"),h=a(function(){return 0},p,"zero"),m=a(function(){return 1},p,"one"),v=a(function(){return!0},p,"true"),E=a(function(){return!1},p,"false"),T=0,O=1,N=2,S=3,A=function(e){var t=e||T;return{level:function(e){return arguments.length?(t=+e,this):t},warn:function(){return t>=O&&i("warn","WARN",arguments),this},info:function(){return t>=N&&i("log","INFO",arguments),this},debug:function(){return t>=S&&i("log","DEBUG",arguments),this}}},P=function(e){return null!=e?s(e)?e:[e]:[]},C=function(e,t){var n,i,o,u,s,l,f,d,p=[],y=(e=P(e)).map(function(e,t){return null==e?null:(p.push(t),c(e).map(r).join("]["))}),g=p.length-1,h=P(t),m="var u,v;return ";if(g<0)return null;for(i=0;i<=g;++i)n=p[i],o=y[n],u="(u=a["+o+"])",s="(v=b["+o+"])",l="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",f="descending"!==h[n]?(d=1,-1):(d=-1,1),m+="("+u+"<"+s+"||u==null)&&v!=null?"+f+":(u>v||v==null)&&u!=null?"+d+":"+l+"!==u&&v===v?"+f+":v!==v&&u===u?"+d+(n<g?":":":0");return a(Function("a","b",m+";"),e.filter(function(e){return null!=e}))},b=function(e){return"function"==typeof e},_=function(e){return b(e)?e:function(){return e}},I=function(e,t){function n(){t(i),r=i=null}var r,i;return function(t){i=t,r&&clearTimeout(r),r=setTimeout(n,e)}},M=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},R=function(e,t){var n,r,i,o,a,u=-1,c=e.length;if(null==t){for(;++u<c;)if(null!=(r=e[u])&&r>=r){n=i=r;break}for(o=a=u;++u<c;)null!=(r=e[u])&&(n>r&&(n=r,o=u),i<r&&(i=r,a=u))}else{for(;++u<c;)if(null!=(r=t(e[u],u,e))&&r>=r){n=i=r;break}for(o=a=u;++u<c;)null!=(r=t(e[u],u,e))&&(n>r&&(n=r,o=u),i<r&&(i=r,a=u))}return[o,a]},U={},D=function(e){function t(e){return i.hasOwnProperty(e)&&i[e]!==U}var n,r,i={};return n={size:0,empty:0,object:i,has:t,get:function(e){return t(e)?i[e]:void 0},set:function(e,r){return t(e)||(++n.size,i[e]===U&&--n.empty),i[e]=r,this},"delete":function(e){return t(e)&&(--n.size,++n.empty,i[e]=U),this},clear:function(){n.size=n.empty=0,n.object=i={}},test:function(e){return arguments.length?(r=e,n):r},clean:function(){var e,t,o={},a=0;for(e in i)t=i[e],t===U||r&&r(t)||(o[e]=t,++a);n.size=a,n.empty=0,n.object=i=o}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},w=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},L=function(e){return"boolean"==typeof e},x=function(e){return"[object Date]"===Object.prototype.toString.call(e)},F=function(e){return"number"==typeof e},k=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},Q=function(e){e=e?P(e):e;var t=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+c(e).map(r).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return a(t,e,"key")},H=function(e,t,n,r){var i=t.length,o=n.length;if(!o)return t;if(!i)return n;for(var a=r||new t.constructor(i+o),u=0,c=0,s=0;u<i&&c<o;++s)a[s]=e(t[u],n[c])>0?n[c++]:t[u++];for(;u<i;++u,++s)a[s]=t[u];for(;c<o;++c,++s)a[s]=n[c];return a},Y=function(e,t){for(var n="";--t>=0;)n+=e;return n},j=function(e,t,n,r){var i=n||" ",o=e+"",a=t-o.length;return a<=0?o:"left"===r?Y(i,a)+o:"center"===r?Y(i,~~(a/2))+o+Y(i,Math.ceil(a/2)):o+Y(i,a)},B=function(e){return e[e.length-1]},W=function(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e},G=function(e,t){return t=t||o,null==e||""===e?null:t(e)},q=function(e){return null==e||""===e?null:+e},V=function(e){return null==e||""===e?null:e+""},z=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=1;return t},X=function(e,t,n,r){var i=null!=r?r:"",o=e+"",a=o.length,u=Math.max(0,t-i.length);return a<=t?o:"left"===n?i+o.slice(a-u):"center"===n?o.slice(0,Math.ceil(u/2))+i+o.slice(a-~~(u/2)):o.slice(0,u)+i},K=function(e,t,n){if(e){var r,i=0,o=e.length;if(t)for(;i<o;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}};e.accessor=a,e.accessorName=t,e.accessorFields=n,e.id=y,e.identity=g,e.zero=h,e.one=m,e.truthy=v,e.falsy=E,e.logger=A,e.None=T,e.Warn=O,e.Info=N,e.Debug=S,e.array=P,e.compare=C,e.constant=_,e.debounce=I,e.error=u,e.extend=M,e.extentIndex=R,e.fastmap=D,e.field=d,e.inherits=w,e.isArray=s,e.isBoolean=L,e.isDate=x,e.isFunction=b,e.isNumber=F,e.isObject=l,e.isRegExp=k,e.isString=f,e.key=Q,e.merge=H,e.pad=j,e.peek=B,e.repeat=Y,e.splitAccessPath=c,e.stringValue=r,e.toBoolean=W,e.toDate=G,e.toNumber=q,e.toString=V,e.toSet=z,e.truncate=X,e.visitArray=K,Object.defineProperty(e,"__esModule",{value:!0})})},{}]},{},[8])(8)});
//# sourceMappingURL=build/compassql.min.js.map
